<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://xiong-zh.github.io</id>
    <title>å¼ é›„</title>
    <updated>2020-01-20T04:59:02.770Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://xiong-zh.github.io"/>
    <link rel="self" href="https://xiong-zh.github.io/atom.xml"/>
    <subtitle>å‡¡å¿ƒæ‰€å‘,ç´ å±¥æ‰€å¾€ã€‚ç”Ÿå¦‚é€†æ—…ï¼Œä¸€è‹‡ä»¥èˆªã€‚</subtitle>
    <logo>https://xiong-zh.github.io/images/avatar.png</logo>
    <icon>https://xiong-zh.github.io/favicon.ico</icon>
    <rights>All rights reserved 2020, å¼ é›„</rights>
    <entry>
        <title type="html"><![CDATA[Flask_SQLALchemy]]></title>
        <id>https://xiong-zh.github.io/post/flask_sqlalchemy</id>
        <link href="https://xiong-zh.github.io/post/flask_sqlalchemy">
        </link>
        <updated>2020-01-20T04:47:57.000Z</updated>
        <summary type="html"><![CDATA[<p>SQLAlchemyå¸¸ç”¨æ•°æ®ç±»å‹ï¼š</p>
<ol>
<li>Integerï¼šæ•´å½¢ï¼Œæ˜ å°„åˆ°æ•°æ®åº“ä¸­æ˜¯intç±»å‹ã€‚</li>
<li>Floatï¼šæµ®ç‚¹ç±»å‹ï¼Œæ˜ å°„åˆ°æ•°æ®åº“ä¸­æ˜¯floatç±»å‹ã€‚ä»–å æ®çš„32ä½ã€‚</li>
<li>Doubleï¼šåŒç²¾åº¦æµ®ç‚¹ç±»å‹ï¼Œæ˜ å°„åˆ°æ•°æ®åº“ä¸­æ˜¯doubleç±»å‹ï¼Œå æ®64ä½ã€‚</li>
<li>Stringï¼šå¯å˜å­—ç¬¦ç±»å‹ï¼Œæ˜ å°„åˆ°æ•°æ®åº“ä¸­æ˜¯varcharç±»å‹.</li>
<li>Booleanï¼šå¸ƒå°”ç±»å‹ï¼Œæ˜ å°„åˆ°æ•°æ®åº“ä¸­çš„æ˜¯tinyintç±»å‹ã€‚</li>
<li>DECIMALï¼šå®šç‚¹ç±»å‹ã€‚æ˜¯ä¸“é—¨ä¸ºäº†è§£å†³æµ®ç‚¹ç±»å‹ç²¾åº¦ä¸¢å¤±çš„é—®é¢˜çš„ã€‚</li>
</ol>
]]></summary>
        <content type="html"><![CDATA[<p>SQLAlchemyå¸¸ç”¨æ•°æ®ç±»å‹ï¼š</p>
<ol>
<li>Integerï¼šæ•´å½¢ï¼Œæ˜ å°„åˆ°æ•°æ®åº“ä¸­æ˜¯intç±»å‹ã€‚</li>
<li>Floatï¼šæµ®ç‚¹ç±»å‹ï¼Œæ˜ å°„åˆ°æ•°æ®åº“ä¸­æ˜¯floatç±»å‹ã€‚ä»–å æ®çš„32ä½ã€‚</li>
<li>Doubleï¼šåŒç²¾åº¦æµ®ç‚¹ç±»å‹ï¼Œæ˜ å°„åˆ°æ•°æ®åº“ä¸­æ˜¯doubleç±»å‹ï¼Œå æ®64ä½ã€‚</li>
<li>Stringï¼šå¯å˜å­—ç¬¦ç±»å‹ï¼Œæ˜ å°„åˆ°æ•°æ®åº“ä¸­æ˜¯varcharç±»å‹.</li>
<li>Booleanï¼šå¸ƒå°”ç±»å‹ï¼Œæ˜ å°„åˆ°æ•°æ®åº“ä¸­çš„æ˜¯tinyintç±»å‹ã€‚</li>
<li>DECIMALï¼šå®šç‚¹ç±»å‹ã€‚æ˜¯ä¸“é—¨ä¸ºäº†è§£å†³æµ®ç‚¹ç±»å‹ç²¾åº¦ä¸¢å¤±çš„é—®é¢˜çš„ã€‚</li>
</ol>
<!-- more -->
<h3 id="ä½¿ç”¨sqlalchemyå»è¿æ¥æ•°æ®åº“">ä½¿ç”¨SQLAlchemyå»è¿æ¥æ•°æ®åº“ï¼š</h3>
<p>ä½¿ç”¨SQLALchemyå»è¿æ¥æ•°æ®åº“ï¼Œéœ€è¦ä½¿ç”¨ä¸€äº›é…ç½®ä¿¡æ¯ï¼Œç„¶åå°†ä»–ä»¬ç»„åˆæˆæ»¡è¶³æ¡ä»¶çš„å­—ç¬¦ä¸²ï¼š</p>
<pre><code class="language-python">HOSTNAME = '127.0.0.1'
PORT = '3306'
DATABASE = 'first_sqlalchemy'
USERNAME = 'root'
PASSWORD = 'root'

# dialect+driver://username:password@host:port/database
DB_URI = &quot;mysql+pymysql://{username}:{password}@{host}:{port}/{db}?charset=utf8&quot;.format(username=USERNAME,password=PASSWORD,host=HOSTNAME,port=PORT,db=DATABASE)
</code></pre>
<p>ç„¶åä½¿ç”¨<code>create_engine</code>åˆ›å»ºä¸€ä¸ªå¼•æ“<code>engine</code>ï¼Œç„¶åå†è°ƒç”¨è¿™ä¸ªå¼•æ“çš„<code>connect</code>æ–¹æ³•ï¼Œå°±å¯ä»¥å¾—åˆ°è¿™ä¸ªå¯¹è±¡ï¼Œç„¶åå°±å¯ä»¥é€šè¿‡è¿™ä¸ªå¯¹è±¡å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œäº†ï¼š</p>
<pre><code class="language-python">engine = create_engine(DB_URI)

# åˆ¤æ–­æ˜¯å¦è¿æ¥æˆåŠŸ
conn = engine.connect()
result = conn.execute('select 1')
print(result.fetchone())
</code></pre>
<h3 id="ormä»‹ç»">ORMä»‹ç»ï¼š</h3>
<ol>
<li>ORMï¼šObject Relationship Mapping</li>
<li>å¤§ç™½è¯ï¼šå¯¹è±¡æ¨¡å‹ä¸æ•°æ®åº“è¡¨çš„æ˜ å°„</li>
</ol>
<h3 id="å°†ormæ¨¡å‹æ˜ å°„åˆ°æ•°æ®åº“ä¸­">å°†ORMæ¨¡å‹æ˜ å°„åˆ°æ•°æ®åº“ä¸­ï¼š</h3>
<ol>
<li>ç”¨<code>declarative_base</code>æ ¹æ®<code>engine</code>åˆ›å»ºä¸€ä¸ªORMåŸºç±»ã€‚<pre><code class="language-python">from sqlalchemy.ext.declarative import declarative_base
engine = create_engine(DB_URI)
Base = declarative_base(engine)
</code></pre>
</li>
<li>ç”¨è¿™ä¸ª<code>Base</code>ç±»ä½œä¸ºåŸºç±»æ¥å†™è‡ªå·±çš„ORMç±»ã€‚è¦å®šä¹‰<code>__tablename__</code>ç±»å±æ€§ï¼Œæ¥æŒ‡å®šè¿™ä¸ªæ¨¡å‹æ˜ å°„åˆ°æ•°æ®åº“ä¸­çš„è¡¨åã€‚<pre><code class="language-python">class Person(Base):
    __tablename__ = 'person'
</code></pre>
</li>
<li>åˆ›å»ºå±æ€§æ¥æ˜ å°„åˆ°è¡¨ä¸­çš„å­—æ®µï¼Œæ‰€æœ‰éœ€è¦æ˜ å°„åˆ°è¡¨ä¸­çš„å±æ€§éƒ½åº”è¯¥ä¸ºColumnç±»å‹ï¼š<pre><code class="language-python">class Person(Base):
    __tablename__ = 'person'
    # 2. åœ¨è¿™ä¸ªORMæ¨¡å‹ä¸­åˆ›å»ºä¸€äº›å±æ€§ï¼Œæ¥è·Ÿè¡¨ä¸­çš„å­—æ®µè¿›è¡Œä¸€ä¸€æ˜ å°„ã€‚è¿™äº›å±æ€§å¿…é¡»æ˜¯sqlalchemyç»™æˆ‘ä»¬æä¾›å¥½çš„æ•°æ®ç±»å‹ã€‚
    id = Column(Integer,primary_key=True,autoincrement=True)
    name = Column(String(50))
    age = Column(Integer)
</code></pre>
</li>
<li>ä½¿ç”¨<code>Base.metadata.create_all()</code>æ¥å°†æ¨¡å‹æ˜ å°„åˆ°æ•°æ®åº“ä¸­ã€‚</li>
<li>ä¸€æ—¦ä½¿ç”¨<code>Base.metadata.create_all()</code>å°†æ¨¡å‹æ˜ å°„åˆ°æ•°æ®åº“ä¸­åï¼Œå³ä½¿æ”¹å˜äº†æ¨¡å‹çš„å­—æ®µï¼Œä¹Ÿä¸ä¼šé‡æ–°æ˜ å°„äº†ã€‚</li>
</ol>
<h3 id="ç”¨sessionåšæ•°æ®çš„å¢åˆ æ”¹æŸ¥æ“ä½œ">ç”¨sessionåšæ•°æ®çš„å¢åˆ æ”¹æŸ¥æ“ä½œï¼š</h3>
<ol>
<li>æ„å»ºsessionå¯¹è±¡ï¼šæ‰€æœ‰å’Œæ•°æ®åº“çš„ORMæ“ä½œéƒ½å¿…é¡»é€šè¿‡ä¸€ä¸ªå«åš<code>session</code>çš„ä¼šè¯å¯¹è±¡æ¥å®ç°ï¼Œé€šè¿‡ä»¥ä¸‹ä»£ç æ¥è·å–ä¼šè¯å¯¹è±¡ï¼š<pre><code class="language-python">from sqlalchemy.orm import sessionmaker

engine = create_engine(DB_URI)
session = sessionmaker(engine)()
</code></pre>
</li>
<li>æ·»åŠ å¯¹è±¡ï¼š
<ul>
<li>åˆ›å»ºå¯¹è±¡ï¼Œä¹Ÿå³åˆ›å»ºä¸€æ¡æ•°æ®ï¼š<pre><code class="language-python">p = Person(name='qianfeng',age=18,country='china')
</code></pre>
</li>
<li>å°†è¿™ä¸ªå¯¹è±¡æ·»åŠ åˆ°<code>session</code>ä¼šè¯å¯¹è±¡ä¸­ï¼š<pre><code class="language-python">session.add(p)
</code></pre>
</li>
<li>å°†sessionä¸­çš„å¯¹è±¡åšcommitæ“ä½œï¼ˆæäº¤ï¼‰ï¼š<pre><code class="language-python">session.commit()
</code></pre>
</li>
<li>ä¸€æ¬¡æ€§æ·»åŠ å¤šæ¡æ•°æ®ï¼š<pre><code class="language-python">p1 = Person(name='qianfeng1',age=19,country='china')
p2 = Person(name='qianfeng2',age=20,country='china')
session.add_all([p1,p2])
session.commit()
</code></pre>
</li>
</ul>
</li>
<li>æŸ¥æ‰¾å¯¹è±¡ï¼š<pre><code class="language-python"># æŸ¥æ‰¾æŸä¸ªæ¨¡å‹å¯¹åº”çš„é‚£ä¸ªè¡¨ä¸­æ‰€æœ‰çš„æ•°æ®ï¼š
all_person = session.query(Person).all()
# ä½¿ç”¨filter_byæ¥åšæ¡ä»¶æŸ¥è¯¢
all_person = session.query(Person).filter_by(name='qianfeng').all()
# ä½¿ç”¨filteræ¥åšæ¡ä»¶æŸ¥è¯¢
all_person = session.query(Person).filter(Person.name=='qianfeng').all()
# ä½¿ç”¨getæ–¹æ³•æŸ¥æ‰¾æ•°æ®ï¼Œgetæ–¹æ³•æ˜¯æ ¹æ®idæ¥æŸ¥æ‰¾çš„ï¼Œåªä¼šè¿”å›ä¸€æ¡æ•°æ®æˆ–è€…None
person = session.query(Person).get(primary_key)
# ä½¿ç”¨firstæ–¹æ³•è·å–ç»“æœé›†ä¸­çš„ç¬¬ä¸€æ¡æ•°æ®
person = session.query(Person).first()
</code></pre>
</li>
<li>ä¿®æ”¹å¯¹è±¡ï¼šé¦–å…ˆä»æ•°æ®åº“ä¸­æŸ¥æ‰¾å¯¹è±¡ï¼Œç„¶åå°†è¿™æ¡æ•°æ®ä¿®æ”¹ä¸ºä½ æƒ³è¦çš„æ•°æ®ï¼Œæœ€ååšcommitæ“ä½œå°±å¯ä»¥ä¿®æ”¹æ•°æ®äº†ã€‚<pre><code class="language-python">person = session.query(Person).first()
person.name = 'ketang'
session.commit()
</code></pre>
</li>
<li>åˆ é™¤å¯¹è±¡ï¼šå°†éœ€è¦åˆ é™¤çš„æ•°æ®ä»æ•°æ®åº“ä¸­æŸ¥æ‰¾å‡ºæ¥ï¼Œç„¶åä½¿ç”¨<code>session.delete</code>æ–¹æ³•å°†è¿™æ¡æ•°æ®ä»sessionä¸­åˆ é™¤ï¼Œæœ€ååšcommitæ“ä½œå°±å¯ä»¥äº†ã€‚<pre><code class="language-python">person = session.query(Person).first()
session.delete(person)
session.commit()
</code></pre>
</li>
</ol>
<h3 id="sqlalchemyå¸¸ç”¨æ•°æ®ç±»å‹">SQLAlchemyå¸¸ç”¨æ•°æ®ç±»å‹ï¼š</h3>
<ol>
<li>Integerï¼šæ•´å½¢ï¼Œæ˜ å°„åˆ°æ•°æ®åº“ä¸­æ˜¯intç±»å‹ã€‚</li>
<li>Floatï¼šæµ®ç‚¹ç±»å‹ï¼Œæ˜ å°„åˆ°æ•°æ®åº“ä¸­æ˜¯floatç±»å‹ã€‚ä»–å æ®çš„32ä½ã€‚</li>
<li>Doubleï¼šåŒç²¾åº¦æµ®ç‚¹ç±»å‹ï¼Œæ˜ å°„åˆ°æ•°æ®åº“ä¸­æ˜¯doubleç±»å‹ï¼Œå æ®64ä½ã€‚</li>
<li>Stringï¼šå¯å˜å­—ç¬¦ç±»å‹ï¼Œæ˜ å°„åˆ°æ•°æ®åº“ä¸­æ˜¯varcharç±»å‹.</li>
<li>Booleanï¼šå¸ƒå°”ç±»å‹ï¼Œæ˜ å°„åˆ°æ•°æ®åº“ä¸­çš„æ˜¯tinyintç±»å‹ã€‚</li>
<li>DECIMALï¼šå®šç‚¹ç±»å‹ã€‚æ˜¯ä¸“é—¨ä¸ºäº†è§£å†³æµ®ç‚¹ç±»å‹ç²¾åº¦ä¸¢å¤±çš„é—®é¢˜çš„ã€‚åœ¨å­˜å‚¨é’±ç›¸å…³çš„å­—æ®µçš„æ—¶å€™å»ºè®®å¤§å®¶éƒ½ä½¿ç”¨è¿™ä¸ªæ•°æ®ç±»å‹ã€‚å¹¶ä¸”è¿™ä¸ªç±»å‹ä½¿ç”¨çš„æ—¶å€™éœ€è¦ä¼ é€’ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç”¨æ¥æ ‡è®°è¿™ä¸ªå­—æ®µæ€»èƒ½èƒ½å­˜å‚¨å¤šå°‘ä¸ªæ•°å­—ï¼Œç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºå°æ•°ç‚¹åæœ‰å¤šå°‘ä½ã€‚</li>
<li>Enumï¼šæšä¸¾ç±»å‹ã€‚æŒ‡å®šæŸä¸ªå­—æ®µåªèƒ½æ˜¯æšä¸¾ä¸­æŒ‡å®šçš„å‡ ä¸ªå€¼ï¼Œä¸èƒ½ä¸ºå…¶ä»–å€¼ã€‚åœ¨ORMæ¨¡å‹ä¸­ï¼Œä½¿ç”¨Enumæ¥ä½œä¸ºæšä¸¾ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š<pre><code class="language-python">class Article(Base):
    __tablename__ = 'article'
    id = Column(Integer,primary_key=True,autoincrement=True)
    tag = Column(Enum(&quot;python&quot;,'flask','django'))
</code></pre>
åœ¨Python3ä¸­ï¼Œå·²ç»å†…ç½®äº†enumè¿™ä¸ªæšä¸¾çš„æ¨¡å—ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ¨¡å—å»å®šä¹‰ç›¸å…³çš„å­—æ®µã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š<pre><code class="language-python">class TagEnum(enum.Enum):
    python = &quot;python&quot;
    flask = &quot;flask&quot;
    django = &quot;django&quot;

class Article(Base):
    __tablename__ = 'article'
    id = Column(Integer,primary_key=True,autoincrement=True)
    tag = Column(Enum(TagEnum))

article = Article(tag=TagEnum.flask)
</code></pre>
</li>
<li>Dateï¼šå­˜å‚¨æ—¶é—´ï¼Œåªèƒ½å­˜å‚¨å¹´æœˆæ—¥ã€‚æ˜ å°„åˆ°æ•°æ®åº“ä¸­æ˜¯dateç±»å‹ã€‚åœ¨Pythonä»£ç ä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>datetime.date</code>æ¥æŒ‡å®šã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š<pre><code class="language-python">class Article(Base):
    __tablename__ = 'article'
    id = Column(Integer,primary_key=True,autoincrement=True)
    create_time = Column(Date)

article = Article(create_time=date(2017,10,10))
</code></pre>
</li>
<li>DateTimeï¼šå­˜å‚¨æ—¶é—´ï¼Œå¯ä»¥å­˜å‚¨å¹´æœˆæ—¥æ—¶åˆ†ç§’æ¯«ç§’ç­‰ã€‚æ˜ å°„åˆ°æ•°æ®åº“ä¸­ä¹Ÿæ˜¯datetimeç±»å‹ã€‚åœ¨Pythonä»£ç ä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>datetime.datetime</code>æ¥æŒ‡å®šã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š<pre><code class="language-python">class Article(Base):
    __tablename__ = 'article'
    id = Column(Integer,primary_key=True,autoincrement=True)
    create_time = Column(DateTime)

article = Article(create_time=datetime(2011,11,11,11,11,11))
</code></pre>
</li>
<li>Timeï¼šå­˜å‚¨æ—¶é—´ï¼Œå¯ä»¥å­˜å‚¨æ—¶åˆ†ç§’ã€‚æ˜ å°„åˆ°æ•°æ®åº“ä¸­ä¹Ÿæ˜¯timeç±»å‹ã€‚åœ¨Pythonä»£ç ä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>datetime.time</code>æ¥è‡³æ­¤é‚£ä¸ªã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š<pre><code class="language-python">class Article(Base):
    __tablename__ = 'article'
    id = Column(Integer,primary_key=True,autoincrement=True)
    create_time = Column(Time)

article = Article(create_time=time(hour=11,minute=11,second=11))
</code></pre>
</li>
<li>Textï¼šå­˜å‚¨é•¿å­—ç¬¦ä¸²ã€‚ä¸€èˆ¬å¯ä»¥å­˜å‚¨6Wå¤šä¸ªå­—ç¬¦ã€‚å¦‚æœè¶…å‡ºäº†è¿™ä¸ªèŒƒå›´ï¼Œå¯ä»¥ä½¿ç”¨LONGTEXTç±»å‹ã€‚æ˜ å°„åˆ°æ•°æ®åº“ä¸­å°±æ˜¯textç±»å‹ã€‚</li>
<li>LONGTEXTï¼šé•¿æ–‡æœ¬ç±»å‹ï¼Œæ˜ å°„åˆ°æ•°æ®åº“ä¸­æ˜¯longtextç±»å‹ã€‚</li>
</ol>
<h3 id="columnå¸¸ç”¨å‚æ•°">Columnå¸¸ç”¨å‚æ•°ï¼š</h3>
<ol>
<li>primary_keyï¼šè®¾ç½®æŸä¸ªå­—æ®µä¸ºä¸»é”®ã€‚</li>
<li>autoincrementï¼šè®¾ç½®è¿™ä¸ªå­—æ®µä¸ºè‡ªåŠ¨å¢é•¿çš„ã€‚</li>
<li>defaultï¼šè®¾ç½®æŸä¸ªå­—æ®µçš„é»˜è®¤å€¼ã€‚åœ¨å‘è¡¨æ—¶é—´è¿™äº›å­—æ®µä¸Šé¢ç»å¸¸ç”¨ã€‚</li>
<li>nullableï¼šæŒ‡å®šæŸä¸ªå­—æ®µæ˜¯å¦ä¸ºç©ºã€‚é»˜è®¤å€¼æ˜¯Trueï¼Œå°±æ˜¯å¯ä»¥ä¸ºç©ºã€‚</li>
<li>uniqueï¼šæŒ‡å®šæŸä¸ªå­—æ®µçš„å€¼æ˜¯å¦å”¯ä¸€ã€‚é»˜è®¤æ˜¯Falseã€‚</li>
<li>onupdateï¼šåœ¨æ•°æ®æ›´æ–°çš„æ—¶å€™ä¼šè°ƒç”¨è¿™ä¸ªå‚æ•°æŒ‡å®šçš„å€¼æˆ–è€…å‡½æ•°ã€‚åœ¨ç¬¬ä¸€æ¬¡æ’å…¥è¿™æ¡æ•°æ®çš„æ—¶å€™ï¼Œä¸ä¼šç”¨onupdateçš„å€¼ï¼Œåªä¼šä½¿ç”¨defaultçš„å€¼ã€‚å¸¸ç”¨çš„å°±æ˜¯<code>update_time</code>ï¼ˆæ¯æ¬¡æ›´æ–°æ•°æ®çš„æ—¶å€™éƒ½è¦æ›´æ–°çš„å€¼ï¼‰ã€‚</li>
<li>nameï¼šæŒ‡å®šORMæ¨¡å‹ä¸­æŸä¸ªå±æ€§æ˜ å°„åˆ°è¡¨ä¸­çš„å­—æ®µåã€‚å¦‚æœä¸æŒ‡å®šï¼Œé‚£ä¹ˆä¼šä½¿ç”¨è¿™ä¸ªå±æ€§çš„åå­—æ¥ä½œä¸ºå­—æ®µåã€‚å¦‚æœæŒ‡å®šäº†ï¼Œå°±ä¼šä½¿ç”¨æŒ‡å®šçš„è¿™ä¸ªå€¼ä½œä¸ºå‚æ•°ã€‚è¿™ä¸ªå‚æ•°ä¹Ÿå¯ä»¥å½“ä½œä½ç½®å‚æ•°ï¼Œåœ¨ç¬¬1ä¸ªå‚æ•°æ¥æŒ‡å®šã€‚<pre><code class="language-python">title = Column(String(50),name='title',nullable=False)
title = Column('my_title',String(50),nullable=False)
</code></pre>
</li>
</ol>
<h3 id="queryå¯ç”¨å‚æ•°">queryå¯ç”¨å‚æ•°ï¼š</h3>
<ol>
<li>
<p>æ¨¡å‹å¯¹è±¡ã€‚æŒ‡å®šæŸ¥æ‰¾è¿™ä¸ªæ¨¡å‹ä¸­æ‰€æœ‰çš„å¯¹è±¡ã€‚</p>
</li>
<li>
<p>æ¨¡å‹ä¸­çš„å±æ€§ã€‚å¯ä»¥æŒ‡å®šåªæŸ¥æ‰¾æŸä¸ªæ¨¡å‹çš„å…¶ä¸­å‡ ä¸ªå±æ€§ã€‚</p>
</li>
<li>
<p>èšåˆå‡½æ•°ã€‚</p>
<ul>
<li>func.countï¼šç»Ÿè®¡è¡Œçš„æ•°é‡ã€‚</li>
<li>func.avgï¼šæ±‚å¹³å‡å€¼ã€‚</li>
<li>func.maxï¼šæ±‚æœ€å¤§å€¼ã€‚</li>
<li>func.minï¼šæ±‚æœ€å°å€¼ã€‚</li>
<li>func.sumï¼šæ±‚å’Œã€‚<br>
<code>func</code>ä¸Šï¼Œå…¶å®æ²¡æœ‰ä»»ä½•èšåˆå‡½æ•°ã€‚ä½†æ˜¯å› ä¸ºä»–åº•å±‚åšäº†ä¸€äº›é­”æœ¯ï¼Œåªè¦mysqlä¸­æœ‰çš„èšåˆå‡½æ•°ï¼Œéƒ½å¯ä»¥é€šè¿‡funcè°ƒç”¨ã€‚</li>
</ul>
<pre><code>from flask import func
session.query(func.count(Article.id)).first()
</code></pre>
</li>
</ol>
<h3 id="filterè¿‡æ»¤æ¡ä»¶">filterè¿‡æ»¤æ¡ä»¶ï¼š</h3>
<p>è¿‡æ»¤æ˜¯æ•°æ®æå–çš„ä¸€ä¸ªå¾ˆé‡è¦çš„åŠŸèƒ½ï¼Œä»¥ä¸‹å¯¹ä¸€äº›å¸¸ç”¨çš„è¿‡æ»¤æ¡ä»¶è¿›è¡Œè§£é‡Šï¼Œå¹¶ä¸”è¿™äº›è¿‡æ»¤æ¡ä»¶éƒ½æ˜¯åªèƒ½é€šè¿‡filteræ–¹æ³•å®ç°çš„ï¼š</p>
<ol>
<li>
<p>equalsï¼š</p>
<pre><code class="language-python">article = session.query(Article).filter(Article.title == &quot;title0&quot;).first()
print(article)
</code></pre>
</li>
<li>
<p>not equals:</p>
<pre><code class="language-python">query.filter(User.name != 'ed')
</code></pre>
</li>
<li>
<p>likeï¼š</p>
<pre><code class="language-python">query.filter(User.name.like('%ed%'))
</code></pre>
</li>
<li>
<p>inï¼š</p>
<pre><code class="language-python">query.filter(User.name.in_(['ed','wendy','jack']))
# åŒæ—¶ï¼Œinä¹Ÿå¯ä»¥ä½œç”¨äºä¸€ä¸ªQuery
query.filter(User.name.in_(session.query(User.name).filter(User.name.like('%ed%'))))
</code></pre>
</li>
<li>
<p>not inï¼š</p>
<pre><code class="language-python">query.filter(~User.name.in_(['ed','wendy','jack']))
</code></pre>
</li>
<li>
<p>is nullï¼š</p>
<pre><code class="language-python">query.filter(User.name==None)
# æˆ–è€…æ˜¯
query.filter(User.name.is_(None))
</code></pre>
</li>
<li>
<p>is not null:</p>
<pre><code class="language-python">query.filter(User.name != None)
# æˆ–è€…æ˜¯
query.filter(User.name.isnot(None))
</code></pre>
</li>
<li>
<p>andï¼š</p>
<pre><code class="language-python">from sqlalchemy import and_
query.filter(and_(User.name=='ed',User.fullname=='Ed Jones'))
# æˆ–è€…æ˜¯ä¼ é€’å¤šä¸ªå‚æ•°
query.filter(User.name=='ed',User.fullname=='Ed Jones')
# æˆ–è€…æ˜¯é€šè¿‡å¤šæ¬¡filteræ“ä½œ
query.filter(User.name=='ed').filter(User.fullname=='Ed Jones')
</code></pre>
</li>
<li>
<p>orï¼š</p>
<pre><code class="language-python">from sqlalchemy import or_  query.filter(or_(User.name=='ed',User.name=='wendy'))
</code></pre>
</li>
</ol>
<p>å¦‚æœæƒ³è¦æŸ¥çœ‹ormåº•å±‚è½¬æ¢çš„sqlè¯­å¥ï¼Œå¯ä»¥åœ¨filteræ–¹æ³•åé¢ä¸è¦å†æ‰§è¡Œä»»ä½•æ–¹æ³•ç›´æ¥æ‰“å°å°±å¯ä»¥çœ‹åˆ°äº†ã€‚æ¯”å¦‚ï¼š<br>
â€‹    <code>python â€‹ articles = session.query(Article).filter(or_(Article.title=='abc',Article.content=='abc')) â€‹ print(articles) â€‹</code></p>
<h3 id="å¤–é”®">å¤–é”®ï¼š</h3>
<p>ä½¿ç”¨SQLAlchemyåˆ›å»ºå¤–é”®éå¸¸ç®€å•ã€‚åœ¨ä»è¡¨ä¸­å¢åŠ ä¸€ä¸ªå­—æ®µï¼ŒæŒ‡å®šè¿™ä¸ªå­—æ®µå¤–é”®çš„æ˜¯å“ªä¸ªè¡¨çš„å“ªä¸ªå­—æ®µå°±å¯ä»¥äº†ã€‚ä»è¡¨ä¸­å¤–é”®çš„å­—æ®µï¼Œå¿…é¡»å’Œçˆ¶è¡¨çš„ä¸»é”®å­—æ®µç±»å‹ä¿æŒä¸€è‡´ã€‚<br>
ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-python">class User(Base):
    __tablename__ = 'user'
    id = Column(Integer,primary_key=True,autoincrement=True)
    username = Column(String(50),nullable=False)

class Article(Base):
    __tablename__ = 'article'
    id = Column(Integer,primary_key=True,autoincrement=True)
    title = Column(String(50),nullable=False)
    content = Column(Text,nullable=False)

    uid = Column(Integer,ForeignKey(&quot;user.id&quot;))
</code></pre>
<p>å¤–é”®çº¦æŸæœ‰ä»¥ä¸‹å‡ é¡¹ï¼š</p>
<ol>
<li>RESTRICTï¼šçˆ¶è¡¨æ•°æ®è¢«åˆ é™¤ï¼Œä¼šé˜»æ­¢åˆ é™¤ã€‚é»˜è®¤å°±æ˜¯è¿™ä¸€é¡¹ã€‚ ç”¨æˆ·å’Œè®¢å• å¦‚æœåˆ é™¤ç”¨æˆ·æ•°æ®ä¼šè¢«é˜»æ­¢ é™¤éå…ˆåˆ é™¤ç›¸å…³è®¢å• æ‰èƒ½åˆ é™¤ç”¨æˆ·æ•°æ®</li>
<li>NO ACTIONï¼šåœ¨MySQLä¸­ï¼ŒåŒRESTRICTã€‚</li>
<li>CASCADEï¼šçº§è”åˆ é™¤ã€‚</li>
<li>SET NULLï¼šçˆ¶è¡¨æ•°æ®è¢«åˆ é™¤ï¼Œå­è¡¨æ•°æ®ä¼šè®¾ç½®ä¸ºNULLã€‚</li>
</ol>
<h3 id="ormå…³ç³»ä»¥åŠä¸€å¯¹å¤š-ä¸€ä¸ªç”¨æˆ·å¯ä»¥å†™å¤šç¯‡æ–‡ç« -ä¸€ç¯‡æ–‡ç« åªå±äºä¸€ä¸ªç”¨æˆ·">ORMå…³ç³»ä»¥åŠä¸€å¯¹å¤šï¼š ä¸€ä¸ªç”¨æˆ·å¯ä»¥å†™å¤šç¯‡æ–‡ç«   ä¸€ç¯‡æ–‡ç« åªå±äºä¸€ä¸ªç”¨æˆ·</h3>
<p>mysqlçº§åˆ«çš„å¤–é”®ï¼Œè¿˜ä¸å¤ŸORMï¼Œå¿…é¡»æ‹¿åˆ°ä¸€ä¸ªè¡¨çš„å¤–é”®ï¼Œç„¶åé€šè¿‡è¿™ä¸ªå¤–é”®å†å»å¦å¤–ä¸€å¼ è¡¨ä¸­æŸ¥æ‰¾ï¼Œè¿™æ ·å¤ªéº»çƒ¦äº†ã€‚SQLAlchemyæä¾›äº†ä¸€ä¸ª<code>relationship</code>ï¼Œè¿™ä¸ªç±»å¯ä»¥å®šä¹‰å±æ€§ï¼Œä»¥ååœ¨è®¿é—®ç›¸å…³è”çš„è¡¨çš„æ—¶å€™å°±ç›´æ¥å¯ä»¥é€šè¿‡å±æ€§è®¿é—®çš„æ–¹å¼å°±å¯ä»¥è®¿é—®å¾—åˆ°äº†ã€‚ç¤ºä¾‹ä»£ç ï¼š</p>
<pre><code class="language-python">class User(Base):
    __tablename__ = 'user'
    id = Column(Integer,primary_key=True,autoincrement=True)
    username = Column(String(50),nullable=False)

    # articles = relationship(&quot;Article&quot;)

    def __repr__(self):
        return &quot;&lt;User(username:%s)&gt;&quot; % self.username

class Article(Base):
    __tablename__ = 'article'
    id = Column(Integer,primary_key=True,autoincrement=True)
    title = Column(String(50),nullable=False)
    content = Column(Text,nullable=False)
    uid = Column(Integer,ForeignKey(&quot;user.id&quot;))  
	# MyISAMå¼•æ“ä¸æ”¯æŒå¤–é”®  Innodbå¼•æ“æ‰æ”¯æŒ

    author = relationship(&quot;User&quot;,backref=&quot;articles&quot;)
</code></pre>
<p>å¦å¤–ï¼Œå¯ä»¥é€šè¿‡<code>backref</code>æ¥æŒ‡å®šåå‘è®¿é—®çš„å±æ€§åç§°ã€‚articlesæ˜¯æœ‰å¤šä¸ªã€‚ä»–ä»¬ä¹‹é—´çš„å…³ç³»æ˜¯ä¸€ä¸ªä¸€å¯¹å¤šçš„å…³ç³»ã€‚</p>
<h3 id="ä¸€å¯¹ä¸€çš„å…³ç³»-ä¸€å¼ è¡¨-æœ‰äº”ä¸ªå­—æ®µ-ä¸æƒ³åœ¨æ­¤åŸºç¡€ä¸Šå¢åŠ å­—æ®µè¿˜æƒ³æ‰©å±•-è¿™æ—¶å€™å¯ä»¥æ–°å»ºä¸€å¼ è¡¨-ç„¶åä¸€å¯¹ä¸€">ä¸€å¯¹ä¸€çš„å…³ç³»ï¼š ä¸€å¼ è¡¨ æœ‰äº”ä¸ªå­—æ®µ ä¸æƒ³åœ¨æ­¤åŸºç¡€ä¸Šå¢åŠ å­—æ®µè¿˜æƒ³æ‰©å±• è¿™æ—¶å€™å¯ä»¥æ–°å»ºä¸€å¼ è¡¨  ç„¶åä¸€å¯¹ä¸€</h3>
<p>åœ¨sqlalchemyä¸­ï¼Œå¦‚æœæƒ³è¦å°†ä¸¤ä¸ªæ¨¡å‹æ˜ å°„æˆä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œé‚£ä¹ˆåº”è¯¥åœ¨çˆ¶æ¨¡å‹ä¸­ï¼ŒæŒ‡å®šå¼•ç”¨çš„æ—¶å€™ï¼Œè¦ä¼ é€’ä¸€ä¸ª<code>uselist=False</code>è¿™ä¸ªå‚æ•°è¿›å»ã€‚å°±æ˜¯å‘Šè¯‰çˆ¶æ¨¡å‹ï¼Œä»¥åå¼•ç”¨è¿™ä¸ªä»æ¨¡å‹çš„æ—¶å€™ï¼Œä¸å†æ˜¯ä¸€ä¸ªåˆ—è¡¨äº†ï¼Œè€Œæ˜¯ä¸€ä¸ªå¯¹è±¡äº†ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-python">class User(Base):
    __tablename__ = 'user'
    id = Column(Integer,primary_key=True,autoincrement=True)
    username = Column(String(50),nullable=False)

    extend = relationship(&quot;UserExtend&quot;,uselist=False)

    def __repr__(self):
        return &quot;&lt;User(username:%s)&gt;&quot; % self.username

class UserExtend(Base):
    __tablename__ = 'user_extend'
    id = Column(Integer, primary_key=True, autoincrement=True)
    school = Column(String(50))
    uid = Column(Integer,ForeignKey(&quot;user.id&quot;))

    user = relationship(&quot;User&quot;,backref=&quot;extend&quot;)
</code></pre>
<p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥å€ŸåŠ©<code>sqlalchemy.orm.backref</code>æ¥ç®€åŒ–ä»£ç ï¼š</p>
<pre><code class="language-python">class User(Base):
    __tablename__ = 'user'
    id = Column(Integer,primary_key=True,autoincrement=True)
    username = Column(String(50),nullable=False)

    # extend = relationship(&quot;UserExtend&quot;,uselist=False)

    def __repr__(self):
        return &quot;&lt;User(username:%s)&gt;&quot; % self.username

class UserExtend(Base):
    __tablename__ = 'user_extend'
    id = Column(Integer, primary_key=True, autoincrement=True)
    school = Column(String(50))
    uid = Column(Integer,ForeignKey(&quot;user.id&quot;))

    user = relationship(&quot;User&quot;,backref=backref(&quot;extend&quot;,uselist=False))
</code></pre>
<h3 id="å¤šå¯¹å¤šçš„å…³ç³»æ–‡ç« å’Œæ ‡ç­¾-ä¸€ä¸ªæ–‡ç« æœ‰å¤šä¸ªæ ‡ç­¾-ä¸€ä¸ªæ ‡ç­¾å¯ä»¥å±äºå¤šä¸ªæ ‡ç­¾">å¤šå¯¹å¤šçš„å…³ç³»ï¼šæ–‡ç« å’Œæ ‡ç­¾ ä¸€ä¸ªæ–‡ç« æœ‰å¤šä¸ªæ ‡ç­¾  ä¸€ä¸ªæ ‡ç­¾å¯ä»¥å±äºå¤šä¸ªæ ‡ç­¾</h3>
<ol>
<li>å¤šå¯¹å¤šçš„å…³ç³»éœ€è¦é€šè¿‡ä¸€å¼ ä¸­é—´è¡¨æ¥ç»‘å®šä»–ä»¬ä¹‹é—´çš„å…³ç³»ã€‚</li>
<li>å…ˆæŠŠä¸¤ä¸ªéœ€è¦åšå¤šå¯¹å¤šçš„æ¨¡å‹å®šä¹‰å‡ºæ¥</li>
<li>ä½¿ç”¨Tableå®šä¹‰ä¸€ä¸ªä¸­é—´è¡¨ï¼Œä¸­é—´è¡¨ä¸€èˆ¬å°±æ˜¯åŒ…å«ä¸¤ä¸ªæ¨¡å‹çš„å¤–é”®å­—æ®µå°±å¯ä»¥äº†ï¼Œå¹¶ä¸”è®©ä»–ä»¬ä¸¤ä¸ªæ¥ä½œä¸ºä¸€ä¸ªâ€œå¤åˆä¸»é”®â€ã€‚</li>
<li>åœ¨ä¸¤ä¸ªéœ€è¦åšå¤šå¯¹å¤šçš„æ¨¡å‹ä¸­éšä¾¿é€‰æ‹©ä¸€ä¸ªæ¨¡å‹ï¼Œå®šä¹‰ä¸€ä¸ªrelationshipå±æ€§ï¼Œæ¥ç»‘å®šä¸‰è€…ä¹‹é—´çš„å…³ç³»ï¼Œåœ¨ä½¿ç”¨relationshipçš„æ—¶å€™ï¼Œéœ€è¦ä¼ å…¥ä¸€ä¸ªsecondary=ä¸­é—´è¡¨ã€‚</li>
</ol>
<h3 id="ormå±‚é¢çš„åˆ é™¤æ•°æ®">ORMå±‚é¢çš„åˆ é™¤æ•°æ®ï¼š</h3>
<p>ORMå±‚é¢åˆ é™¤æ•°æ®ï¼Œä¼šæ— è§†mysqlçº§åˆ«çš„å¤–é”®çº¦æŸã€‚ç›´æ¥ä¼šå°†å¯¹åº”çš„æ•°æ®åˆ é™¤ï¼Œç„¶åå°†ä»è¡¨ä¸­çš„é‚£ä¸ªå¤–é”®è®¾ç½®ä¸ºNULLã€‚å¦‚æœæƒ³è¦é¿å…è¿™ç§è¡Œä¸ºï¼Œåº”è¯¥å°†ä»è¡¨ä¸­çš„å¤–é”®çš„<code>nullable=False</code>ã€‚<br>
åœ¨SQLAlchemyï¼Œåªè¦å°†ä¸€ä¸ªæ•°æ®æ·»åŠ åˆ°sessionä¸­ï¼Œå’Œä»–ç›¸å…³è”çš„æ•°æ®éƒ½å¯ä»¥ä¸€èµ·å­˜å…¥åˆ°æ•°æ®åº“ä¸­äº†ã€‚è¿™äº›æ˜¯æ€ä¹ˆè®¾ç½®çš„å‘¢ï¼Ÿå…¶å®æ˜¯é€šè¿‡relationshipçš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªå…³é”®å­—å‚æ•°cascadeå¯ä»¥è®¾ç½®è¿™äº›å±æ€§ï¼š</p>
<ol>
<li>save-updateï¼šé»˜è®¤é€‰é¡¹ã€‚åœ¨æ·»åŠ ä¸€æ¡æ•°æ®çš„æ—¶å€™ï¼Œä¼šæŠŠå…¶ä»–å’Œä»–ç›¸å…³è”çš„æ•°æ®éƒ½æ·»åŠ åˆ°æ•°æ®åº“ä¸­ã€‚è¿™ç§è¡Œä¸ºå°±æ˜¯save-updateå±æ€§å½±å“çš„ã€‚</li>
<li>deleteï¼šè¡¨ç¤ºå½“åˆ é™¤æŸä¸€ä¸ªæ¨¡å‹ä¸­çš„æ•°æ®çš„æ—¶å€™ï¼Œæ˜¯å¦ä¹Ÿåˆ æ‰ä½¿ç”¨relationshipå’Œä»–å…³è”çš„æ•°æ®ã€‚</li>
<li>delete-orphanï¼šè¡¨ç¤ºå½“å¯¹ä¸€ä¸ªORMå¯¹è±¡è§£é™¤äº†çˆ¶è¡¨ä¸­çš„å…³è”å¯¹è±¡çš„æ—¶å€™ï¼Œè‡ªå·±ä¾¿ä¼šè¢«åˆ é™¤æ‰ã€‚å½“ç„¶å¦‚æœçˆ¶è¡¨ä¸­çš„æ•°æ®è¢«åˆ é™¤ï¼Œè‡ªå·±ä¹Ÿä¼šè¢«åˆ é™¤ã€‚è¿™ä¸ªé€‰é¡¹åªèƒ½ç”¨åœ¨ä¸€å¯¹å¤šä¸Šï¼Œä¸èƒ½ç”¨åœ¨å¤šå¯¹å¤šä»¥åŠå¤šå¯¹ä¸€ä¸Šã€‚å¹¶ä¸”è¿˜éœ€è¦åœ¨å­æ¨¡å‹ä¸­çš„relationshipä¸­ï¼Œå¢åŠ ä¸€ä¸ªsingle_parent=Trueçš„å‚æ•°ã€‚</li>
<li>mergeï¼šé»˜è®¤é€‰é¡¹ã€‚å½“åœ¨ä½¿ç”¨session.mergeï¼Œåˆå¹¶ä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œä¼šå°†ä½¿ç”¨äº†relationshipç›¸å…³è”çš„å¯¹è±¡ä¹Ÿè¿›è¡Œmergeæ“ä½œã€‚</li>
<li>expungeï¼šç§»é™¤æ“ä½œçš„æ—¶å€™ï¼Œä¼šå°†ç›¸å…³è”çš„å¯¹è±¡ä¹Ÿè¿›è¡Œç§»é™¤ã€‚è¿™ä¸ªæ“ä½œåªæ˜¯ä»sessionä¸­ç§»é™¤ï¼Œå¹¶ä¸ä¼šçœŸæ­£çš„ä»æ•°æ®åº“ä¸­åˆ é™¤ã€‚</li>
<li>allï¼šæ˜¯å¯¹save-update, merge, refresh-expire, expunge, deleteå‡ ç§çš„ç¼©å†™ã€‚</li>
</ol>
<h3 id="æ’åº">æ’åºï¼š</h3>
<ol>
<li>
<p>order_byï¼šå¯ä»¥æŒ‡å®šæ ¹æ®è¿™ä¸ªè¡¨ä¸­çš„æŸä¸ªå­—æ®µè¿›è¡Œæ’åºï¼Œå¦‚æœåœ¨å‰é¢åŠ äº†ä¸€ä¸ª-ï¼Œä»£è¡¨çš„æ˜¯é™åºæ’åºã€‚</p>
</li>
<li>
<p>åœ¨æ¨¡å‹å®šä¹‰çš„æ—¶å€™æŒ‡å®šé»˜è®¤æ’åºï¼šæœ‰äº›æ—¶å€™ï¼Œä¸æƒ³æ¯æ¬¡åœ¨æŸ¥è¯¢çš„æ—¶å€™éƒ½æŒ‡å®šæ’åºçš„æ–¹å¼ï¼Œå¯ä»¥åœ¨å®šä¹‰æ¨¡å‹çš„æ—¶å€™å°±æŒ‡å®šæ’åºçš„æ–¹å¼ã€‚æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>relationshipçš„order_byå‚æ•°ï¼šåœ¨æŒ‡å®šrelationshipçš„æ—¶å€™ï¼Œä¼ é€’order_byå‚æ•°æ¥æŒ‡å®šæ’åºçš„å­—æ®µã€‚</li>
<li>åœ¨æ¨¡å‹å®šä¹‰ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</li>
</ul>
<p><strong>mapper_args</strong> = {<br>
â€‹     &quot;order_by&quot;: title<br>
}</p>
<p>å³å¯è®©æ–‡ç« ä½¿ç”¨æ ‡é¢˜æ¥è¿›è¡Œæ’åºã€‚</p>
</li>
<li>
<pre><code> __mapper_args__ = {    &quot;order_by&quot;:create_time.desc()} å€’åº 
</code></pre>
</li>
<li>
<p>æ­£åºæ’åºä¸å€’åºæ’åºï¼šé»˜è®¤æ˜¯ä½¿ç”¨æ­£åºæ’åºã€‚å¦‚æœéœ€è¦ä½¿ç”¨å€’åºæ’åºï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨è¿™ä¸ªå­—æ®µçš„<code>desc()</code>æ–¹æ³•ï¼Œæˆ–è€…æ˜¯åœ¨æ’åºçš„æ—¶å€™ä½¿ç”¨è¿™ä¸ªå­—æ®µçš„å­—ç¬¦ä¸²åå­—ï¼Œç„¶ååœ¨å‰é¢åŠ ä¸€ä¸ªè´Ÿå·ã€‚</p>
</li>
</ol>
<h3 id="limit-offsetå’Œåˆ‡ç‰‡æ“ä½œ">limitã€offsetå’Œåˆ‡ç‰‡æ“ä½œï¼š</h3>
<ol>
<li>limitï¼šå¯ä»¥é™åˆ¶æ¯æ¬¡æŸ¥è¯¢çš„æ—¶å€™åªæŸ¥è¯¢å‡ æ¡æ•°æ®ã€‚</li>
<li>offsetï¼šå¯ä»¥é™åˆ¶æŸ¥æ‰¾æ•°æ®çš„æ—¶å€™è¿‡æ»¤æ‰å‰é¢å¤šå°‘æ¡ã€‚</li>
<li>åˆ‡ç‰‡ï¼šå¯ä»¥å¯¹Queryå¯¹è±¡ä½¿ç”¨åˆ‡ç‰‡æ“ä½œï¼Œæ¥è·å–æƒ³è¦çš„æ•°æ®ã€‚å¯ä»¥ä½¿ç”¨<code>slice(start,stop)</code>æ–¹æ³•æ¥åšåˆ‡ç‰‡æ“ä½œã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨<code>[start:stop]</code>çš„æ–¹å¼æ¥è¿›è¡Œåˆ‡ç‰‡æ“ä½œã€‚ä¸€èˆ¬åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸­æ‹¬å·çš„å½¢å¼æ˜¯ç”¨å¾—æ¯”è¾ƒå¤šçš„ã€‚å¸Œæœ›å¤§å®¶ä¸€å®šè¦æŒæ¡ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</li>
</ol>
<pre><code class="language-python">articles = session.query(Article).order_by(Article.id.desc())[0:10]
</code></pre>
<h3 id="æ‡’åŠ è½½">æ‡’åŠ è½½ï¼š</h3>
<p>åœ¨ä¸€å¯¹å¤šï¼Œæˆ–è€…å¤šå¯¹å¤šçš„æ—¶å€™ï¼Œå¦‚æœæƒ³è¦è·å–å¤šçš„è¿™ä¸€éƒ¨åˆ†çš„æ•°æ®çš„æ—¶å€™ï¼Œå¾€å¾€èƒ½é€šè¿‡ä¸€ä¸ªå±æ€§å°±å¯ä»¥å…¨éƒ¨è·å–äº†ã€‚æ¯”å¦‚æœ‰ä¸€ä¸ªä½œè€…ï¼Œæƒ³è¦æˆ–è€…è¿™ä¸ªä½œè€…çš„æ‰€æœ‰æ–‡ç« ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡user.articleså°±å¯ä»¥è·å–æ‰€æœ‰çš„ã€‚ä½†æœ‰æ—¶å€™æˆ‘ä»¬ä¸æƒ³è·å–æ‰€æœ‰çš„æ•°æ®ï¼Œæ¯”å¦‚åªæƒ³è·å–è¿™ä¸ªä½œè€…ä»Šå¤©å‘è¡¨çš„æ–‡ç« ï¼Œé‚£ä¹ˆè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥ç»™relationshipä¼ é€’ä¸€ä¸ªlazy='dynamic'ï¼Œä»¥åé€šè¿‡user.articlesè·å–åˆ°çš„å°±ä¸æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œè€Œæ˜¯ä¸€ä¸ªAppenderQueryå¯¹è±¡äº†ã€‚è¿™æ ·å°±å¯ä»¥å¯¹è¿™ä¸ªå¯¹è±¡å†è¿›è¡Œä¸€å±‚è¿‡æ»¤å’Œæ’åºç­‰æ“ä½œã€‚<br>
é€šè¿‡<code>lazy='dynamic'</code>ï¼Œè·å–å‡ºæ¥çš„å¤šçš„é‚£ä¸€éƒ¨åˆ†çš„æ•°æ®ï¼Œå°±æ˜¯ä¸€ä¸ª<code>AppenderQuery</code>å¯¹è±¡äº†ã€‚è¿™ç§å¯¹è±¡æ—¢å¯ä»¥æ·»åŠ æ–°æ•°æ®ï¼Œä¹Ÿå¯ä»¥è·Ÿ<code>Query</code>ä¸€æ ·ï¼Œå¯ä»¥å†è¿›è¡Œä¸€å±‚è¿‡æ»¤ã€‚<br>
æ€»è€Œè¨€ä¹‹ä¸€å¥è¯ï¼šå¦‚æœä½ åœ¨è·å–æ•°æ®çš„æ—¶å€™ï¼Œæƒ³è¦å¯¹å¤šçš„é‚£ä¸€è¾¹çš„æ•°æ®å†è¿›è¡Œä¸€å±‚è¿‡æ»¤ï¼Œé‚£ä¹ˆè¿™æ—¶å€™å°±å¯ä»¥è€ƒè™‘ä½¿ç”¨<code>lazy='dynamic'</code>ã€‚<br>
lazyå¯ç”¨çš„é€‰é¡¹ï¼š</p>
<ol>
<li><code>select</code>ï¼šè¿™ä¸ªæ˜¯é»˜è®¤é€‰é¡¹ã€‚è¿˜æ˜¯æ‹¿<code>user.articles</code>çš„ä¾‹å­æ¥è®²ã€‚å¦‚æœä½ æ²¡æœ‰è®¿é—®<code>user.articles</code>è¿™ä¸ªå±æ€§ï¼Œé‚£ä¹ˆsqlalchemyå°±ä¸ä¼šä»æ•°æ®åº“ä¸­æŸ¥æ‰¾æ–‡ç« ã€‚ä¸€æ—¦ä½ è®¿é—®äº†è¿™ä¸ªå±æ€§ï¼Œé‚£ä¹ˆsqlalchemyå°±ä¼šç«‹é©¬ä»æ•°æ®åº“ä¸­æŸ¥æ‰¾æ‰€æœ‰çš„æ–‡ç« ï¼Œå¹¶æŠŠæŸ¥æ‰¾å‡ºæ¥çš„æ•°æ®ç»„è£…æˆä¸€ä¸ªåˆ—è¡¨è¿”å›ã€‚è¿™ä¹Ÿæ˜¯æ‡’åŠ è½½ã€‚</li>
<li><code>dynamic</code>ï¼šè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬åˆšåˆšè®²çš„ã€‚å°±æ˜¯åœ¨è®¿é—®<code>user.articles</code>çš„æ—¶å€™è¿”å›å›æ¥çš„ä¸æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œè€Œæ˜¯<code>AppenderQuery</code>å¯¹è±¡ã€‚</li>
</ol>
<h3 id="group_by">group_byï¼š</h3>
<p>æ ¹æ®æŸä¸ªå­—æ®µè¿›è¡Œåˆ†ç»„ã€‚æ¯”å¦‚æƒ³è¦æ ¹æ®æ€§åˆ«è¿›è¡Œåˆ†ç»„ï¼Œæ¥ç»Ÿè®¡æ¯ä¸ªåˆ†ç»„åˆ†åˆ«æœ‰å¤šå°‘äººï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç æ¥å®Œæˆï¼š</p>
<pre><code class="language-python">session.query(User.gender,func.count(User.id)).group_by(User.gender).all()
</code></pre>
<h3 id="having">havingï¼š</h3>
<p>havingæ˜¯å¯¹æŸ¥æ‰¾ç»“æœè¿›ä¸€æ­¥è¿‡æ»¤ã€‚æ¯”å¦‚åªæƒ³è¦çœ‹æœªæˆå¹´äººçš„æ•°é‡ï¼Œé‚£ä¹ˆå¯ä»¥é¦–å…ˆå¯¹å¹´é¾„è¿›è¡Œåˆ†ç»„ç»Ÿè®¡äººæ•°ï¼Œç„¶åå†å¯¹åˆ†ç»„è¿›è¡Œhavingè¿‡æ»¤ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-python">result = session.query(User.age,func.count(User.id)).group_by(User.age).having(User.age &gt;= 18).all()
</code></pre>
<h3 id="join">joinï¼š</h3>
<ol>
<li>joinåˆ†ä¸ºleft joinï¼ˆå·¦å¤–è¿æ¥ï¼‰å’Œright joinï¼ˆå³å¤–è¿æ¥ï¼‰ä»¥åŠå†…è¿æ¥ï¼ˆç­‰å€¼è¿æ¥ï¼‰ã€‚</li>
<li>å‚è€ƒçš„ç½‘é¡µï¼šhttp://www.jb51.net/article/15386.htm</li>
<li>åœ¨sqlalchemyä¸­ï¼Œä½¿ç”¨joinæ¥å®Œæˆå†…è¿æ¥ã€‚åœ¨å†™joinçš„æ—¶å€™ï¼Œå¦‚æœä¸å†™joinçš„æ¡ä»¶ï¼Œé‚£ä¹ˆé»˜è®¤å°†ä½¿ç”¨å¤–é”®æ¥ä½œä¸ºæ¡ä»¶è¿æ¥ã€‚</li>
<li>queryæŸ¥æ‰¾å‡ºæ¥ä»€ä¹ˆå€¼ï¼Œä¸ä¼šå–å†³äºjoinåé¢çš„ä¸œè¥¿ï¼Œè€Œæ˜¯å–å†³äºqueryæ–¹æ³•ä¸­ä¼ äº†ä»€ä¹ˆå‚æ•°ã€‚å°±è·ŸåŸç”Ÿsqlä¸­çš„select åé¢é‚£ä¸€ä¸ªä¸€æ ·ã€‚<br>
æ¯”å¦‚ç°åœ¨è¦å®ç°ä¸€ä¸ªåŠŸèƒ½ï¼Œè¦æŸ¥æ‰¾æ‰€æœ‰ç”¨æˆ·ï¼ŒæŒ‰ç…§å‘è¡¨æ–‡ç« çš„æ•°é‡æ¥è¿›è¡Œæ’åºã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</li>
</ol>
<pre><code class="language-python">result = session.query(User,func.count(Article.id)).join(Article).group_by(User.id).order_by(func.count(Article.id).desc()).all()
</code></pre>
<h3 id="subquery">subqueryï¼š</h3>
<p>å­æŸ¥è¯¢å¯ä»¥è®©å¤šä¸ªæŸ¥è¯¢å˜æˆä¸€ä¸ªæŸ¥è¯¢ï¼Œåªè¦æŸ¥æ‰¾ä¸€æ¬¡æ•°æ®åº“ï¼Œæ€§èƒ½ç›¸å¯¹æ¥è®²æ›´åŠ é«˜æ•ˆä¸€ç‚¹ã€‚ä¸ç”¨å†™å¤šä¸ªsqlè¯­å¥å°±å¯ä»¥å®ç°ä¸€äº›å¤æ‚çš„æŸ¥è¯¢ã€‚é‚£ä¹ˆåœ¨sqlalchemyä¸­ï¼Œè¦å®ç°ä¸€ä¸ªå­æŸ¥è¯¢ï¼Œåº”è¯¥ä½¿ç”¨ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>å°†å­æŸ¥è¯¢æŒ‰ç…§ä¼ ç»Ÿçš„æ–¹å¼å†™å¥½æŸ¥è¯¢ä»£ç ï¼Œç„¶ååœ¨<code>query</code>å¯¹è±¡åé¢æ‰§è¡Œ<code>subquery</code>æ–¹æ³•ï¼Œå°†è¿™ä¸ªæŸ¥è¯¢å˜æˆä¸€ä¸ªå­æŸ¥è¯¢ã€‚</li>
<li>åœ¨å­æŸ¥è¯¢ä¸­ï¼Œå°†ä»¥åéœ€è¦ç”¨åˆ°çš„å­—æ®µé€šè¿‡<code>label</code>æ–¹æ³•ï¼Œå–ä¸ªåˆ«åã€‚</li>
<li>åœ¨çˆ¶æŸ¥è¯¢ä¸­ï¼Œå¦‚æœæƒ³è¦ä½¿ç”¨å­æŸ¥è¯¢çš„å­—æ®µï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡å­æŸ¥è¯¢çš„è¿”å›å€¼ä¸Šçš„<code>c</code>å±æ€§æ‹¿åˆ°ã€‚<br>
æ•´ä½“çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</li>
</ol>
<pre><code class="language-python">dstmt = session.query(User.city.label(&quot;city&quot;),User.age.label(&quot;age&quot;)).filter(User.username=='æA').subquery()
result = session.query(User).filter(User.city==stmt.c.city,User.age==stmt.c.age).all()
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ä¸ªäººä¹¦ç±]]></title>
        <id>https://xiong-zh.github.io/post/ge-ren-shu-ji</id>
        <link href="https://xiong-zh.github.io/post/ge-ren-shu-ji">
        </link>
        <updated>2020-01-19T07:10:35.000Z</updated>
        <summary type="html"><![CDATA[<p>æ³¨ï¼š åœ¨å­¦ä¹ å’Œå·¥ä½œçš„è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°ä¸€äº›bugï¼Œå¤§ä½¬éš¾å¯»æˆ–ä¸€æ—¶éš¾å·²è§£å†³ï¼Œæˆ–éœ€æ±‚ä¸ç°çŠ¶å¯¹ä¸ä¸Šç­‰ä¸€ç³»åˆ—é—®é¢˜ï¼Œäºæ˜¯èŒç”Ÿäº†å†™ä¸€äº›è¾ƒå®Œæ•´æˆä½“ç³»çš„æ–‡ç« è®°å½•é‡åˆ°çš„é—®é¢˜å’Œè§£å†³ä¹‹é“çš„æ–‡ç« ã€‚æ‰€ä»¥ä¸€ä¸‹çš„ä¹¦ç±å°±è¿™æ ·å‡ºç°äº†ã€‚<br>
å…¶ä¸­è¿˜æœ‰éå¸¸å¤šçš„æƒ³æ³•è¿˜æ²¡æœ‰å®ç°ï¼Œæˆ–è€…è¿˜æ²¡æœ‰å‘ˆç°å‡ºæ¥ï¼Œæœ‰è®¸å¤šä¸å®Œç¾çš„åœ°æ–¹ï¼Œåœ¨åç»­ä¼šä¸æ–­å®ç°å¹¶åŠ ä»¥å®Œå–„ã€‚åœ¨è¿™é‡Œè¯šæ³çš„å¸Œæœ›è¯»è€…èƒ½æå‡ºå®è´µçš„æ„è§å’Œä½ çš„æœŸå¾…ï¼Œä½ å¯ä»¥é€šè¿‡æœ¬åšå®¢ä¸­ç•™çš„æ–¹å¼è”ç³»åˆ°æˆ‘ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>æ³¨ï¼š åœ¨å­¦ä¹ å’Œå·¥ä½œçš„è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°ä¸€äº›bugï¼Œå¤§ä½¬éš¾å¯»æˆ–ä¸€æ—¶éš¾å·²è§£å†³ï¼Œæˆ–éœ€æ±‚ä¸ç°çŠ¶å¯¹ä¸ä¸Šç­‰ä¸€ç³»åˆ—é—®é¢˜ï¼Œäºæ˜¯èŒç”Ÿäº†å†™ä¸€äº›è¾ƒå®Œæ•´æˆä½“ç³»çš„æ–‡ç« è®°å½•é‡åˆ°çš„é—®é¢˜å’Œè§£å†³ä¹‹é“çš„æ–‡ç« ã€‚æ‰€ä»¥ä¸€ä¸‹çš„ä¹¦ç±å°±è¿™æ ·å‡ºç°äº†ã€‚<br>
å…¶ä¸­è¿˜æœ‰éå¸¸å¤šçš„æƒ³æ³•è¿˜æ²¡æœ‰å®ç°ï¼Œæˆ–è€…è¿˜æ²¡æœ‰å‘ˆç°å‡ºæ¥ï¼Œæœ‰è®¸å¤šä¸å®Œç¾çš„åœ°æ–¹ï¼Œåœ¨åç»­ä¼šä¸æ–­å®ç°å¹¶åŠ ä»¥å®Œå–„ã€‚åœ¨è¿™é‡Œè¯šæ³çš„å¸Œæœ›è¯»è€…èƒ½æå‡ºå®è´µçš„æ„è§å’Œä½ çš„æœŸå¾…ï¼Œä½ å¯ä»¥é€šè¿‡æœ¬åšå®¢ä¸­ç•™çš„æ–¹å¼è”ç³»åˆ°æˆ‘ã€‚</p>
<!-- more -->
<p>æ³¨ï¼š åœ¨å­¦ä¹ å’Œå·¥ä½œçš„è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°ä¸€äº›bugï¼Œå¤§ä½¬éš¾å¯»æˆ–ä¸€æ—¶éš¾å·²è§£å†³ï¼Œæˆ–éœ€æ±‚ä¸ç°çŠ¶å¯¹ä¸ä¸Šç­‰ä¸€ç³»åˆ—é—®é¢˜ï¼Œäºæ˜¯èŒç”Ÿäº†å†™ä¸€äº›è¾ƒå®Œæ•´æˆä½“ç³»çš„æ–‡ç« è®°å½•é‡åˆ°çš„é—®é¢˜å’Œè§£å†³ä¹‹é“çš„æ–‡ç« ã€‚æ‰€ä»¥ä¸€ä¸‹çš„ä¹¦ç±å°±è¿™æ ·å‡ºç°äº†ã€‚<br>
å…¶ä¸­è¿˜æœ‰éå¸¸å¤šçš„æƒ³æ³•è¿˜æ²¡æœ‰å®ç°ï¼Œæˆ–è€…è¿˜æ²¡æœ‰å‘ˆç°å‡ºæ¥ï¼Œæœ‰è®¸å¤šä¸å®Œç¾çš„åœ°æ–¹ï¼Œåœ¨åç»­ä¼šä¸æ–­å®ç°å¹¶åŠ ä»¥å®Œå–„ã€‚åœ¨è¿™é‡Œè¯šæ³çš„å¸Œæœ›è¯»è€…èƒ½æå‡ºå®è´µçš„æ„è§å’Œä½ çš„æœŸå¾…ï¼Œä½ å¯ä»¥é€šè¿‡æœ¬åšå®¢ä¸­ç•™çš„æ–¹å¼è”ç³»åˆ°æˆ‘ï¼Œè·ªè°¢ğŸ™ã€‚</p>
<h2 id="æ•™ç¨‹">æ•™ç¨‹</h2>
<p><a href="https://python.zhangxiong.net">Python</a></p>
<ul>
<li>Pythonæ˜¯é‚£äº›å¯ä»¥å£°ç§°æ—¢ç®€å•åˆå¼ºå¤§çš„ç½•è§è¯­è¨€ä¹‹ä¸€ã€‚æ‚¨ä¼šæƒŠå–œåœ°å‘ç°ï¼Œä¸“æ³¨äºé—®é¢˜çš„è§£å†³æ–¹æ¡ˆè€Œä¸æ˜¯æ‚¨ç¼–ç¨‹è¯­è¨€çš„è¯­æ³•å’Œç»“æ„æ˜¯å¤šä¹ˆå®¹æ˜“ã€‚</li>
<li>Pythonæ˜¯ä¸€ç§ç®€å•è€Œç®€çº¦çš„è¯­è¨€ã€‚é˜…è¯»ä¸€ä¸ªå¥½çš„Pythonç¨‹åºæ„Ÿè§‰å°±åƒé˜…è¯»è‹±è¯­ï¼Œè™½ç„¶è‹±è¯­éå¸¸ä¸¥æ ¼ï¼Pythonçš„è¿™ç§ä¼ªä»£ç ç‰¹æ€§æ˜¯å®ƒæœ€å¤§çš„ä¼˜åŠ¿ä¹‹ä¸€ã€‚å®ƒå…è®¸æ‚¨ä¸“æ³¨äºé—®é¢˜çš„è§£å†³æ–¹æ¡ˆè€Œä¸æ˜¯è¯­è¨€æœ¬èº«ã€‚</li>
</ul>
<p><a href="https://django.zhangxiong.net">Django</a></p>
<ul>
<li>åœ¨æˆ‘ä»¬ç¼–å†™çš„æ‰€æœ‰ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å·²ç»å›´ç»•å‡½æ•°è®¾è®¡äº†æˆ‘ä»¬çš„ç¨‹åºï¼Œå³æ“ä½œæ•°æ®çš„è¯­å¥å—ã€‚è¿™ç§°ä¸ºé¢å‘è¿‡ç¨‹çš„ç¼–ç¨‹æ–¹å¼ã€‚è¿˜æœ‰å¦ä¸€ç§ç»„ç»‡ç¨‹åºçš„æ–¹æ³•ï¼Œå³ç»„åˆæ•°æ®å’ŒåŠŸèƒ½å¹¶å°†å…¶åŒ…è£…åœ¨ç§°ä¸ºå¯¹è±¡çš„å†…å®¹ä¸­ã€‚è¿™ç§°ä¸ºé¢å‘å¯¹è±¡ç¼–ç¨‹èŒƒä¾‹ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¿‡ç¨‹ç¼–ç¨‹ï¼Œä½†åœ¨ç¼–å†™å¤§å‹ç¨‹åºæˆ–é‡åˆ°æ›´é€‚åˆæ­¤æ–¹æ³•çš„é—®é¢˜æ—¶ï¼Œå¯ä»¥ä½¿ç”¨é¢å‘å¯¹è±¡çš„ç¼–ç¨‹æŠ€æœ¯ã€‚</li>
</ul>
<h2 id="æƒ³æ³•">æƒ³æ³•</h2>
<p><a href="https://yscg.zhangxiong.net">ä¸€åˆ‡éƒ½åˆšåˆšå¥½</a></p>
<ul>
<li>å…¶å®ä¹Ÿè¿‡å†™ç‚¹ä¸œè¥¿çš„å†²åŠ¨ï¼Œä½†æœ‰æ—¶å€™èº«è¾¹å†™ä½œæ¡ä»¶è¾¾ä¸åˆ°ï¼Œåˆæˆ–è€…æ€å¦‚æ³‰æ¶Œï¼Œæç¬”å¿˜å­—ï¼Œå†™å‡ºæ¥ä¹Ÿä¸å¤ªå°½å¦‚äººæ„ï¼Œå†…å¿ƒæƒ³æ³•è¡¨è¾¾ä¸å‡ºæ¥ã€‚åŒæ—¶æ„Ÿè§‰å†™äº†åªæ˜¯è‡ªå·±çœ‹ï¼Œ åˆæˆ–è€…ä¸è‡ªä¿¡ä¸æ„¿æ„åˆ†äº«ï¼Œå¸¸å¸¸ææµ…ã€‚å…¶å®è®¸å¤šäº‹éƒ½æ²¡æˆ‘ä»¬æƒ³çš„é‚£ä¹ˆéš¾ï¼Œéš¾å°±éš¾åœ¨å¯¹æœªçŸ¥çš„ææƒ§ï¼Œå®‰äºç°çŠ¶ï¼Œä¸æ•¢èµ°å‡ºèˆ’é€‚åœˆï¼Œåªè¦è·¨è¿‡äº†ï¼Œå°±ä¼šæˆä¸ºè‡ªç„¶è€Œç„¶å¯¹äº‹ã€‚</li>
</ul>
<p><a href="https://gqlx.zhangxiong.net">å½’å»æ¥å…®</a> æš‚æœªå®Œæˆ</p>
<h3 id="æ›´å¤šä½œå“æ•¬è¯·æœŸå¾…">æ›´å¤šä½œå“æ•¬è¯·æœŸå¾…Â·Â·Â·</h3>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Django urlsä¸è§†å›¾è¯¦è§£]]></title>
        <id>https://xiong-zh.github.io/post/Django-urlsä¸è§†å›¾è¯¦è§£</id>
        <link href="https://xiong-zh.github.io/post/Django-urlsä¸è§†å›¾è¯¦è§£">
        </link>
        <updated>2020-01-18T13:12:17.000Z</updated>
        <summary type="html"><![CDATA[<p>Django urlsä¸è§†å›¾è¯¦è§£</p>
]]></summary>
        <content type="html"><![CDATA[<p>Django urlsä¸è§†å›¾è¯¦è§£</p>
<!-- more -->
<h1 id="urlsä¸è§†å›¾è¯¦è§£"><code>urls</code>ä¸è§†å›¾è¯¦è§£</h1>
<blockquote>
<p>ç¯å¢ƒ <code>Windows10</code></p>
</blockquote>
<h2 id="ä¸€-å‡†å¤‡å·¥ä½œ">ä¸€ã€å‡†å¤‡å·¥ä½œ</h2>
<ul>
<li>
<p>ä½¿ç”¨ <code>virtualenvwrapper</code> åˆ›å»ºå¹¶è¿›å…¥è™šæ‹Ÿç¯å¢ƒ</p>
<pre><code>mkvirtualenv myenv
</code></pre>
</li>
<li>
<p>å®‰è£… <code>Django2.0</code></p>
<pre><code>pip install django==2.0
</code></pre>
</li>
<li>
<p>æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</p>
<pre><code>pip list
</code></pre>
</li>
<li>
<p>åˆ›å»ºä¸€ä¸ªåä¸º <code>mysite</code> çš„ <code>django</code> é¡¹ç›®</p>
<pre><code>django-admin startproject mysite
</code></pre>
</li>
<li>
<p>è¿›å…¥è™šæ‹Ÿç¯å¢ƒæ‰€åœ¨ç›®å½•</p>
<pre><code>cdvirtualenv
</code></pre>
</li>
<li>
<p>æ‰“å¼€å½“å‰ç›®å½•</p>
<pre><code>start %cd%
</code></pre>
</li>
<li>
<p>å°† <code>mysite</code> ç›®å½•æ‹–åˆ° <code>pycharm</code> æ‰“å¼€</p>
</li>
<li>
<p>è®¾ç½® <code>pycharm</code> çš„ <code>python</code> ç¯å¢ƒ</p>
</li>
</ul>
<h2 id="äºŒ-é¡¹ç›®ç»“æ„åˆ†æ">äºŒã€é¡¹ç›®ç»“æ„åˆ†æ</h2>
<ul>
<li>
<p><code>manange.py</code> é¡¹ç›®çš„ç®¡ç†ä¸äº¤äº’éƒ½åŸºäºè¿™ä¸ªæ–‡ä»¶ï¼Œ å¦‚å¯åŠ¨é¡¹ç›®ï¼š</p>
<pre><code>python manange.py runserver
</code></pre>
</li>
<li>
<p><code>__init__.py</code> è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª <code>python</code> æ¨¡å—</p>
</li>
<li>
<p><code>setting.py</code> ä¿å­˜é¡¹ç›®çš„æ‰€æœ‰é…ç½®ä¿¡æ¯</p>
</li>
<li>
<p><code>urls.py</code> ç¼–å†™è·¯ç”±ä¸è§†å›¾çš„æ˜ å°„è§„åˆ™</p>
</li>
<li>
<p><code>wsig.py</code> é¡¹ç›®éƒ¨ç½²æ–‡ä»¶</p>
</li>
</ul>
<h2 id="ä¸‰-debug-æ¨¡å¼-ä¸-allowed_hosts">ä¸‰ã€<code>DEBUG</code> æ¨¡å¼  ä¸ <code>ALLOWED_HOSTS</code></h2>
<ul>
<li>åœ¨ <code>mysite/settings.py</code> ä¸­ é»˜è®¤æ˜¯å¼€å¯äº† <code>DEBUG</code> æ¨¡å¼çš„</li>
</ul>
<pre><code>DEBUG = True
</code></pre>
<ul>
<li>
<p><code>DEBUG</code> æ¨¡å¼çš„ä½œç”¨</p>
<ul>
<li>ä¿®æ”¹åè‡ªåŠ¨é‡å¯é¡¹ç›®</li>
<li>è¯¦ç»†çš„æŠ¥é”™è¯¦ç»†</li>
</ul>
</li>
<li>
<p>å…³é—­äº† <code>DEBUG</code> æ¨¡å¼ï¼Œå¿…é¡»è®¾ç½® <code>ALLOWED_HOSTS</code>, å¦åˆ™é¡¹ç›®èµ·ä¸æ¥</p>
</li>
</ul>
<pre><code>ALLOWED_HOSTS = ['127.0.0.1', 'localhost', '192.168.0.108']
</code></pre>
<ul>
<li>
<p><code>DEBUG</code> æ¨¡å¼, é»˜è®¤æ˜¯ä»¥ <code>IP</code> <code>0.0.0.0</code> å¯åŠ¨æœåŠ¡çš„ï¼Œ ä½†åªè¦è®¾ç½®äº† <code>ALLOWED_HOSTS</code>ï¼Œ å°±åªèƒ½é€šè¿‡<code>ALLOWED_HOSTS</code> ä¸­çš„ <code>IP</code> æˆ– åŸŸåè¿›è¡Œè®¿é—®</p>
</li>
<li>
<p>å¼€å‘é˜¶æ®µï¼Œå¼€å¯ <code>DEBUG</code>, çº¿ä¸Šç¯å¢ƒå¿…é¡»å…³é—­ <code>DEBUG</code> æ¨¡å¼</p>
</li>
</ul>
<h2 id="å››-root_urlconf-è®¾ç½®-urls-åŒ¹é…çš„å…¥å£æ–‡ä»¶">å››ã€<code>ROOT_URLCONF</code> è®¾ç½® <code>urls</code> åŒ¹é…çš„å…¥å£æ–‡ä»¶</h2>
<pre><code>ROOT_URLCONF = 'mysite.urls'
</code></pre>
<h2 id="äº”-åˆè¯†è§†å›¾å‡½æ•°">äº”ã€åˆè¯†è§†å›¾å‡½æ•°</h2>
<ul>
<li>è§†å›¾å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ°¸è¿œæ˜¯ <code>HttpRequest</code> å¯¹è±¡</li>
<li>è§†å›¾å‡½æ•°åªèƒ½è¿”å› <code>HttpResponseBase</code>çš„å­ç±»å¯¹è±¡</li>
</ul>
<pre><code>from django.http import HttpResponse
def index(request):
    return HttpResponse('cmsé¦–é¡µ')
</code></pre>
<h2 id="å…­-urls-åˆ†å±‚æ¨¡å—åŒ–">å…­ã€<code>urls</code> åˆ†å±‚æ¨¡å—åŒ–</h2>
<ul>
<li>
<p>æ¯ä¸ªç‹¬ç«‹çš„æ¨¡å—å¯¹åº” <code>Django</code> çš„ä¸€ä¸ª <code>app</code></p>
</li>
<li>
<p>åˆ›å»ºä¸¤ä¸ª <code>app</code> : <code>front</code> å’Œ <code>cms</code></p>
</li>
</ul>
<pre><code>  # åˆ›å»ºå‰å°æ¨¡å—
  python manange.py startapp front

  # åˆ›å»ºåå°cmsæ¨¡å—
  python manange.py startapp cms
</code></pre>
<ul>
<li>ç¼–å†™ <code>front/views.py</code></li>
</ul>
<pre><code class="language-python"># from django.shortcuts import render
from django.http import HttpResponse
# Create your views here.
def index(request):
   return HttpResponse('å‰å°é¦–é¡µ')
</code></pre>
<ul>
<li>ç¼–å†™ <code>cms/views.py</code></li>
</ul>
<pre><code class="language-python">  # from django.shortcuts import render
from django.http import HttpResponse
def index(request):
    return HttpResponse('cmsé¦–é¡µ')
</code></pre>
<ul>
<li>åˆ›å»º <code>front/urls.py</code></li>
</ul>
<pre><code class="language-python">from django.urls import path
from . import views
app_name = 'front'
urlpatterns = [
      path('', views.index, name='index')
  ]
</code></pre>
<ul>
<li>åˆ›å»º <code>cms/urls.py</code></li>
</ul>
<pre><code class="language-python">from django.urls import path
from . import views
app_name = 'cms'
urlpatterns = [
      path('', views.index, name='index')
  ]
</code></pre>
<ul>
<li>ç¼–å†™ <code>mysite/urls.py</code></li>
</ul>
<pre><code class="language-python">from django.contrib import admin
from django.urls import path, include
urlpatterns = [
      path('admin/', admin.site.urls),
      path('', include('front.urls')),
      path('cms/', include('cms.urls')),
  ]
</code></pre>
<ul>
<li>å¯åŠ¨é¡¹ç›®</li>
</ul>
<pre><code class="language-shell"> python manange.py runserver
</code></pre>
<ul>
<li>
<p>è®¿é—® <code>front</code> åº”ç”¨ï¼š <code>http://127.0.0.1:8000</code></p>
</li>
<li>
<p>è®¿é—® <code>cms</code> åº”ç”¨ï¼š <code>http://127.0.0.1:8000/cms/</code></p>
</li>
</ul>
<h2 id="ä¸ƒ-urlä¸­çš„å‚æ•°ä¼ é€’">ä¸ƒã€<code>url</code>ä¸­çš„å‚æ•°ä¼ é€’</h2>
<ul>
<li>é€šè¿‡ <code>path</code> ä¼ é€’</li>
<li>ç¼–å†™è§†å›¾å‡½æ•° <code>front/views.py</code></li>
</ul>
<pre><code class="language-python">def detail(request, article_id):
    return HttpResponse('å½“å‰æ–‡ç« id: %s' % article_id)
</code></pre>
<ul>
<li>ç¼–å†™urls <code>front/urls.py</code></li>
</ul>
<pre><code class="language-python">path('detail/&lt;article_id&gt;', views.detail, name='detail'),
</code></pre>
<ul>
<li>
<p>è®¿é—®æ–¹å¼ï¼š <code>http://localhost:8000/detail/1</code></p>
</li>
<li>
<p>é€šè¿‡ æŸ¥è¯¢å­—ç¬¦ä¸² ä¼ é€’</p>
</li>
<li>
<p>ç¼–å†™è§†å›¾å‡½æ•° <code>front/views.py</code></p>
</li>
</ul>
<pre><code class="language-python">def article_list(request):
    author = request.GET.get('author')
    return HttpResponse('%s ç›¸å…³çš„æ–‡ç« ' % author)
</code></pre>
<ul>
<li>
<p>ç¼–å†™urls <code>front/urls.py</code></p>
<pre><code class="language-python">path('list/', views.article_list, name='list'),
</code></pre>
</li>
<li>
<p>è®¿é—®æ–¹å¼ï¼š <code>http://localhost:8000/list/?author=%E6%9D%8E%E7%99%BD</code></p>
</li>
</ul>
<h2 id="å…«-å†…ç½®çš„-path-è½¬æ¢å™¨">å…«ã€ å†…ç½®çš„ <code>path</code> è½¬æ¢å™¨</h2>
<ul>
<li><code>int</code> ç±»å‹ï¼š
<ul>
<li>
<p>å®ç°åŸç†å¦‚ä¸‹</p>
<pre><code class="language-python">class IntConverter:
  regex = '[0-9]+'

  def to_python(self, value):
      return int(value)

  def to_url(self, value):
      return str(value)
</code></pre>
</li>
<li>
<p>æ”¹å†™ <code>front/urls.py</code></p>
<pre><code class="language-python">path('detail/&lt;int:article_id&gt;', views.detail, name='detail'),
</code></pre>
</li>
<li>
<p>æ”¹å†™  <code>front/views.py</code></p>
</li>
</ul>
</li>
</ul>
<pre><code class="language-python">def detail(request, article_id):
    print(type(article_id))
    return HttpResponse('å½“å‰æ–‡ç« id: %s' % article_id)
</code></pre>
<ul>
<li>
<p>è®¿é—®ï¼š <strong>http://localhost:8000/detail/1</strong></p>
</li>
<li>
<p>æ§åˆ¶å°è¾“å‡º <code>&lt;class 'int'&gt;</code></p>
</li>
<li>
<p><code>str</code> ç±»å‹ï¼Œ é»˜è®¤ä¸æŒ‡å®šç±»å‹ï¼Œå°±æ˜¯ <code>str</code> ç±»å‹</p>
<ul>
<li>åŸç†ï¼š</li>
</ul>
</li>
</ul>
<pre><code class="language-python">class StringConverter:
    regex = '[^/]+'
    def to_python(self, value):
        return value
    def to_url(self, value):
        return value
</code></pre>
<ul>
<li><code>uuid</code> ç±»å‹ï¼Œé€šç”¨å”¯ä¸€è¯†åˆ«ç 
<ul>
<li>åŸç†ï¼š</li>
</ul>
</li>
</ul>
<pre><code class="language-python">class UUIDConverter:
    regex = '[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}'
    def to_python(self, value):
        return uuid.UUID(value)
    def to_url(self, value):
        return str(value)
</code></pre>
<ul>
<li>
<p>ç”Ÿæˆä¸€ä¸ª<code>uuid</code> å¦‚ï¼š <code>b8f12562-7006-4e21-9aeb-c3426d9dcbd3</code></p>
<pre><code class="language-shell">python

import uuid

uuid.uuid4()
</code></pre>
</li>
<li>
<p>æ”¹å†™ <code>front/urls.py</code></p>
<pre><code class="language-python">path('detail/&lt;uuid:article_id&gt;', views.detail, name='detail'),
</code></pre>
</li>
<li>
<p>è®¿é—®ï¼š <code>http://localhost:8000/detail/b8f12562-7006-4e21-9aeb-c3426d9dcbd3</code></p>
</li>
<li>
<p><code>slug</code> ç±»å‹</p>
<ul>
<li>åŸç†ï¼š</li>
</ul>
</li>
</ul>
<pre><code class="language-python">regex = '[-a-zA-Z0-9_]+'
</code></pre>
<ul>
<li><code>path</code> ç±»å‹</li>
<li>åŸç†ï¼š</li>
</ul>
<pre><code class="language-python">regex = '.+'
</code></pre>
<h2 id="ä¹-è‡ªå®šä¹‰-path-è½¬æ¢å™¨">ä¹ã€è‡ªå®šä¹‰ <code>path</code> è½¬æ¢å™¨</h2>
<p><strong>è¿™é‡Œï¼Œæˆ‘ä»¬å®ç°ä¸€ä¸ªè§„åˆ™ä¸ºï¼š python+django+flask çš„ <code>url</code> å‚æ•°ï¼Œ <code>python</code> ä»£ç æ¥æ”¶åˆ°çš„æ˜¯é€šè¿‡ <code>+</code> æ‹†åˆ†åçš„åˆ—è¡¨, è½¬æ¢å™¨æ¥æ”¶çš„å‚æ•°ä¹Ÿå¿…é¡»æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼› æ¯”è¾ƒæŠ½è±¡ï¼Œè¿˜æ˜¯çœ‹ä»£ç å§ï¼</strong></p>
<ul>
<li>åˆ›å»º <code>front/converters.py</code></li>
</ul>
<pre><code>from django.urls import register_converter
class CateConverter:
      regex = r'\w+|(\w+\+\w+)+'
      def to_python(self, value):
          return value.split('+')
      def to_url(self, value):
          if isinstance(value, list):
              return '+'.join(value)
          else:
              raise RuntimeError('åˆ†ç±»å‚æ•°å¿…é¡»ä¸º list ç±»å‹')
# æ³¨å†Œ path è½¬æ¢å™¨
    register_converter(CateConverter, 'cate')
</code></pre>
<ul>
<li>ä¿®æ”¹ <code>front/__init__.py</code></li>
</ul>
<pre><code class="language-python"># è¿è¡Œæˆ‘ä»¬è‡ªå®šä¹‰çš„è½¬æ¢å™¨
from . import converters
</code></pre>
<ul>
<li>ä¿®æ”¹ <code>front/urls.py</code></li>
</ul>
<pre><code class="language-python">path('category/&lt;cate:category&gt;/', views.index_category, name='category'),
</code></pre>
<ul>
<li>ä¿®æ”¹ <code>front/views.py</code></li>
</ul>
<pre><code>def index_category(request, category):
    pathname = reverse('front:category', kwargs={'category': category})
    return HttpResponse('åˆ†ç±»åˆ—è¡¨ä¸ºï¼š %s, url çš„ pathname éƒ¨åˆ†ä¸ºï¼š %s' % (category, pathname))
</code></pre>
<ul>
<li>è®¿é—®ï¼š <code>http://localhost:8000/category/python+django/</code>, æµè§ˆå™¨æ˜¾ç¤ºå¦‚ä¸‹ï¼š</li>
</ul>
<p><code>åˆ†ç±»åˆ—è¡¨ä¸ºï¼š ['python', 'django'], url çš„ pathname éƒ¨åˆ†ä¸ºï¼š /category/python+django/</code></p>
<h2 id="å-é‡å®šå‘-ä¸-url-å‘½ååè½¬">åã€é‡å®šå‘ ä¸ <code>url</code> å‘½ååè½¬</h2>
<blockquote>
<p>é€šè¿‡æ¨¡æ‹Ÿ <code>cms</code> åå°ç™»å½•è¿›è¡Œè®²è§£</p>
</blockquote>
<ul>
<li>ä¿®æ”¹ <code>cms/urls.py</code></li>
</ul>
<pre><code class="language-python">path('login/', views.login, name='login'),
</code></pre>
<ul>
<li>ä¿®æ”¹ <code>cms/views.py</code></li>
</ul>
<pre><code>  # from django.shortcuts import render
  from django.http import HttpResponse
  from django.shortcuts import redirect, reverse

  # Create your views here.


  def index(request):
      username = request.GET.get('username')
      if username:
          return HttpResponse('cmsé¦–é¡µ')
      else:
          # é‡å®šå‘ç™»å½•é¡µé¢
          return redirect(reverse('cms:login'))  # url å‘½ååè½¬


  def login(request):
      return HttpResponse('ç™»å½•é¡µé¢')

</code></pre>
<ul>
<li>
<p>è®¿é—®ï¼š <code>http://localhost:8000/cms/</code> ä¼šè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢</p>
</li>
<li>
<p>è®¿é—®ï¼š <code>http://localhost:8000/cms/?username=zhb33</code> æ‰èƒ½è®¿é—® <code>cms</code> åå°é¦–é¡µ</p>
</li>
<li>
<p><code>url</code> å‘½ååè½¬æ—¶çš„å‚æ•°ä¼ é€’</p>
<blockquote>
<p>å¦‚æœåè½¬æ—¶ï¼Œ<code>url</code> éœ€è¦æ¥æ”¶å‚æ•°ï¼Œ å¯é€šè¿‡å…³é”®å­—å‚æ•°ä¼ é€’ï¼Œ å¦‚æœä¼ é€’çš„æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œ éœ€è¦æ‰‹åŠ¨è¿›è¡Œæ‹¼æ¥</p>
</blockquote>
<ul>
<li>ä¿®æ”¹ <code>cms/urls.py</code></li>
</ul>
</li>
</ul>
<pre><code>  path('login/&lt;location&gt;', views.login, name='login'),
</code></pre>
<ul>
<li>ä¿®æ”¹ <code>cms/views.py</code></li>
</ul>
<pre><code>  def index(request):
    username = request.GET.get('username')
    if username:
        return HttpResponse('cmsé¦–é¡µ')
    else:
        # é‡å®šå‘ç™»å½•é¡µé¢
        login_url = reverse('cms:login', kwargs={'location': 'æ·±åœ³'})  # urlä¼ å‚
        login_url += '?next=/'  # æŸ¥è¯¢å­—ç¬¦ä¸²
        return redirect(login_url)  # url å‘½ååè½¬


  def login(request, location):
      return HttpResponse('ç™»å½•é¡µé¢, ç™»å½•åœ°ç‚¹æ˜¯ %s' % location)
</code></pre>
<ul>
<li><code>http://localhost:8000/cms/</code> è·³è½¬åˆ° <code>http://localhost:8000/cms/login/æ·±åœ³?next=/</code></li>
</ul>
<h2 id="åä¸€-urlsçš„-åº”ç”¨å‘½åç©ºé—´-ä¸-å®ä¾‹å‘½åç©ºé—´">åä¸€ã€ <code>urls</code>çš„ åº”ç”¨å‘½åç©ºé—´ ä¸ å®ä¾‹å‘½åç©ºé—´</h2>
<ul>
<li>åº”ç”¨å‘½åç©ºé—´
<ul>
<li>å¯ä»¥åœ¨æ¯ä¸ªåº”ç”¨çš„ <code>urls.py</code> é€šè¿‡ <code>app_name</code> è¿›è¡Œè®¾ç½® (ä¸€èˆ¬ä½¿ç”¨è¿™ç§æ–¹å¼è®¾ç½®)</li>
</ul>
</li>
</ul>
<pre><code>app_name = 'cms'
</code></pre>
<ul>
<li>ä¹Ÿå¯ä»¥åœ¨ <code>ROOT_URLCONF</code> æŒ‡å®šçš„ <code>urls.py</code> ä¸­ä½¿ç”¨ <code>include</code> æ—¶è¿›è¡Œè®¾ç½®(ä¸å¸¸ç”¨)</li>
</ul>
<pre><code>    # mysite/urls.py
    path('cms/', include(('cms.urls', 'cms'))),  # å¼•å…¥ cms æ¨¡å—çš„ urls.py å¹¶è®¾ç½®åº”ç”¨å‘½åç©ºé—´ ä¸º cms
</code></pre>
<ul>
<li>
<p>ä½œç”¨ï¼š å¦‚ä¸Šé¢çš„ <code>url</code> å‘½ååè½¬æ—¶ <code>reverse('cms:login')</code>, å¯ä»¥é˜²æ­¢ä¸å…¶å®ƒåº”ç”¨çš„ <code>url</code> å‘½åå†²çª</p>
</li>
<li>
<p>å®ä¾‹å‘½åç©ºé—´</p>
<ul>
<li>åœ¨é€šè¿‡ <code>include</code> å¼•ç”¨æ—¶ï¼Œè¿›è¡Œè®¾ç½®</li>
</ul>
</li>
</ul>
<pre><code>    # è®¾ç½®å®ä¾‹å‘½åç©ºé—´
    path('cms/', include('cms.urls', namespace='cms')),

    # åŒæ—¶è®¾ç½® åº”ç”¨å‘½åç©ºé—´ å’Œ å®ä¾‹å‘½åç©ºé—´
    path('cms/', include(('cms.urls', 'cms'), namespace='cms')),
</code></pre>
<ul>
<li>
<p>ä½œç”¨ï¼š å½“å¤šä¸ªä¸åŒ <code>url</code> æŒ‡å‘åŒä¸€ä¸ªåº”ç”¨æ—¶ï¼Œ é˜²æ­¢ <code>url</code> å†²çª</p>
<p><strong>ä¸ä½¿ç”¨å®ä¾‹å‘½åç©ºé—´çš„æƒ…å†µ</strong></p>
<ul>
<li>ä¿®æ”¹<code>mysite/urls.py</code></li>
</ul>
</li>
</ul>
<pre><code>      path('cms1/', include('cms.urls')),  # ä¸åŒçš„ url æŒ‡å‘åŒä¸€ä¸ª åº”ç”¨
      path('cms2/', include('cms.urls')),
</code></pre>
<pre><code>* è®¿é—® `http://localhost:8000/cms1/` è·³è½¬åˆ° `http://localhost:8000/cms1/login/æ·±åœ³?next=/`  
* è®¿é—® `http://localhost:8000/cms2/` ä¹Ÿè·³è½¬åˆ° `http://localhost:8000/cms1/login/æ·±åœ³?next=/`  

**å†²çªäº†å§ï¼**

**ä½¿ç”¨å®ä¾‹å‘½åç©ºé—´**

* ä¿®æ”¹`mysite/urls.py`
</code></pre>
<pre><code>    path('cms1/', include('cms.urls', namespace='cms1')),
    path('cms2/', include('cms.urls', namespace='cms2')),
</code></pre>
<pre><code>* ä¿®æ”¹`mysite/views.py`
</code></pre>
<pre><code>def index(request):
      username = request.GET.get('username')
      if username:
          return HttpResponse('cmsé¦–é¡µ')
      else:
          # é‡å®šå‘ç™»å½•é¡µé¢
          current_namespace = request.resolver_match.namespace
          login_url = reverse('%s:login' % current_namespace, kwargs={'location': 'æ·±åœ³'})  # urlä¼ å‚
          login_url += '?next=/'  # æŸ¥è¯¢å­—ç¬¦ä¸²
          return redirect(login_url)  # url å‘½ååè½¬
</code></pre>
<pre><code>* è®¿é—® `http://localhost:8000/cms1/` è·³è½¬åˆ° `http://localhost:8000/cms1/login/æ·±åœ³?next=/`  
* è®¿é—® `http://localhost:8000/cms2/` è·³è½¬åˆ° `http://localhost:8000/cms2/login/æ·±åœ³?next=/`
</code></pre>
<h2 id="åäºŒ-re_path-å‡½æ•°">åäºŒã€ <code>re_path</code> å‡½æ•°</h2>
<blockquote>
<p>é€šè¿‡æ­£åˆ™è¿›è¡ŒåŒ¹é…å‚æ•°</p>
</blockquote>
<p><strong>åŒ¹é…ç”Ÿæ—¥</strong></p>
<ul>
<li>ä¿®æ”¹ <code>front/urls.py</code></li>
</ul>
<pre><code>  from django.urls import path, re_path
  from . import views

  app_name = 'front'

  urlpatterns = [
      path('', views.index, name='index'),
      # ?P&lt;birthday&gt; è¡¨ç¤ºå‚æ•°ä¸º birthday åŒ¹é… \d{4}-\d{2}-\d{2}
      re_path(r'^birthday/(?P&lt;birthday&gt;\d{4}-\d{2}-\d{2})/$', views.index_birthday, name='birthday')
  ]
</code></pre>
<ul>
<li>ä¿®æ”¹ <code>front/views.py</code></li>
</ul>
<pre><code>  def index_birthday(request, birthday):
    return HttpResponse('ç”Ÿæ—¥å¿«ä¹ %s' % birthday)
</code></pre>
<ul>
<li>
<p>è®¿é—®ï¼š <code>http://localhost:8000/birthday/1992-12-28/</code></p>
</li>
<li>
<p>èƒ½ç”¨ <code>path</code> è§£å†³çš„é—®é¢˜ï¼Œ å°½é‡ä¸è¦ç”¨ <code>re_path</code> å› ä¸º <code>re_path</code> å¯è¯»æ€§å·®</p>
</li>
</ul>
<h2 id="åä¸‰-é»˜è®¤å‚æ•°">åä¸‰ã€é»˜è®¤å‚æ•°</h2>
<p><strong>è¦å®ç°é»˜è®¤å‚æ•°ï¼Œéœ€è¦ä¸¤æ¡ <code>url</code> çš„é…åˆ</strong></p>
<ul>
<li>ä¿®æ”¹ <code>front/urls.py</code></li>
</ul>
<pre><code> from django.urls import path, re_path
 from . import views

 app_name = 'front'

 urlpatterns = [
     path('', views.index_list, name='index'),
     path('list/&lt;int:category_id&gt;', views.index_list, name='list'),
 ]
</code></pre>
<ul>
<li>ä¿®æ”¹ <code>front/views.py</code></li>
</ul>
<pre><code class="language-python">from django.http import HttpResponse
category = ['python', 'django', 'flask']

def index_list(request, category_id=0):
      return HttpResponse(category[category_id])
</code></pre>
<ul>
<li>
<p>è®¿é—®ï¼š <code>http://localhost:8000</code>, æ˜¾ç¤º:<br>
<code>python</code></p>
</li>
<li>
<p>è®¿é—®ï¼š <code>http://localhost:8000/list/2</code>, æ˜¾ç¤ºï¼š<br>
<code>flask</code></p>
</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Djangoæ¨¡æ¿ä¸­åŠ è½½é™æ€æ–‡ä»¶]]></title>
        <id>https://xiong-zh.github.io/post/Djangoæ¨¡æ¿ä¸­åŠ è½½é™æ€æ–‡ä»¶</id>
        <link href="https://xiong-zh.github.io/post/Djangoæ¨¡æ¿ä¸­åŠ è½½é™æ€æ–‡ä»¶">
        </link>
        <updated>2020-01-18T13:11:05.000Z</updated>
        <summary type="html"><![CDATA[<p>Djangoæ¨¡æ¿ä¸­åŠ è½½é™æ€æ–‡ä»¶</p>
]]></summary>
        <content type="html"><![CDATA[<p>Djangoæ¨¡æ¿ä¸­åŠ è½½é™æ€æ–‡ä»¶</p>
<!-- more -->
<h1 id="æ¨¡æ¿ä¸­åŠ è½½é™æ€æ–‡ä»¶">æ¨¡æ¿ä¸­åŠ è½½é™æ€æ–‡ä»¶</h1>
<blockquote>
<p>æ¥ç€ <a href="https://zhb333.github.io/readme-blog/Python/Django/templates_4.html">æ¨¡æ¿ç»“æ„ä¼˜åŒ–</a> å¾€ä¸‹è®²</p>
</blockquote>
<ul>
<li>
<p>ç¡®ä¿<code>mysite/setting.py</code> ä¸­ <code>INSTALLED_APPS</code> å·²ç»å®‰è£…äº† <code>django.contrib.staticfiles</code></p>
</li>
<li>
<p>ç¡®ä¿ <code>mysite/setting.py</code> ä¸­è®¾ç½®äº† <code>STATIC_URL</code></p>
</li>
<li>
<p>åœ¨å·²ç»å®‰è£…çš„ <code>app</code> ä¸‹åˆ›å»º <code>static</code> æ–‡ä»¶å¤¹ï¼Œå¹¶å°†è¯¥åº”ç”¨çš„é™æ€èµ„æºå­˜æ”¾åœ¨é‡Œé¢ : <code>front/static/suolong.jpg</code></p>
<p><code>templates/index.html</code></p>
</li>
</ul>
<pre><code class="language-html">  {% block content %}
      &lt;img src=&quot;/static/suolong.jpg&quot; alt=&quot;suolong&quot;&gt;
  {% endblock %}
</code></pre>
<ul>
<li>
<p><code>mysite/setting.py</code> ä¸­ <code>STATIC_URL</code> å€¼æ˜¯å¯å˜çš„ï¼Œè¿™æ ·ä»¥åå¼•ç”¨é™æ€èµ„æºçš„è·¯å¾„éƒ½è¦æ ¹æ® <code>STATIC_URL</code> æ˜¯æ–°å€¼å»ä¿®æ”¹ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä½¿ç”¨ <code>{% load static %}</code></p>
<p><code>templates/index.html</code></p>
</li>
</ul>
<pre><code>  {% extends 'base.html' %}
  {% load static %}

  {% block content %}
      &lt;img src=&quot;{% static 'suolong.jpg' %}&quot; alt=&quot;suolong&quot;&gt;
  {% endblock %}
</code></pre>
<ul>
<li>
<p>å…¬å…±èµ„æºè·¯å¾„</p>
<p>åœ¨æ›´ç›®å½•ä¸‹åˆ›å»º <code>static</code> æ–‡ä»¶å¤¹</p>
<p><code>static/style.css</code></p>
</li>
</ul>
<pre><code>  body {
      background-color: #abcdef;
  }
</code></pre>
<p><code>mysite/setting.py</code></p>
<pre><code>  STATICFILES_DIRS = (
      os.path.join(BASE_DIR, 'static'),
  )
</code></pre>
<p><code>mysite/base.html</code></p>
<pre><code>  {% load static %}
  &lt;!DOCTYPE html&gt;
  &lt;html lang=&quot;en&quot;&gt;
  &lt;head&gt;
      &lt;meta charset=&quot;UTF-8&quot;&gt;
      &lt;title&gt;Title&lt;/title&gt;
      &lt;link rel=&quot;stylesheet&quot; href=&quot;{% static 'style.css' %}&quot;&gt;
  &lt;/head&gt;
</code></pre>
<ul>
<li>
<p>åœ¨æ¯ä¸ªéœ€è¦åŠ è½½é™æ€èµ„æºæ–‡ä»¶çš„æ¨¡æ¿ä¸­éƒ½è¦å†™ <code>{% load static %}</code>, ä¸ºäº†ä¸åœ¨æ¯ä¸ªæ¨¡æ¿ä¸­éƒ½å†™ï¼Œæˆ‘ä»¬å¯ä»¥å§ <code>static</code> å˜ä¸º <code>DTL</code> æ¨¡æ¿æ ‡ç­¾</p>
<p><code>mysite/setting.py</code></p>
</li>
</ul>
<pre><code>  TEMPLATES = [
      {
        'OPTIONS': {
            'builtins': [
                'django.templatetags.static'
            ]
        },
      },
  ]
</code></pre>
<p><strong>è¿™æ ·å°±ä¸ç”¨åœ¨æ¯ä¸ªé¡µé¢ä¸­å¼•å…¥<code>{% load static %}</code></strong></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Djangoæ¨¡æ¿ç»“æ„ä¼˜åŒ–]]></title>
        <id>https://xiong-zh.github.io/post/Djangoæ¨¡æ¿ç»“æ„ä¼˜åŒ–</id>
        <link href="https://xiong-zh.github.io/post/Djangoæ¨¡æ¿ç»“æ„ä¼˜åŒ–">
        </link>
        <updated>2020-01-18T13:09:55.000Z</updated>
        <summary type="html"><![CDATA[<p>Djangoæ¨¡æ¿ç»“æ„ä¼˜åŒ–</p>
]]></summary>
        <content type="html"><![CDATA[<p>Djangoæ¨¡æ¿ç»“æ„ä¼˜åŒ–</p>
<!-- more -->
<h1 id="dtl-æ¨¡æ¿ç»“æ„ä¼˜åŒ–"><code>DTL</code> æ¨¡æ¿ç»“æ„ä¼˜åŒ–</h1>
<h2 id="ä¸€-å¼•å…¥æ¨¡æ¿">ä¸€ã€å¼•å…¥æ¨¡æ¿</h2>
<h3 id="include-æ ‡ç­¾çš„ä½¿ç”¨"><code>include</code> æ ‡ç­¾çš„ä½¿ç”¨</h3>
<ul>
<li>
<p>æ–°å»º <code>templates/header.html</code></p>
<pre><code>&lt;header&gt;å¤´éƒ¨&lt;/header&gt;
</code></pre>
</li>
<li>
<p>æ–°å»º <code>templates/footer.html</code></p>
<pre><code>&lt;footer&gt;å°¾éƒ¨&lt;/footer&gt;
</code></pre>
</li>
<li>
<p>ä¿®æ”¹ <code>templates/index.html</code></p>
</li>
</ul>
<pre><code>    &lt;body&gt;
    {% include 'header.html' %}
    &lt;div&gt;å†…å®¹&lt;/div&gt;
    {% include 'footer.html' %}
    &lt;/body&gt;
</code></pre>
<h3 id="include-æ ‡ç­¾ä¸­çš„æ¨¡æ¿æŸ¥æ‰¾è·¯å¾„"><code>include</code> æ ‡ç­¾ä¸­çš„æ¨¡æ¿æŸ¥æ‰¾è·¯å¾„</h3>
<p><strong>å‚ç…§ <a href="http://localhost:8080/readme-blog/Python/Django/templates_1.html#%E4%B8%80%E3%80%81%E6%A8%A1%E6%9D%BF%E6%9F%A5%E6%89%BE%E8%B7%AF%E5%BE%84">render_to_stringçš„æ¨¡æ¿æŸ¥æ‰¾è·¯å¾„</a></strong></p>
<h3 id="include-æ ‡ç­¾å¼•å…¥çš„æ¨¡æ¿å¯ä»¥å¼•ç”¨å½“å‰æ¨¡æ¿ä¸­çš„å˜é‡"><code>include</code> æ ‡ç­¾å¼•å…¥çš„æ¨¡æ¿å¯ä»¥å¼•ç”¨å½“å‰æ¨¡æ¿ä¸­çš„å˜é‡</h3>
<ul>
<li>ä¿®æ”¹ <code>front/views.py</code></li>
</ul>
<pre><code>    def index(request):
        context = {
            'title': 'Django'
        }
        return render(request, 'index.html', context=context)
</code></pre>
<ul>
<li>
<p>ä¿®æ”¹ <code>templates/header.html</code></p>
<pre><code>{#å¤´éƒ¨ Django#}
&lt;header&gt;å¤´éƒ¨ {{ title }}&lt;/header&gt;
</code></pre>
</li>
<li>
<p>ä½†ä¸ºäº†æ‰€æœ‰å¼•ç”¨ <code>templates/header.html</code> çš„æ¨¡æ¿éƒ½èƒ½ä½¿ç”¨ <code>title</code> å˜é‡ï¼Œ å¯ä»¥åœ¨ <code>include</code> æ ‡ç­¾ä¸­ä¼ é€’è¯¥å˜é‡</p>
<p>ä¿®æ”¹ <code>templates/index.html</code></p>
<pre><code>{#å¤´éƒ¨ Young and Beautiful#}
{% include 'header.html' with title='Young and Beautiful' %}
</code></pre>
</li>
</ul>
<h2 id="äºŒ-æ¨¡æ¿ç»§æ‰¿">äºŒã€æ¨¡æ¿ç»§æ‰¿</h2>
<ul>
<li>æ–°å»º <code>templates/base.html</code>ï¼š</li>
</ul>
<pre><code>    &lt;body&gt;
    {% include 'header.html' with title='Young and Beautiful' %}
    &lt;div&gt;
        {% block content %}
            é»˜è®¤å†…å®¹
        {% endblock %}
    &lt;/div&gt;
    {% include 'footer.html' %}
    &lt;/body&gt;
</code></pre>
<ul>
<li>ä¿®æ”¹ <code>templates/index.html</code>:</li>
</ul>
<pre><code>    {% extends 'base.html' %}

    {% block content %}
    é¦–é¡µä¸­çš„å†…å®¹
    {% endblock %}
</code></pre>
<ul>
<li>
<p>è®¿é—® <code>block</code> æ ‡ç­¾è¢«è¦†ç›–çš„å†…å®¹ï¼š</p>
<p><code>templates/index.html</code>:</p>
</li>
</ul>
<pre><code>    {% extends 'base.html' %}

    {% block content %}
    é¦–é¡µä¸­çš„å†…å®¹
    &lt;p&gt;{{ block.super }}&lt;/p&gt;
    {% endblock %}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Djangoè‡ªå®šä¹‰æ¨¡æ¿è¿‡æ»¤å™¨]]></title>
        <id>https://xiong-zh.github.io/post/Djangoè‡ªå®šä¹‰æ¨¡æ¿è¿‡æ»¤å™¨</id>
        <link href="https://xiong-zh.github.io/post/Djangoè‡ªå®šä¹‰æ¨¡æ¿è¿‡æ»¤å™¨">
        </link>
        <updated>2020-01-18T13:08:18.000Z</updated>
        <summary type="html"><![CDATA[<p>Djangoè‡ªå®šä¹‰æ¨¡æ¿è¿‡æ»¤å™¨</p>
]]></summary>
        <content type="html"><![CDATA[<p>Djangoè‡ªå®šä¹‰æ¨¡æ¿è¿‡æ»¤å™¨</p>
<!-- more -->
<h1 id="dtl-è‡ªå®šä¹‰æ¨¡æ¿è¿‡æ»¤å™¨"><code>DTL</code> è‡ªå®šä¹‰æ¨¡æ¿è¿‡æ»¤å™¨</h1>
<h2 id="ä¸€-æ¨¡æ¿è¿‡æ»¤å™¨çš„å®šä¹‰">ä¸€ã€æ¨¡æ¿è¿‡æ»¤å™¨çš„å®šä¹‰</h2>
<ul>
<li>
<p>åœ¨åº”ç”¨çš„ç›®å½•ä¸‹ï¼Œå¦‚ <code>front</code> ä¸‹ï¼Œ æ–°å»ºä¸€ä¸ªåä¸ºï¼š <code>templatetags</code> çš„ <code>python</code> åŒ…</p>
</li>
<li>
<p>æ–°å»º <code>front/templatetags/custom_filter.py</code>, å¹¶å®šä¹‰ä¸¤ä¸ªæ¨¡æ¿è¿‡æ»¤å™¨å¦‚ä¸‹ï¼š</p>
</li>
</ul>
<pre><code>  from django import template

  register = template.Library()


  def my_add(value, arg):
      try:
          return value + arg
      except (Exception,):
          return ''


  def my_upper(value):
      try:
          return value.upper()
      except (Exception,):
          return value


  register.filter('my_add', my_add)
  register.filter('my_upper', my_upper)
</code></pre>
<ul>
<li>
<p>éœ€è¦ä½¿ç”¨ <code>{% load custom_filter %}</code>, æŠŠåº”ç”¨ä¸‹å®šä¹‰æ¨¡æ¿è¿‡æ»¤å™¨çš„æ–‡ä»¶å¯¼å…¥æ¨¡æ¿</p>
</li>
<li>
<p><code>templates/index.html</code> ä»£ç ä¿®æ”¹å¦‚ä¸‹ï¼š</p>
</li>
</ul>
<pre><code>  {% load custom_filter %}
  &lt;!DOCTYPE html&gt;
  &lt;html lang=&quot;en&quot;&gt;
  &lt;head&gt;
      &lt;meta charset=&quot;UTF-8&quot;&gt;
      &lt;title&gt;Title&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
  {#abcdef#}
  {{ &quot;abc&quot;|my_add:&quot;def&quot; }} &lt;br&gt;
  {#HELLO#}
  {{ &quot;hello&quot;|my_upper }}
  &lt;/body&gt;
  &lt;/html&gt;
</code></pre>
<ul>
<li>*<em>æ³¨æ„ï¼Œ<code>front</code> åº”ç”¨å¿…é¡»åœ¨ <code>mysite/settings.py</code> è¿›è¡Œæ³¨å†Œï¼Œåœ¨ <code>front</code> ä¸‹å®šä¹‰çš„æ¨¡æ¿è¿‡æ»¤å™¨æ‰èƒ½èµ·ä½œç”¨</em></li>
</ul>
<pre><code>  INSTALLED_APPS = [
      'front',
  ]
</code></pre>
<h2 id="äºŒ-å®æˆ˜-è‡ªå®šä¹‰æ—¶é—´è®¡ç®—è¿‡æ»¤å™¨">äºŒã€å®æˆ˜--è‡ªå®šä¹‰æ—¶é—´è®¡ç®—è¿‡æ»¤å™¨</h2>
<p><code>front/templatetags/custom_filter.py</code></p>
<pre><code>from django import template
from datetime import datetime

register = template.Library()


@register.filter
def time_since(value):
    &quot;&quot;&quot;
    timeè·ç¦»ç°åœ¨çš„æ—¶é—´é—´éš”
    1 å¦‚æœæ—¶é—´é—´éš”å°äº1åˆ†é’Ÿï¼Œé‚£ä¹ˆæ˜¾ç¤º åˆšåˆš
    2 å¦‚æœæ—¶é—´é—´éš”å¤§äº1åˆ†é’Ÿå°äº1å°æ—¶ï¼Œ é‚£ä¹ˆæ˜¾ç¤º xx åˆ†é’Ÿå‰
    3 å¦‚æœæ˜¯å¤§äº1å°æ—¶å°äº24å°æ—¶ï¼Œé‚£ä¹ˆæ˜¾ç¤º xx å°æ—¶å‰
    4 å¦‚æœå¤§äº24å°æ—¶ï¼Œå°äº30å¤©ï¼Œ é‚£ä¹ˆæ˜¾ç¤º xx å¤©å‰
    5 å¦åˆ™æ˜¾ç¤ºå…·ä½“æ—¶é—´ï¼Œ 2018/12/10 23:05
    &quot;&quot;&quot;
    if not isinstance(value, datetime):
        return value
    now = datetime.now()
    timestamp = (now - value).total_seconds()
    if timestamp &lt; 60:
        return 'åˆšåˆš'
    elif 60 &lt;= timestamp &lt; 60 * 60:
        minutes = int(timestamp/60)
        return '%såˆ†é’Ÿå‰' % minutes
    elif 60 * 60 &lt;= timestamp &lt; 60 * 60 * 24:
        hour = int(timestamp / (60 * 60))
        return '%s å°æ—¶å‰' % hour
    elif 60 * 60 * 24 &lt;= timestamp &lt; 60 * 60 * 24 * 30:
        days = int(timestamp / (60 * 60 * 24))
        return '%s å¤©å‰' % days
    else:
        return value.strftime(&quot;%Y/%m/%d %H:%M&quot;)
</code></pre>
<p><code>front/views.py</code></p>
<pre><code>from django.shortcuts import render
from datetime import datetime


def index(request):
    context = {
        'my_time_1': datetime.now(),
        'my_time_2': datetime(year=2018, month=12, day=10, hour=23, minute=18),
        'my_time_3': datetime(year=2018, month=12, day=10, hour=18, minute=18),
        'my_time_4': datetime(year=2018, month=12, day=1, hour=22, minute=18),
        'my_time_5': datetime(year=2017, month=12, day=10, hour=23, minute=18),
    }
    return render(request, 'index.html', context=context)
</code></pre>
<p><code>templates/index.html</code></p>
<pre><code>{% load custom_filter %}
&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
{#åˆšåˆš #}
{{ my_time_1|time_since }} &lt;br&gt;
{#7åˆ†é’Ÿå‰ #}
{{ my_time_2|time_since }} &lt;br&gt;
{#5 å°æ—¶å‰ #}
{{ my_time_3|time_since }} &lt;br&gt;
{#9 å¤©å‰ #}
{{ my_time_4|time_since }} &lt;br&gt;
{#2017/12/10 23:18#}
{{ my_time_5|time_since }}
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Djangoæ¨¡æ¿è¿‡æ»¤å™¨è¯¦è§£]]></title>
        <id>https://xiong-zh.github.io/post/Djangoæ¨¡æ¿è¿‡æ»¤å™¨è¯¦è§£</id>
        <link href="https://xiong-zh.github.io/post/Djangoæ¨¡æ¿è¿‡æ»¤å™¨è¯¦è§£">
        </link>
        <updated>2020-01-18T13:06:44.000Z</updated>
        <summary type="html"><![CDATA[<p>Djangoæ¨¡æ¿è¿‡æ»¤å™¨è¯¦è§£</p>
]]></summary>
        <content type="html"><![CDATA[<p>Djangoæ¨¡æ¿è¿‡æ»¤å™¨è¯¦è§£</p>
<!-- more -->
<h1 id="dtl-æ¨¡æ¿è¿‡æ»¤å™¨"><code>DTL</code> æ¨¡æ¿è¿‡æ»¤å™¨</h1>
<h2 id="add"><code>add</code></h2>
<ul>
<li>åŸç†ï¼š</li>
</ul>
<pre><code>  def add(value, arg):
    &quot;&quot;&quot;Add the arg to the value&quot;&quot;&quot;
    try:
      return int(value) + int(arg)
    except (ValueError, TypeError):
      try:
        return value + arg
      except Exception:
        return ''
</code></pre>
<ul>
<li>ä½¿ç”¨<br>
<code>front/views.py</code></li>
</ul>
<pre><code>  def index(request):
    context = {
        &quot;number&quot;: 1,
        &quot;persons&quot;: ['baby', 'dear'],
        &quot;girls&quot;: ['å®å®', 'äº²çˆ±çš„']
    }
    return render(request, 'index.html', context=context)
</code></pre>
<p><code>templates/index.html</code></p>
<pre><code>{#æ•°å­—ç›¸åŠ #}
{{ number|add:&quot;2&quot; }} &lt;br&gt;
{#å­—ç¬¦ä¸²æ‹¼æ¥#}
{{ number|add:'abc' }} &lt;br&gt;
{#åˆ—è¡¨æ‹¼æ¥#}
{{ persons|add:girls }}
</code></pre>
<h2 id="cut"><code>cut</code></h2>
<ul>
<li>
<p>åŸç†ï¼š</p>
<pre><code>def cut(vaule, arg):
  &quot;&quot;&quot;Remove all values of arg from the given string&quot;&quot;&quot;
  safe = isinstance(value, SafeData)
  value = value.replace(arg, '')
  if safe and arg != ';':
    return mark_safe(value)
  return value
</code></pre>
</li>
<li>
<p>ä½¿ç”¨<br>
<code>templates/index.html</code></p>
<pre><code>{# å»é™¤å­—ç¬¦ä¸²ä¸­ç©ºæ ¼ #}
{{ &quot;This is ten percent luck, twenty percent skill&quot;|cut:&quot; &quot; }}
</code></pre>
</li>
</ul>
<h2 id="date"><code>date</code></h2>
<ul>
<li>
<p>æ‰€æœ‰æ ¼å¼</p>
<table>
<thead>
<tr>
<th style="text-align:center">æ ¼å¼å­—ç¬¦</th>
<th style="text-align:center">æè¿°</th>
<th style="text-align:center">ç¤ºä¾‹è¾“å‡º</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">a</td>
<td style="text-align:center">'a.m.' æˆ– 'p.m.' ï¼ˆè¯·æ³¨æ„ï¼Œè¿™ä¸PHPè¾“å‡ºç•¥æœ‰ä¸åŒï¼Œå› ä¸ºè¿™åŒ…æ‹¬ä¸Associated Pressæ ·å¼åŒ¹é…çš„å¥ç‚¹ã€‚ï¼‰</td>
<td style="text-align:center">'a.m.'</td>
</tr>
<tr>
<td style="text-align:center">A</td>
<td style="text-align:center">'AM' æˆ– 'PM'ã€‚</td>
<td style="text-align:center">'a.m.'</td>
</tr>
<tr>
<td style="text-align:center">b</td>
<td style="text-align:center">æœˆï¼Œæ–‡å­—ï¼Œ3ä¸ªå­—æ¯ï¼Œå°å†™ã€‚</td>
<td style="text-align:center">'jan'</td>
</tr>
<tr>
<td style="text-align:center">B</td>
<td style="text-align:center">æœªå®ç°ã€‚</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">c</td>
<td style="text-align:center">ISO 8601æ ¼å¼ã€‚ ï¼ˆæ³¨æ„ï¼šä¸å…¶ä»–æ ¼å¼åŒ–ç¨‹åºï¼Œå¦‚â€œZâ€ï¼Œâ€œOâ€æˆ–â€œrâ€ä¸åŒï¼Œå¦‚æœå€¼æ˜¯ä¸€ä¸ªå¤©çœŸçš„datetimeï¼ˆè§ datetime.tzinfoï¼‰ï¼Œâ€œcâ€æ ¼å¼åŒ–ç¨‹åºä¸ä¼šæ·»åŠ æ—¶åŒºåç§»ã€‚</td>
<td style="text-align:center">2008-01-02T10:30:00.000123+02:00 æˆ– 2008-01-02T10:30:00.000123 ï¼ˆå¦‚æœdatetimeæ˜¯å¤©çœŸçš„ï¼‰</td>
</tr>
<tr>
<td style="text-align:center">d</td>
<td style="text-align:center">æœˆçš„æ—¥æœŸï¼Œå¸¦å‰å¯¼é›¶çš„2ä½æ•°å­—ã€‚</td>
<td style="text-align:center">'01' åˆ° '31'</td>
</tr>
<tr>
<td style="text-align:center">D</td>
<td style="text-align:center">æ˜ŸæœŸå‡ ï¼Œæ–‡å­—ï¼Œ3ä¸ªå­—æ¯ã€‚</td>
<td style="text-align:center">'Fri'</td>
</tr>
<tr>
<td style="text-align:center">e</td>
<td style="text-align:center">æ—¶åŒºåç§°ã€‚å¯ä»¥æ˜¯ä»»ä½•æ ¼å¼ï¼Œæˆ–å¯èƒ½è¿”å›ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼Œå…·ä½“å–å†³äºdatetimeã€‚</td>
<td style="text-align:center">''ï¼Œ'GMT'ï¼Œ'-500'ï¼Œ'US/Eastern' ç­‰ã€‚</td>
</tr>
<tr>
<td style="text-align:center">E</td>
<td style="text-align:center">æœˆï¼Œç‰¹å®šäºè¯­è¨€ç¯å¢ƒçš„æ›¿ä»£è¡¨ç¤ºï¼Œé€šå¸¸ç”¨äºé•¿æ—¥æœŸè¡¨ç¤ºã€‚</td>
<td style="text-align:center">'listopada' ï¼ˆå¯¹äºæ³¢å…°è¯­åŒºåŸŸï¼Œè€Œä¸æ˜¯ 'Listopad'ï¼‰</td>
</tr>
<tr>
<td style="text-align:center">f</td>
<td style="text-align:center">æ—¶é—´ï¼Œ12å°æ—¶å°æ—¶å’Œåˆ†é’Ÿï¼Œå¦‚æœä»–ä»¬ä¸ºé›¶ï¼Œåˆ†é’Ÿå°†å…³é—­ã€‚ä¸“æœ‰æ‰©å±•ã€‚</td>
<td style="text-align:center">'1'ï¼Œ'1:30'</td>
</tr>
<tr>
<td style="text-align:center">F</td>
<td style="text-align:center">æœˆï¼Œæ–‡å­—ï¼Œé•¿ã€‚</td>
<td style="text-align:center">'January'</td>
</tr>
<tr>
<td style="text-align:center">g</td>
<td style="text-align:center">å°æ—¶ï¼Œ12å°æ—¶æ ¼å¼ï¼Œä¸å«å‰å¯¼é›¶ã€‚</td>
<td style="text-align:center">'1' åˆ° '12'</td>
</tr>
<tr>
<td style="text-align:center">G</td>
<td style="text-align:center">å°æ—¶ï¼Œ24å°æ—¶æ ¼å¼ï¼Œæ— å‰å¯¼é›¶ã€‚</td>
<td style="text-align:center">'0' åˆ° '23'</td>
</tr>
<tr>
<td style="text-align:center">h</td>
<td style="text-align:center">å°æ—¶ï¼Œ12å°æ—¶æ ¼å¼ã€‚</td>
<td style="text-align:center">'01' åˆ° '12'</td>
</tr>
<tr>
<td style="text-align:center">H</td>
<td style="text-align:center">å°æ—¶ï¼Œ24å°æ—¶æ ¼å¼ã€‚</td>
<td style="text-align:center">'00' åˆ° '23'</td>
</tr>
<tr>
<td style="text-align:center">i</td>
<td style="text-align:center">åˆ†é’Ÿã€‚</td>
<td style="text-align:center">'00' åˆ° '59'</td>
</tr>
<tr>
<td style="text-align:center">I</td>
<td style="text-align:center">å¤ä»¤æ—¶ï¼Œæ— è®ºæ˜¯å¦ç”Ÿæ•ˆã€‚</td>
<td style="text-align:center">'1' æˆ– '0'</td>
</tr>
<tr>
<td style="text-align:center">j</td>
<td style="text-align:center">æ²¡æœ‰å‰å¯¼é›¶çš„æœˆä»½æ—¥ã€‚</td>
<td style="text-align:center">'1' åˆ° '31'</td>
</tr>
<tr>
<td style="text-align:center">l</td>
<td style="text-align:center">æ˜ŸæœŸå‡ ï¼Œæ–‡å­—ï¼Œé•¿ã€‚</td>
<td style="text-align:center">'Friday'</td>
</tr>
<tr>
<td style="text-align:center">L</td>
<td style="text-align:center">æ˜¯å¦ä¸ºé—°å¹´çš„å¸ƒå°”å€¼ã€‚</td>
<td style="text-align:center">True æˆ– False</td>
</tr>
<tr>
<td style="text-align:center">m</td>
<td style="text-align:center">æœˆï¼Œ2ä½æ•°å­—ï¼Œå‰å¯¼é›¶ã€‚</td>
<td style="text-align:center">'01' åˆ° '12'</td>
</tr>
<tr>
<td style="text-align:center">M</td>
<td style="text-align:center">æœˆï¼Œæ–‡å­—ï¼Œ3ä¸ªå­—æ¯ã€‚</td>
<td style="text-align:center">'Jan'</td>
</tr>
<tr>
<td style="text-align:center">n</td>
<td style="text-align:center">æ²¡æœ‰å‰å¯¼é›¶çš„æœˆã€‚</td>
<td style="text-align:center">'1' åˆ° '12'</td>
</tr>
<tr>
<td style="text-align:center">N</td>
<td style="text-align:center">æœˆç¼©å†™åœ¨Associated Pressé£æ ¼ã€‚ä¸“æœ‰æ‰©å±•ã€‚</td>
<td style="text-align:center">'Jan.'ï¼Œ'Feb.'ï¼Œ'March'ï¼Œ'May'</td>
</tr>
<tr>
<td style="text-align:center">o</td>
<td style="text-align:center">ISO-8601å‘¨ç¼–å·å¹´ï¼Œå¯¹åº”äºä½¿ç”¨é—°å¹´çš„ISO-8601å‘¨ç¼–å·ï¼ˆWï¼‰ã€‚æ›´å¸¸è§çš„å¹´ä»½æ ¼å¼è§Yã€‚</td>
<td style="text-align:center">'1999'</td>
</tr>
<tr>
<td style="text-align:center">O</td>
<td style="text-align:center">ä¸æ ¼æ—å¨æ²»æ—¶é—´çš„å·®å€¼ï¼ˆä»¥å°æ—¶ä¸ºå•ä½ï¼‰ã€‚</td>
<td style="text-align:center">'+0200'</td>
</tr>
<tr>
<td style="text-align:center">P</td>
<td style="text-align:center">æ—¶é—´ï¼Œ12å°æ—¶åˆ¶ï¼Œåˆ†é’Ÿå’Œâ€™a.mã€‚â€™/â€™p.mã€‚â€™ï¼Œå¦‚æœå®ƒä»¬ä¸ºé›¶ï¼Œåˆ†é’Ÿå°†å…³é—­ï¼Œå¦‚æœåˆé€‚ï¼Œåˆ†é’Ÿå°†ä¿ç•™ç‰¹æ®Šå­—ç¬¦ä¸²â€™åˆå¤œâ€™å’Œâ€™ä¸­åˆâ€™ã€‚ä¸“</td>
<td style="text-align:center">æœ‰æ‰©å±•ã€‚ '1 a.m.'ï¼Œ'1:30 p.m.'ï¼Œ'midnight'ï¼Œ'noon'ï¼Œ'12:30 p.m.'</td>
</tr>
<tr>
<td style="text-align:center">r</td>
<td style="text-align:center">RFC 5322 æ ¼å¼çš„æ—¥æœŸã€‚</td>
<td style="text-align:center">'Thu, 21 Dec 2000 16:01:07 +0200'</td>
</tr>
<tr>
<td style="text-align:center">s</td>
<td style="text-align:center">ç§’ï¼Œå¸¦å‰å¯¼é›¶çš„2ä½æ•°ã€‚</td>
<td style="text-align:center">'00' åˆ° '59'</td>
</tr>
<tr>
<td style="text-align:center">S</td>
<td style="text-align:center">æ¯æœˆæ—¥æœŸçš„è‹±æ–‡åºæ•°åç¼€ï¼Œ2ä¸ªå­—ç¬¦ã€‚</td>
<td style="text-align:center">'st'ï¼Œ'nd'ï¼Œ'rd' æˆ– 'th'</td>
</tr>
<tr>
<td style="text-align:center">t</td>
<td style="text-align:center">æŒ‡å®šæœˆä»½çš„å¤©æ•°ã€‚</td>
<td style="text-align:center">28 åˆ° 31</td>
</tr>
<tr>
<td style="text-align:center">T</td>
<td style="text-align:center">æœ¬æœºçš„æ—¶åŒºã€‚</td>
<td style="text-align:center">'EST'ï¼Œ'MDT'</td>
</tr>
<tr>
<td style="text-align:center">u</td>
<td style="text-align:center">å¾®ç§’ã€‚</td>
<td style="text-align:center">000000 åˆ° 999999</td>
</tr>
<tr>
<td style="text-align:center">U</td>
<td style="text-align:center">è‡ªUnixæ—¶ä»£ä»¥æ¥çš„ç§’æ•°ï¼ˆ1970å¹´1æœˆ1æ—¥00:00:00 UTCï¼‰ã€‚</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">w</td>
<td style="text-align:center">æ˜ŸæœŸå‡ ï¼Œæ²¡æœ‰å‰å¯¼é›¶çš„æ•°å­—ã€‚</td>
<td style="text-align:center">'0' ï¼ˆæ˜ŸæœŸæ—¥ï¼‰è‡³ '6' ï¼ˆæ˜Ÿå…­ï¼‰</td>
</tr>
<tr>
<td style="text-align:center">W</td>
<td style="text-align:center">ISO-8601å¹´çš„å‘¨æ•°ï¼Œå‘¨ä»æ˜ŸæœŸä¸€å¼€å§‹ã€‚</td>
<td style="text-align:center">1ï¼Œ53</td>
</tr>
<tr>
<td style="text-align:center">y</td>
<td style="text-align:center">å¹´ï¼Œ2ä½æ•°ã€‚</td>
<td style="text-align:center">'99'</td>
</tr>
<tr>
<td style="text-align:center">Y</td>
<td style="text-align:center">å¹´ï¼Œ4ä½æ•°ã€‚</td>
<td style="text-align:center">'1999'</td>
</tr>
<tr>
<td style="text-align:center">z</td>
<td style="text-align:center">ä¸€å¹´ä¸­çš„ä¸€å¤©ã€‚</td>
<td style="text-align:center">0 åˆ° 365</td>
</tr>
<tr>
<td style="text-align:center">Z</td>
<td style="text-align:center">æ—¶åŒºåç§»ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚ UTCä¹‹å‰çš„æ—¶åŒºçš„åç§»æ€»æ˜¯è´Ÿçš„ï¼Œå¹¶ä¸”å¯¹äºUTCçš„ä¸œéƒ¨çš„åç§»æ€»æ˜¯æ­£çš„ã€‚</td>
<td style="text-align:center">-43200 åˆ° 43200</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>å¸¸ç”¨æ ¼å¼</p>
<table>
<thead>
<tr>
<th style="text-align:center">æ ¼å¼å­—ç¬¦</th>
<th style="text-align:center">æè¿°</th>
<th style="text-align:center">ç¤ºä¾‹è¾“å‡º</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Y</td>
<td style="text-align:center">å¹´ï¼Œ4ä½æ•°ã€‚</td>
<td style="text-align:center">'1999'</td>
</tr>
<tr>
<td style="text-align:center">m</td>
<td style="text-align:center">æœˆï¼Œ2ä½æ•°å­—ï¼Œå‰å¯¼é›¶ã€‚</td>
<td style="text-align:center">'01' åˆ° '12'</td>
</tr>
<tr>
<td style="text-align:center">n</td>
<td style="text-align:center">æ²¡æœ‰å‰å¯¼é›¶çš„æœˆã€‚</td>
<td style="text-align:center">'1' åˆ° '12'</td>
</tr>
<tr>
<td style="text-align:center">d</td>
<td style="text-align:center">æœˆçš„æ—¥æœŸï¼Œå¸¦å‰å¯¼é›¶çš„2ä½æ•°å­—ã€‚</td>
<td style="text-align:center">'01' åˆ° '31'</td>
</tr>
<tr>
<td style="text-align:center">j</td>
<td style="text-align:center">æ²¡æœ‰å‰å¯¼é›¶çš„æœˆä»½æ—¥ã€‚</td>
<td style="text-align:center">'1' åˆ° '31'</td>
</tr>
<tr>
<td style="text-align:center">g</td>
<td style="text-align:center">å°æ—¶ï¼Œ12å°æ—¶æ ¼å¼ï¼Œä¸å«å‰å¯¼é›¶ã€‚</td>
<td style="text-align:center">'1' åˆ° '12'</td>
</tr>
<tr>
<td style="text-align:center">h</td>
<td style="text-align:center">å°æ—¶ï¼Œ12å°æ—¶æ ¼å¼ã€‚</td>
<td style="text-align:center">'01' åˆ° '12'</td>
</tr>
<tr>
<td style="text-align:center">G</td>
<td style="text-align:center">å°æ—¶ï¼Œ24å°æ—¶æ ¼å¼ï¼Œæ— å‰å¯¼é›¶ã€‚</td>
<td style="text-align:center">'0' åˆ° '23'</td>
</tr>
<tr>
<td style="text-align:center">H</td>
<td style="text-align:center">å°æ—¶ï¼Œ24å°æ—¶æ ¼å¼ã€‚</td>
<td style="text-align:center">'00' åˆ° '23'</td>
</tr>
<tr>
<td style="text-align:center">i</td>
<td style="text-align:center">åˆ†é’Ÿã€‚</td>
<td style="text-align:center">'00' åˆ° '59'</td>
</tr>
<tr>
<td style="text-align:center">s</td>
<td style="text-align:center">ç§’ï¼Œå¸¦å‰å¯¼é›¶çš„2ä½æ•°ã€‚</td>
<td style="text-align:center">'00' åˆ° '59'</td>
</tr>
</tbody>
</table>
</li>
</ul>
<p><code>front/views.py</code></p>
<pre><code>from django.shortcuts import render
from datetime import datetime


def index(request):
    context = {
        &quot;today&quot;: datetime.now()
    }
    return render(request, 'index.html', context=context)
</code></pre>
<p><code>templates/index.html</code></p>
<pre><code>{# 2018/12/09 #}
{{ today|date:&quot;Y/m/d&quot; }}
</code></pre>
<h2 id="default"><code>default</code></h2>
<p><code>front/views.py</code></p>
<pre><code>from django.shortcuts import render


def index(request):
    context = {
        'list': [],
        'dict': {},
        'str': '',
        'none': None,
        'number': 0,
    }
    return render(request, 'index.html', context=context)
</code></pre>
<p><code>templates/index.html</code></p>
<pre><code>{# ç©ºåˆ—è¡¨ #}
{{ list|default:'ç©ºåˆ—è¡¨' }}
{#ç©ºå­—å…¸#}
{{ dict|default:'ç©ºå­—å…¸' }}
{#ç©ºå­—ç¬¦ä¸²#}
{{ str|default:'ç©ºå­—ç¬¦ä¸²' }}
{#æ•°å­—0#}
{{ number|default:'æ•°å­—0' }}
{#None#}
{{ none|default:'None' }}
</code></pre>
<h2 id="default-if-none"><code>default-if-none</code></h2>
<p><strong>åªæœ‰å€¼ä¸º<code>None</code>æ‰ä¼šèµ·ä½œç”¨</strong></p>
<p><code>templates/index.html</code></p>
<pre><code>{#[]#}
{{ list|default_if_none:'ç©ºå­—å…¸' }}
{{ str|default_if_none:'ç©ºå­—ç¬¦ä¸²' }}
{#0#}
{{ number|default_if_none:'æ•°å­—0' }}
{#None#}
{{ none|default_if_none:'None' }}
</code></pre>
<h2 id="first"><code>first</code></h2>
<p><strong>è¿”å›åˆ—è¡¨æˆ–å…ƒç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ </strong></p>
<p><code>front/views.py</code></p>
<pre><code>from django.shortcuts import render


def index(request):
    context = {
        'student': ['å¨éœ‡å¤©', 'æ“å¤©æŸ±']
    }
    return render(request, 'index.html', context=context)
</code></pre>
<p><code>templates/index.html</code></p>
<pre><code>{# å¨éœ‡å¤© #}
{{ student|first }}
</code></pre>
<h2 id="last"><code>last</code></h2>
<p><strong>è¿”å›åˆ—è¡¨æˆ–å…ƒç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ </strong></p>
<p><code>templates/index.html</code></p>
<pre><code>{# æ“å¤©æŸ± #}
{{ student|last }}
</code></pre>
<h2 id="floatformat"><code>floatformat</code></h2>
<p><strong>å››èˆäº”å…¥æ ¼å¼åŒ–æµ®ç‚¹ç±»å‹</strong></p>
<ul>
<li>
<p>æ²¡æœ‰å‚æ•°æ˜¯ï¼Œé»˜è®¤ä¿ç•™ä¸€ä½å°æ•°ç‚¹</p>
</li>
<li>
<p>ä¼ é€’çš„å‚æ•°ä»£è¡¨å°æ•°ç‚¹çš„ä½æ•°</p>
</li>
</ul>
<p><code>templates/index.html</code></p>
<pre><code>{#3.1#}
{{ 3.141592654|floatformat }} &lt;br&gt;
{#3.14159 #}
{{ 3.141592654|floatformat:5 }} &lt;br&gt;
</code></pre>
<h2 id="join"><code>join</code></h2>
<p><strong>æŒ‡å®šåˆ†éš”ç¬¦æŠŠå…ƒç»„æˆ–è€…åˆ—è¡¨ï¼Œè½¬æ¢ä¸ºå­—ç¬¦ä¸²</strong></p>
<p><code>templates/index.html</code></p>
<pre><code>{#å¨éœ‡å¤©-æ“å¤©æŸ±#}
{{ student|join:'-' }}
</code></pre>
<h2 id="length"><code>length</code></h2>
<p><strong>è¿”å›å…ƒç»„ã€åˆ—è¡¨ã€å­—ç¬¦ä¸²çš„é•¿åº¦</strong><br>
<code>templates/index.html</code></p>
<pre><code>{#2#}
{{ student|length }}
</code></pre>
<h2 id="lower"><code>lower</code></h2>
<p><strong>å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå°å†™</strong><br>
<code>templates/index.html</code></p>
<pre><code>{#abc#}
{{ &quot;ABC&quot;|lower }}
</code></pre>
<h2 id="upper"><code>upper</code></h2>
<p><strong>å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¤§å†™</strong><br>
<code>templates/index.html</code></p>
<pre><code>{#ABC#}
{{ &quot;abc&quot;|upper }}
</code></pre>
<h2 id="random"><code>random</code></h2>
<p><strong>è¿”å›å…ƒç»„ã€åˆ—è¡¨ã€å­—ç¬¦ä¸²ä¸­éšæœºé€‰å–ä¸€ä¸ªå€¼</strong><br>
<code>templates/index.html</code></p>
<pre><code>{{ &quot;abc&quot;|random }}
</code></pre>
<h2 id="safe"><code>safe</code></h2>
<p><strong>æ ‡è®°ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å®‰å…¨çš„ï¼ŒåŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼Œä¹Ÿä¸ä¼šè¢«è½¬ä¹‰ï¼Œ ç±»ä¼¼å…³é—­<code>autoescape</code>æ ‡ç­¾çš„è‡ªåŠ¨è½¬ä¹‰</strong><br>
<code>templates/index.html</code></p>
<pre><code>{{ &quot;&lt;h1&gt;autoescape off&lt;/h1&gt;&quot;|safe }}
</code></pre>
<h2 id="slice"><code>slice</code></h2>
<p><strong>ç±»ä¼¼äº<code>python</code>çš„åˆ‡ç‰‡æ“ä½œ</strong></p>
<p><code>front/views.py</code></p>
<pre><code>def index(request):
    context = {
        'data': list(range(10))
    }
    return render(request, 'index.html', context=context)
</code></pre>
<p><code>templates/index.html</code></p>
<pre><code>{#[1, 3, 5, 7, 9]#}
{{ data|slice:&quot;1::2&quot;}}
</code></pre>
<h2 id="striptags"><code>striptags</code></h2>
<p><strong>å»é™¤å­—ç¬¦ä¸²ä¸­çš„ <code>HTML</code> æ ‡ç­¾</strong></p>
<p><code>templates/index.html</code></p>
<pre><code>{{ &quot;&lt;h1&gt;å»é™¤å­—ç¬¦ä¸²ä¸­çš„htmlæ ‡ç­¾&lt;/h1&gt;&quot;|striptags }}
</code></pre>
<h2 id="truncatechars"><code>truncatechars</code></h2>
<p><strong>æ˜¾ç¤ºæŒ‡å®šå­—ç¬¦é•¿åº¦ï¼Œè¶…å‡ºéƒ¨åˆ†æ˜¾ç¤º..., ä¸‰ä¸ªç‚¹ä¹Ÿçº³å…¥æŒ‡å®šå­—ç¬¦èŒƒå›´çš„é•¿åº¦</strong></p>
<p><code>templates/index.html</code></p>
<pre><code>{#æ˜¾ç¤º...#}
{{ &quot;æ˜¾ç¤ºæŒ‡å®šå­—ç¬¦é•¿åº¦ï¼Œè¶…å‡ºéƒ¨åˆ†æ˜¾ç¤º...&quot;|truncatechars:5 }}
</code></pre>
<h2 id="truncatechars_html"><code>truncatechars_html</code></h2>
<p><strong>ç±»ä¼¼ <code>truncatechars</code>, åªä¸è¿‡ä¸ä¼šåˆ‡å‰² <code>HTML</code> æ ‡ç­¾</strong><br>
<code>templates/index.html</code></p>
<pre><code>{{ &quot;&lt;h1&gt;æ˜¾ç¤ºæŒ‡å®šå­—ç¬¦é•¿åº¦ï¼Œè¶…å‡ºéƒ¨åˆ†æ˜¾ç¤º...&lt;/h1&gt;&quot;|truncatechars_html:5 }}
</code></pre>
<h2 id="å…¶å®ƒä¸å¸¸ç”¨è¿‡æ»¤å™¨">å…¶å®ƒä¸å¸¸ç”¨è¿‡æ»¤å™¨</h2>
<p><strong>å¯ä»¥åœ¨ <code>pycharm</code> ä¸­ï¼Œ æŸ¥çœ‹æºä»£ç </strong></p>
<pre><code>from django.template import defaultfilters, defaulttags
# defaultfilters æŸ¥çœ‹å†…ç½®è¿‡æ»¤å™¨
# defaulttags æŸ¥çœ‹å†…ç½®æ ‡ç­¾
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Django æ¨¡æ¿æ ‡ç­¾è¯¦è§£]]></title>
        <id>https://xiong-zh.github.io/post/Djangoæ¨¡æ¿æ ‡ç­¾è¯¦è§£</id>
        <link href="https://xiong-zh.github.io/post/Djangoæ¨¡æ¿æ ‡ç­¾è¯¦è§£">
        </link>
        <updated>2020-01-18T13:05:34.000Z</updated>
        <summary type="html"><![CDATA[<p>Django æ¨¡æ¿æ ‡ç­¾è¯¦è§£</p>
]]></summary>
        <content type="html"><![CDATA[<p>Django æ¨¡æ¿æ ‡ç­¾è¯¦è§£</p>
<!-- more -->
<h1 id="dtl-æ¨¡æ¿æ ‡ç­¾è¯¦è§£"><code>DTL</code> æ¨¡æ¿æ ‡ç­¾è¯¦è§£</h1>
<blockquote>
<p>æ¥ç€ä¸Šä¸€ç¯‡ <a href="https://zhb333.github.io/readme-blog/Python/Django/urls.html" title="urlsä¸è§†å›¾è¯¦è§£">urlsä¸è§†å›¾è¯¦è§£</a> ç»§ç»­å¾€ä¸‹è®²</p>
</blockquote>
<h2 id="ä¸€-æ¨¡æ¿æŸ¥æ‰¾è·¯å¾„">ä¸€ã€æ¨¡æ¿æŸ¥æ‰¾è·¯å¾„</h2>
<p><code>mysite/setting.py</code>ï¼š æ¨¡æ¿æŸ¥æ‰¾çš„ä¼˜å…ˆçº§æœ€é«˜ä¸ºå¦‚ä¸‹é…ç½®</p>
<pre><code>TEMPLATES = [
    {
        'DIRS': [os.path.join(BASE_DIR, 'templates')],
    },
]
</code></pre>
<p>å…¶æ¬¡æ˜¯ï¼Œåœ¨å„è‡ªçš„ <code>app</code> ä¸­ï¼Œ æ³¨æ„ï¼Œ éœ€è¦åœ¨ <code>INSTALLED_APPS</code> ä¸­æ³¨å†Œåæ‰èƒ½èµ·ä½œç”¨ï¼š</p>
<pre><code>INSTALLED_APPS = [
    'front',
]

TEMPLATES = [
    {
        'APP_DIRS': True,
    },
]
</code></pre>
<p>æœ€åå¦‚æœåœ¨å½“å‰ <code>app</code> ä¸­è¿˜æ‰¾ä¸åˆ°æ¨¡æ¿ï¼Œä¼šåˆ°å…¶å®ƒå·²å®‰è£…çš„ <code>app</code> ä¸­æŸ¥æ‰¾ï¼Œ å¦‚æœè¿˜æ‰¾ä¸åˆ°å°±ä¼šæŠ¥é”™äº†ï¼</p>
<h2 id="äºŒ-render_to_string">äºŒã€<code>render_to_string</code></h2>
<ul>
<li>
<p>åœ¨æ ¹ç›®å½•æ–°å»º <code>templates</code> æ–‡ä»¶å¤¹</p>
</li>
<li>
<p>åˆ›å»º <code>templates/index.html</code></p>
</li>
</ul>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;Title&lt;/title&gt;
    &lt;style&gt;
        body {
            color: #f00;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
ä½›æ›°ï¼š æˆ‘æ‰§ï¼Œ æ˜¯ç—›è‹¦çš„æ ¹æºï¼
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<ul>
<li>ä¿®æ”¹ <code>front/urls.py</code></li>
</ul>
<pre><code> path('', views.index, name='index'),
</code></pre>
<ul>
<li>ä¿®æ”¹ <code>front/views.py</code></li>
</ul>
<pre><code>from django.template.loader import render_to_string
from django.http import HttpResponse


def index(request):
    # åœ¨ mysite/settings.py é…ç½®äº†é¡¹ç›®æ¨¡æ¿è·¯å¾„
    html = render_to_string(&quot;index.html&quot;)
    return HttpResponse(html)
</code></pre>
<h2 id="ä¸‰-render">ä¸‰ã€<code>render</code></h2>
<blockquote>
<p><code>render_to_string</code> ä¸ <code>HttpResponse</code> ç»„åˆçš„å¿«æ·æ–¹å¼ï¼Œ å¯ <code>pycharm</code> æŸ¥çœ‹ <code>render</code> çš„å®ç°å¦‚ä¸‹ï¼š</p>
</blockquote>
<pre><code>def render(request, template_name, context=None, content_type=None, status=None, using=None):
    content = loader.render_to_string(template_name, context, request, using=using)
    return HttpResponse(content, content_type, status)
</code></pre>
<p>ä¿®æ”¹ <code>front/views.py</code></p>
<pre><code>from django.shortcuts import render


def index(request):
    return render(request, 'index.html')
</code></pre>
<h2 id="å››-æ¨¡æ¿å˜é‡">å››ã€æ¨¡æ¿å˜é‡</h2>
<blockquote>
<p>å¯ä»¥é€šè¿‡<code>render</code> å‡½æ•°çš„ <code>context</code> å‚æ•°ï¼Œç»™æ¨¡æ¿ä¼ é€’æ•°æ®</p>
</blockquote>
<p><strong>æ¨¡æ¿ä¸­ï¼Œä¸æ”¯æŒä¸­æ‹¬å·è¯­æ³•ï¼Œåªèƒ½é€šè¿‡ <code>.</code> è¯­æ³•è·å–</strong></p>
<ul>
<li>
<p>ä¼ é€’å­—ç¬¦ä¸²</p>
<p>ä¿®æ”¹ <code>front/views.py</code></p>
</li>
</ul>
<pre><code>def index(request):
    context = {'username': 'zhb333'}
    return render(request, 'index.html', context=context)
</code></pre>
<pre><code>ä¿®æ”¹ `templates/index.html`
</code></pre>
<pre><code>    &lt;body&gt;
    {{ username }}
    &lt;/body&gt;
</code></pre>
<pre><code>è®¿é—®ï¼š`http://localhost:8000/`, é¡µé¢æ˜¾ç¤ºï¼š **zhb333**
</code></pre>
<ul>
<li>
<p>ä¼ é€’ä¸€ä¸ªå¯¹è±¡</p>
<p>ä¿®æ”¹ <code>front/views.py</code></p>
</li>
</ul>
<pre><code>class Person:
   def __init__(self, username):
        self.username = username


   def index(request):
        context = {'person': Person('ç†æƒ³ä¸‰æ—¬')}
        return render(request, 'index.html', context=context)
</code></pre>
<pre><code>ä¿®æ”¹ `templates/index.html`
</code></pre>
<pre><code>  {{ person.username }}
</code></pre>
<ul>
<li>
<p>ä¼ é€’çš„æ•°æ®æ˜¯ä¸€ä¸ªå­—å…¸æ—¶ï¼Œ å­—å…¸ä¸­ä¸è¦å‡ºç°å…³é”®å­—ï¼Œè¿™æ ·ä¼šé€ æˆæ­§ä¹‰</p>
<p>ä¿®æ”¹ <code>front/views.py</code></p>
</li>
</ul>
<pre><code>    def index(request):
        context = {'person': {'username': 'æˆ‘è¦ä½ '}}
        return render(request, 'index.html', context=context)
</code></pre>
<pre><code>ä¿®æ”¹ `templates/index.html`  
</code></pre>
<pre><code>   {{ person.keys }}
</code></pre>
<pre><code>æµè§ˆå™¨æ˜¾ç¤ºï¼š **dict_keys(['username'])**  

ä¿®æ”¹ `front/views.py`
</code></pre>
<pre><code>def index(request):
     context = {'person': {'username': 'æˆ‘è¦ä½ ', 'keys': 'å¤œç©ºä¸­æœ€äº®çš„æ˜Ÿ'}}
     return render(request, 'index.html', context=context)
</code></pre>
<pre><code>æµè§ˆå™¨æ˜¾ç¤ºï¼š **å¤œç©ºä¸­æœ€äº®çš„æ˜Ÿ**
</code></pre>
<ul>
<li>
<p>ä¼ é€’åˆ—è¡¨æˆ–å…ƒç»„</p>
<p>ä¿®æ”¹ <code>front/views.py</code></p>
</li>
</ul>
<pre><code>   # context = {'persons': ['é‚£äº›èŠ±å„¿', 'å¥¹ä»¬éƒ½è€äº†å§', 'å¥¹ä»¬åœ¨å“ªé‡Œå‘€']}
   context = {'persons': ('é‚£äº›èŠ±å„¿', 'å¥¹ä»¬éƒ½è€äº†å§', 'å¥¹ä»¬åœ¨å“ªé‡Œå‘€')}
</code></pre>
<pre><code>ä¿®æ”¹ `templates/index.html`  
</code></pre>
<pre><code>   {{ persons.0 }} &lt;br&gt;
   {{ persons.1 }} &lt;br&gt;
   {{ persons.2 }} &lt;br&gt;
</code></pre>
<h2 id="äº”-å¸¸ç”¨çš„æ¨¡æ¿æ ‡ç­¾">äº” å¸¸ç”¨çš„æ¨¡æ¿æ ‡ç­¾</h2>
<p><strong>æ‰€æœ‰æ ‡ç­¾éƒ½éœ€è¦ç”¨ <code>{%%}</code> è¿›è¡ŒåŒ…è£¹</strong></p>
<ul>
<li><code>if</code> æ ‡ç­¾
<blockquote>
<p><code>if</code> æ ‡ç­¾ä¸­å¯ä»¥ä½¿ç”¨ï¼š <code>==</code>ã€<code>!=</code>ã€<code>&lt;</code>ã€<code>&lt;=</code>ã€<code>&gt;</code>ã€<code>&gt;=</code>ã€<code>in</code>ã€<code>not in</code>ã€<code>is</code>ã€<code>is not</code> ç­‰åˆ¤æ–­è¿ç®—ç¬¦</p>
</blockquote>
<ul>
<li>
<p><code>if...else</code> è¿ç®—ç¬¦ä¸¾ä¾‹</p>
<p>ä¿®æ”¹ <code>templates/index.html</code></p>
</li>
</ul>
</li>
</ul>
<pre><code>        {% if 'é‚£äº›èŠ±å„¿' in persons %}
            &lt;p style=&quot;color: hotpink&quot;&gt;å¯çˆ±çš„èŠ±å„¿&lt;/p&gt;
        {% else %}
            &lt;p style=&quot;color: darkgray&quot;&gt;å¯ä¼¶çš„èŠ±å„¿&lt;/p&gt;
        {% endif %}
</code></pre>
<pre><code>* `if...elif...else` ä¸¾ä¾‹
 ä¿®æ”¹ `templates/index.html`
</code></pre>
<pre><code>      {% if age &lt; 18 %}
            &lt;p&gt;ä¹³è‡­æœªå¹²çš„å°å­&lt;/p&gt;
      {% elif age == 18 %}
            &lt;p&gt;æ°é€¢å°‘å¹´æ—¶&lt;/p&gt;
      {% else %}
            &lt;p&gt;è€ç”·äºº&lt;/p&gt;
      {% endif %}
</code></pre>
<ul>
<li>
<p><code>for...in</code> å¾ªç¯åˆ—è¡¨</p>
<ul>
<li>
<p>å¾ªç¯åˆ—è¡¨</p>
<p>ä¿®æ”¹ <code>front/views.py</code></p>
</li>
</ul>
</li>
</ul>
<pre><code>    context = {
            'books': ['æ·±å…¥ç†è§£ES6', 'JavaScriptæƒå¨æŒ‡å—', 'JavaScriptè¯­è¨€ç²¾ç²¹']
         }
</code></pre>
<pre><code>    ä¿®æ”¹ `templates/index.html`  
</code></pre>
<pre><code>    &lt;ul&gt;
       {% for book in books %}
             &lt;li&gt;{{ book }}&lt;/li&gt;
       {% endfor %}
    &lt;/ul&gt;
</code></pre>
<pre><code>* åå‘å¾ªç¯åˆ—è¡¨  `reversed`

    ä¿®æ”¹ `templates/index.html`  
</code></pre>
<pre><code>     {% for book in books reversed %}
        &lt;li&gt;{{ book }}&lt;/li&gt;
     {% endfor %}
</code></pre>
<ul>
<li>
<p><code>for...in</code> å¾ªç¯ä¸­ï¼Œ <code>DTL</code> æä¾›äº†ä¸€äº›å¯ç”¨çš„æ¨¡æ¿å˜é‡ï¼š</p>
<ul>
<li>
<p>åˆ—è¡¨çš„ä¸‹æ ‡ <code>forloop.counter</code> ä» <code>1</code> å¼€å§‹</p>
<p>ä¿®æ”¹ <code>templates/index.html</code></p>
</li>
</ul>
</li>
</ul>
<pre><code>   {% for book in books %}
      &lt;li&gt;{{ forloop.counter }} -- {{ book }}&lt;/li&gt;
   {% endfor %}
</code></pre>
<pre><code>* åˆ—è¡¨çš„ä¸‹æ ‡ `forloop.counter0` ä» `0` å¼€å§‹

    ä¿®æ”¹ `templates/index.html`  
</code></pre>
<pre><code>        {% for book in books %}
            &lt;li&gt;{{ forloop.counter0 }} -- {{ book }}&lt;/li&gt;
        {% endfor %}
</code></pre>
<pre><code>* åˆ—è¡¨çš„åå‘ä¸‹æ ‡ `forloop.revcounter` ä» `1` å¼€å§‹
</code></pre>
<pre><code>        {% for book in books reversed %}
            &lt;li&gt;{{ forloop.revcounter }} -- {{ book }}&lt;/li&gt;
        {% endfor %}
</code></pre>
<pre><code>* åˆ—è¡¨çš„åå‘ä¸‹æ ‡ `forloop.revcounter0` ä» `0` å¼€å§‹
</code></pre>
<pre><code>        {% for book in books reversed %}
            &lt;li&gt;{{ forloop.revcounter0 }} -- {{ book }}&lt;/li&gt;
        {% endfor %}
</code></pre>
<pre><code>* æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡éå† `forloop.first`
</code></pre>
<pre><code>        {% for book in books %}
            {% if forloop.first %}
                &lt;li style=&quot;color: green;&quot;&gt;{{ forloop.revcounter0 }} -- {{ book }}&lt;/li&gt;
            {% else %}
                &lt;li style=&quot;color: red;&quot;&gt;{{ forloop.revcounter0 }} -- {{ book }}&lt;/li&gt;
            {% endif %}
        {% endfor %}
</code></pre>
<pre><code>* æ˜¯å¦æ˜¯æœ€åä¸€æ¬¡æ¬¡éå† `forloop.last`
</code></pre>
<pre><code>        {% for book in books %}
            {% if forloop.last %}
                &lt;li style=&quot;color: green;&quot;&gt;{{ forloop.revcounter0 }} -- {{ book }}&lt;/li&gt;
            {% else %}
                &lt;li style=&quot;color: red;&quot;&gt;{{ forloop.revcounter0 }} -- {{ book }}&lt;/li&gt;
            {% endif %}
        {% endfor %}
</code></pre>
<pre><code>* è°ƒç”¨ä¸Šä¸€çº§å¾ªç¯çš„ `forloop` æ¨¡æ¿å˜é‡  `forloop.parentloop`  
    ä¿®æ”¹ `front/views.py` 
</code></pre>
<pre><code>    context = {
      'family': [{'father': 'å¤§å¤´çˆ¸çˆ¸', 'children': ['å°å¤´å­©å„¿', 'å°å¤´å¥³å„¿']}]
      }
</code></pre>
<pre><code>     ä¿®æ”¹ `templates/index.html`  
</code></pre>
<pre><code>        {% for who in family %}
            &lt;p&gt;this is &lt;strong style=&quot;color: green&quot;&gt;{{ who.father }}&lt;/strong&gt;&lt;/p&gt;
            {% for child in who.children %}
                &lt;p&gt;{{ child }}&lt;/p&gt;
                &lt;p&gt;{{ forloop.parentloop.first }}&lt;/p&gt;
                &lt;p&gt;{{ forloop.parentloop.last }}&lt;/p&gt;
                &lt;p&gt;{{ forloop.parentloop.counter }}&lt;/p&gt;
                &lt;p&gt;{{ forloop.parentloop.revcounter }}&lt;/p&gt;
            {% endfor %}
        {% endfor %}
</code></pre>
<ul>
<li>
<p><code>for...in</code> å¾ªç¯å­—å…¸</p>
<ul>
<li>å¾ªç¯å­—å…¸ <code>keys</code><br>
ä¿®æ”¹ <code>front/views.py</code></li>
</ul>
</li>
</ul>
<pre><code>           context = {'student': {
                'name': 'é“æ˜å¯º',
                'girl': 'æ‰èœ',
                'age': '18',
            }}
</code></pre>
<pre><code>    ä¿®æ”¹ `templates/index.html`  

    ```
    &lt;ul&gt;
        {% for key in student.keys %}
            &lt;li&gt;{{ key }}&lt;/li&gt;
        {% endfor %}
    &lt;/ul&gt;
    ```      
    
* å¾ªç¯å­—å…¸ `values`    

    ä¿®æ”¹ `templates/index.html`  

    ```
    {% for value in student.values %}
        &lt;li&gt;{{ value }}&lt;/li&gt;
    {% endfor %}
    ```   

* å¾ªç¯å­—å…¸ `items`    

    ä¿®æ”¹ `templates/index.html`  

    ```
    {% for key,value in student.items %}
        &lt;li&gt;{{ key }}--{{ value }}&lt;/li&gt;
    {% endfor %}
    ```   
</code></pre>
<ul>
<li>
<p><code>for...in...empty...</code></p>
<p>ä¿®æ”¹ <code>front/views.py</code></p>
</li>
</ul>
<pre><code>    context = {
    'comments': []
    }
</code></pre>
<pre><code>ä¿®æ”¹ `templates/index.html`  
</code></pre>
<pre><code>    {% for comment in comments %}
        {{ comment }}
    {% empty %}
        è¿˜æ²¡æœ‰ä»»ä½•è¯„è®º
    {% endfor %}
</code></pre>
<ul>
<li>
<p><code>with</code> æ ‡ç­¾ ï¼ˆåœ¨æ¨¡æ¿ä¸­å®šä¹‰å˜é‡ï¼‰</p>
<p><strong>é€šè¿‡ <code>with</code> æ ‡ç­¾å®šä¹‰çš„å˜é‡åªèƒ½åœ¨ï¼Œ åªèƒ½åœ¨ <code>with</code> æ ‡ç­¾åŒ…è£¹çš„è¯­å¥å—ä¸­ä½¿ç”¨</strong></p>
<p>ä¿®æ”¹ <code>front/views.py</code></p>
</li>
</ul>
<pre><code>    context = {
        'students': ['å­™æ‚Ÿç©º', 'çŒªå…«æˆ’', 'æ²™å’Œå°š']
    }
</code></pre>
<pre><code>ä¿®æ”¹ `templates/index.html`  
</code></pre>
<pre><code>    {% with students.0 as monkey %}
        {{ monkey }}
    {% endwith %}

    {% with pig=students.1 %}
        {{ pig }}
    {% endwith %}
</code></pre>
<ul>
<li>
<p><code>url</code> æ ‡ç­¾</p>
<p><strong>é€šè¿‡ <code>url</code> æ ‡ç­¾ å¯ä»¥æŠŠ <code>urls.py</code> ä¸­ï¼Œ å¯¹åº”çš„ <code>path</code> æˆ– <code>re_path</code> çš„å‘½åï¼Œè½¬æ¢åŒ–ä¸ºæµè§ˆå™¨å¯è¯†åˆ«çš„é“¾æ¥</strong></p>
<p>ä¿®æ”¹ <code>front/urls.py</code></p>
</li>
</ul>
<pre><code>    from django.urls import path
    from . import views

    app_name = 'front'

    urlpatterns = [
        path('', views.index, name='index'),
        path('book/&lt;book_id&gt;/', views.book, name='book'),
        path('movie/', views.movie, name='movie'),
        path('story/&lt;story_id&gt;/&lt;category&gt;/', views.story, name='story'),
    ]
</code></pre>
<pre><code>ä¿®æ”¹ `front/views.py`
</code></pre>
<pre><code>    from django.http import HttpResponse
    from django.template.loader import render_to_string


    def index(request):
        return HttpResponse(render_to_string('index.html'))


    def book(request, book_id):
        return HttpResponse('ä¹¦ç±, %s' % book_id)


    def movie(request):
        movie_id = request.GET.get('movie_id')
        return HttpResponse('ç”µå½±, %s' % movie_id)


    def story(request, story_id, category):
        _type = request.GET.get('type')
        return HttpResponse('æ•…äº‹id: %s, åˆ†ç±»ï¼š %s, ç±»å‹ï¼š %s' % (story_id, category, _type))
</code></pre>
<pre><code>ä¿®æ”¹ `templates/index.html`  
</code></pre>
<pre><code>    &lt;p&gt;&lt;a href=&quot;{% url 'front:index' %}&quot;&gt;é¦–é¡µ&lt;/a&gt;&lt;/p&gt;
    &lt;p&gt;&lt;a href=&quot;{% url 'front:book' book_id=1 %}&quot;&gt;ä¹¦ç±&lt;/a&gt;&lt;/p&gt;
    &lt;p&gt;&lt;a href=&quot;{% url 'front:movie' %}?movie_id=2&quot;&gt;ç”µå½±&lt;/a&gt;&lt;/p&gt;
    &lt;p&gt;&lt;a href=&quot;{% url 'front:story' story_id=3 category='å†’é™©' %}?type=æœªçŸ¥&quot;&gt;æ•…äº‹&lt;/a&gt;&lt;/p&gt;
</code></pre>
<ul>
<li>
<p><code>spaceless</code> æ ‡ç­¾ ï¼ˆå»é™¤htmlä»£ç ä¸­çš„ç©ºç™½å­—ç¬¦ï¼‰</p>
<p><strong>ä¸‹é¢çš„ <code>html</code> æ¨¡æ¿ä»£ç å­˜åœ¨å¾ˆå¤šç©ºç™½å­—ç¬¦ï¼Œå¯ä»¥é€šè¿‡ <code>spaceless</code> æ ‡ç­¾å»é™¤</strong></p>
</li>
</ul>
<pre><code>    {% spaceless %}
        &lt;ul&gt;
            &lt;li&gt;
                &lt;a href=&quot;https://www.baidu.com&quot;&gt;
                    ç™¾åº¦
                &lt;/a&gt;
            &lt;/li&gt;
        &lt;/ul&gt;
    {% endspaceless %}
</code></pre>
<ul>
<li>
<p><code>autoescape</code>æ ‡ç­¾ ï¼ˆé»˜è®¤å¼€å¯äº†ç‰¹æ®Šå­—ç¬¦è‡ªåŠ¨è½¬ä¹‰ï¼‰</p>
<p><strong>å¯ä»¥é€šè¿‡è®¾ç½® <code>autoescape</code> æ ‡ç­¾çš„è‡ªåŠ¨è½¬ä¹‰ ä¸º <code>off</code>, å…³é—­è‡ªåŠ¨è½¬ä¹‰</strong><br>
ä¿®æ”¹ <code>front/urls.py</code></p>
</li>
</ul>
<pre><code>    urlpatterns = [
        path('', views.index, name='index'),
    ]
</code></pre>
<pre><code>ä¿®æ”¹ `front/views.py`
</code></pre>
<pre><code>    from django.shortcuts import render


    def index(request):
        return render(request, 'index.html', context={'link': '&lt;p&gt;&lt;a href=&quot;http://www.baidu.com&quot;&gt;ç™¾åº¦&lt;/a&gt;&lt;/p&gt;'})
</code></pre>
<pre><code>ä¿®æ”¹ `templates/index.html`
</code></pre>
<pre><code>    &lt;body&gt;
    {{ link }}
    {% autoescape off %}
        {{ link }}
    {% endautoescape %}
    &lt;/body&gt;
</code></pre>
<ul>
<li><code>verbatim</code> æ ‡ç­¾<br>
<strong>å½“ä¸æƒ³è¦<code>DTL</code>ç¼–è¯‘ {{}} æˆ– {%%} æ—¶ï¼Œ å¯ä»¥é€šè¿‡ <code>verbatim</code> æ ‡ç­¾åŒ…è£¹</strong></li>
</ul>
<pre><code>    {% verbatim %}
        {{ å“ˆå“ˆ }}
        {% å‘µå‘µ %}
    {% endverbatim %}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Django ORMå¸¸ç”¨Fieldè¯¦è§£]]></title>
        <id>https://xiong-zh.github.io/post/Django-ORMå¸¸ç”¨Fieldè¯¦è§£</id>
        <link href="https://xiong-zh.github.io/post/Django-ORMå¸¸ç”¨Fieldè¯¦è§£">
        </link>
        <updated>2020-01-18T13:04:14.000Z</updated>
        <summary type="html"><![CDATA[<p>Django ORMå¸¸ç”¨Fieldè¯¦è§£</p>
]]></summary>
        <content type="html"><![CDATA[<p>Django ORMå¸¸ç”¨Fieldè¯¦è§£</p>
<!-- more -->
<h2 id="ä¸€-å¸¸ç”¨çš„field">ä¸€ã€å¸¸ç”¨çš„<code>Field</code></h2>
<p><code>book/models.py</code></p>
<pre><code>class Fields(models.Model):

    # æ˜ å°„åˆ°æ•°æ®åº“ä¸­æ˜¯intç±»å‹ï¼Œå¯ä»¥æœ‰è‡ªåŠ¨å¢é•¿çš„ç‰¹æ€§ã€‚ä¸€èˆ¬ä¸éœ€è¦ä½¿ç”¨è¿™ä¸ªç±»å‹ï¼Œå¦‚æœä¸æŒ‡å®šä¸»é”®ï¼Œé‚£ä¹ˆæ¨¡å‹ä¼šè‡ªåŠ¨çš„ç”Ÿæˆä¸€ä¸ªå«åšidçš„è‡ªåŠ¨å¢é•¿çš„ä¸»é”®ã€‚
    # auto_id = models.AutoField()

    # 64ä½çš„æ•´å½¢ï¼Œç±»ä¼¼äºAutoFieldï¼Œåªä¸è¿‡æ˜¯äº§ç”Ÿçš„æ•°æ®çš„èŒƒå›´æ˜¯ä»1-9223372036854775807
    id = models.BigAutoField(primary_key=True)

    # åœ¨æ¨¡å‹å±‚é¢æ¥æ”¶çš„æ˜¯True / Falseã€‚åœ¨æ•°æ®åº“å±‚é¢æ˜¯tinyintç±»å‹ å­˜å‚¨çš„æ˜¯ 0/1ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šé»˜è®¤å€¼ï¼Œé»˜è®¤å€¼æ˜¯Noneã€‚
    removed = models.BooleanField()

    # åœ¨æ•°æ®åº“å±‚é¢æ˜¯varcharç±»å‹ã€‚åœ¨Pythonå±‚é¢å°±æ˜¯æ™®é€šçš„å­—ç¬¦ä¸²ã€‚è¿™ä¸ªç±»å‹åœ¨ä½¿ç”¨çš„æ—¶å€™å¿…é¡»è¦æŒ‡å®šæœ€å¤§çš„é•¿åº¦ï¼Œä¹Ÿå³å¿…é¡»è¦ä¼ é€’max_length
    title = models.CharField(max_length=100)

    # æ—¥æœŸç±»å‹ã€‚åœ¨Pythonä¸­æ˜¯datetime.dateç±»å‹ï¼Œå¯ä»¥è®°å½•å¹´æœˆæ—¥ã€‚åœ¨æ˜ å°„åˆ°æ•°æ®åº“ä¸­ä¹Ÿæ˜¯dateç±»å‹ã€‚ä½¿ç”¨è¿™ä¸ªFieldå¯ä»¥ä¼ é€’ä»¥ä¸‹å‡ ä¸ªå‚æ•°ï¼š
    #
    # auto_nowï¼šæœ€åä¸€æ¬¡ä¿®æ”¹æ—¶é—´ï¼Œå¯ä»¥å°†è¿™ä¸ªå±æ€§è®¾ç½®ä¸ºTrueã€‚
    # auto_now_addï¼šæ–°å¢æ—¶é—´ï¼Œå¯ä»¥å°†è¿™ä¸ªå±æ€§è®¾ç½®ä¸ºTrueã€‚
    birth = models.DateField(auto_now_add=True)

    # æ—¥æœŸæ—¶é—´ç±»å‹ï¼Œç±»ä¼¼äºDateFieldã€‚ä¸ä»…ä»…å¯ä»¥å­˜å‚¨æ—¥æœŸï¼Œè¿˜å¯ä»¥å­˜å‚¨æ—¶é—´ã€‚æ˜ å°„åˆ°æ•°æ®åº“ä¸­æ˜¯datetimeç±»å‹ã€‚è¿™ä¸ªFieldä¹Ÿå¯ä»¥ä½¿ç”¨auto_nowå’Œauto_now_addä¸¤ä¸ªå±æ€§ã€‚
    created_time = models.DateTimeField(auto_now_add=True)

    # æ—¶é—´ç±»å‹ã€‚åœ¨æ•°æ®åº“ä¸­æ˜¯timeç±»å‹ã€‚åœ¨Pythonä¸­æ˜¯datetime.timeç±»å‹ã€‚
    lunch_time = models.TimeField()

    # ç±»ä¼¼äºCharFieldã€‚åœ¨æ•°æ®åº“åº•å±‚ä¹Ÿæ˜¯ä¸€ä¸ªvarcharç±»å‹ã€‚æœ€å¤§é•¿åº¦æ˜¯254ä¸ªå­—ç¬¦ã€‚å¹¶ä¸éªŒè¯é‚®ç®±æ ¼å¼ï¼Œé…åˆ ModelForm ä½¿ç”¨æ—¶ï¼Œæ‰ä¼šä¸è¿›è¡Œé‚®ç®±æ ¼å¼éªŒè¯
    email = models.EmailField()

    # ç”¨æ¥å­˜å‚¨æ–‡ä»¶çš„ã€‚è¿™ä¸ªè¯·å‚è€ƒåé¢çš„æ–‡ä»¶ä¸Šä¼ ç« èŠ‚éƒ¨åˆ†ã€‚
    # file = models.FileField()

    # ç”¨æ¥å­˜å‚¨å›¾ç‰‡æ–‡ä»¶çš„ã€‚è¿™ä¸ªè¯·å‚è€ƒåé¢çš„å›¾ç‰‡ä¸Šä¼ ç« èŠ‚éƒ¨åˆ†ã€‚
    # image = models.ImageField()

    # æµ®ç‚¹ç±»å‹ã€‚æ˜ å°„åˆ°æ•°æ®åº“ä¸­æ˜¯doubleç±»å‹ã€‚
    price = models.FloatField()

    # æ•´å½¢ã€‚å€¼çš„åŒºé—´æ˜¯-2147483648â€”â€”2147483647
    age = models.IntegerField()

    # å¤§æ•´å½¢ã€‚å€¼çš„åŒºé—´æ˜¯-9223372036854775808â€”â€”9223372036854775807ã€‚
    total = models.BigIntegerField()

    # æ­£æ•´å½¢ã€‚å€¼çš„åŒºé—´æ˜¯0â€”â€”2147483647ã€‚
    money = models.PositiveIntegerField()

    # å°æ•´å½¢ã€‚å€¼çš„åŒºé—´æ˜¯-32768â€”â€”32767ã€‚
    apple = models.SmallIntegerField()

    # å°æ•´å½¢ã€‚å€¼çš„åŒºé—´æ˜¯-32768â€”â€”32767ã€‚
    pear = models.PositiveSmallIntegerField()

    # å°æ•´å½¢ã€‚å€¼çš„åŒºé—´æ˜¯-32768â€”â€”32767ã€‚
    content = models.TextField()

    # åªèƒ½å­˜å‚¨uuidæ ¼å¼çš„å­—ç¬¦ä¸²ã€‚uuidæ˜¯ä¸€ä¸ª32ä½çš„å…¨çƒå”¯ä¸€çš„å­—ç¬¦ä¸²ï¼Œä¸€èˆ¬ç”¨æ¥ä½œä¸ºä¸»é”®ã€‚
    uuid = models.UUIDField()

    # ç±»ä¼¼äºCharFieldï¼Œåªä¸è¿‡åªèƒ½ç”¨æ¥å­˜å‚¨urlæ ¼å¼çš„å­—ç¬¦ä¸²ã€‚å¹¶ä¸”é»˜è®¤çš„max_lengthæ˜¯200ã€‚
    url = models.URLField()
</code></pre>
<h2 id="äºŒ-æ³¨æ„äº‹é¡¹">äºŒã€æ³¨æ„äº‹é¡¹ï¼š</h2>
<ul>
<li>å·²ç»å°†æ¨¡å‹æ˜ å°„åˆ°æ•°æ®åº“åï¼Œä¿®æ”¹æˆ–æ–°å¢è¡¨å­—æ®µï¼Œå¦‚æœæ²¡æœ‰æä¾›é»˜è®¤å€¼ï¼Œåœ¨ç”Ÿæˆè¿ç§»æ–‡ä»¶æ—¶ï¼Œä¼šæä¾›ä¸¤ä¸ªé€‰é¡¹ï¼Œè®©ä½ æ·»åŠ é»˜è®¤å€¼</li>
</ul>
<pre><code>  (myenv) E:\code\PythonEnvs\myenv\book_manager&gt;python manage.py makemigrations
  You are trying to add a non-nullable field 'age' to fields without a default; we can't do that (the database nee
  ds something to populate existing rows).
  Please select a fix:
  1) Provide a one-off default now (will be set on all existing rows with a null value for this column)
  2) Quit, and let me add a default in models.py
</code></pre>
<ul>
<li>
<p>ä½¿ç”¨ <code>DateField</code>ã€ <code>DateTimeField</code> çš„è‡ªåŠ¨æ·»åŠ æ—¶é—´å‚æ•° <code>auto_now_add</code> æˆ– <code>auto_now</code>ï¼Œ æ·»åŠ åˆ°æ•°æ®åº“ä½¿ç”¨çš„æ˜¯ <code>django.utils.timezone.now()</code> , è¿™æ˜¯ä¸€ä¸ª  <code>UTC</code> æ—¶é—´ï¼Œ ä¸ºäº†åœ¨æ¨¡æ¿ä¸­æ­£ç¡®æ˜¾ç¤ºå½“å‰æ—¶åŒºçš„æ—¶é—´ï¼Œéœ€è¦é…ç½®æ­£ç¡®æ—¶åŒº</p>
<p><code>book_manager/settings.py</code></p>
</li>
</ul>
<pre><code>  TIME_ZONE = 'Asia/Shanghai'
</code></pre>
<hr>
<p><code>book_manager/urls.py</code></p>
<pre><code>  from django.urls import path, include

  urlpatterns = [
      path('', include('book.urls')),
  ]
</code></pre>
<hr>
<p><code>book/urls.py</code></p>
<pre><code>  from django.urls import path
  from . import views

  app_name = 'book'

  urlpatterns = [
      path('', views.index, name='index')
  ]
</code></pre>
<hr>
<p><code>book/models.py</code></p>
<pre><code>  class Book(models.Model):
      id = models.AutoField(primary_key=True)
      title = models.CharField(max_length=100, null=False)
      author = models.CharField(max_length=100, null=False)
      price = models.FloatField(default=0)
      create_time = models.DateTimeField(auto_now_add=True)
</code></pre>
<hr>
<p><code>book/views.py</code></p>
<pre><code>  from django.shortcuts import render
  from . import models

  def index(request):
      book = models.Book(title='ç²¾é€šES6', author='zhb333', price=333)
      book.save()
      obj = models.Book.objects.get(pk=1)
      # UTC æ—¶é—´
      return render(request, 'book/index.html', context={'create_time': obj.create_time})
</code></pre>
<hr>
<p><code>book/templates/book/index.html</code></p>
<pre><code>  {#æ­£ç¡®é…ç½®æ—¶åŒºï¼Œå³ä¾¿å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„æ—¶é—´æ˜¯UTCæ—¶é—´ï¼Œæ¨¡æ¿ä¸­ä¹Ÿä¼šæ­£ç¡®æ˜¾ç¤ºé…ç½®çš„æ—¶åŒºæ‰€å¯¹åº”çš„æ—¶é—´#}
  {{ create_time }}
</code></pre>
<h2 id="ä¸‰-å…¶å®ƒä¸å¸¸ç”¨çš„-field">ä¸‰ã€å…¶å®ƒä¸å¸¸ç”¨çš„ <code>Field</code></h2>
<p><strong>å¯ä»¥åœ¨ <code>pycharm</code> ä¸­æŒ‰<code>ctrl</code> å¹¶ç‚¹å‡»ä»»ä¸€ä¸ª <code>Field</code>è¿›å…¥æ‰€æœ‰<code>Field</code>çš„å®šä¹‰æ–‡ä»¶æŸ¥çœ‹</strong></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Djangoåˆ›å»ºå’Œæ˜ å°„ORMæ¨¡å‹åˆ°æ•°æ®åº“]]></title>
        <id>https://xiong-zh.github.io/post/Djangoåˆ›å»ºå’Œæ˜ å°„ORMæ¨¡å‹åˆ°æ•°æ®åº“</id>
        <link href="https://xiong-zh.github.io/post/Djangoåˆ›å»ºå’Œæ˜ å°„ORMæ¨¡å‹åˆ°æ•°æ®åº“">
        </link>
        <updated>2020-01-18T13:03:08.000Z</updated>
        <summary type="html"><![CDATA[<p>Djangoåˆ›å»ºå’Œæ˜ å°„ORMæ¨¡å‹åˆ°æ•°æ®åº“</p>
]]></summary>
        <content type="html"><![CDATA[<p>Djangoåˆ›å»ºå’Œæ˜ å°„ORMæ¨¡å‹åˆ°æ•°æ®åº“</p>
<!-- more -->
<h2 id="1-æ–°å»ºåº”ç”¨-book">1ã€æ–°å»ºåº”ç”¨ <code>book</code></h2>
<pre><code>python manage.py startapp book
</code></pre>
<h2 id="2-é…ç½®-book-ä¸ºå·²å®‰è£…åº”ç”¨">2ã€é…ç½® <code>book</code> ä¸ºå·²å®‰è£…åº”ç”¨</h2>
<p><code>book_manager/settings.py</code></p>
<pre><code>INSTALLED_APPS = [
    'book',
]
</code></pre>
<h2 id="3-åˆ›å»ºæ¨¡å‹">3ã€åˆ›å»ºæ¨¡å‹</h2>
<p><code>book/models.py</code></p>
<pre><code>from django.db import models
# Create your models here.

class Book(models.Model):
    id = models.AutoField(primary_key=True)
    title = models.CharField(max_length=100, null=False)
    author = models.CharField(max_length=100, null=False)
    price = models.FloatField(default=0)
</code></pre>
<h2 id="4-ç”Ÿæˆæ•°æ®åº“è¿ç§»æ–‡ä»¶">4ã€ç”Ÿæˆæ•°æ®åº“è¿ç§»æ–‡ä»¶</h2>
<pre><code>python manage.py makemigrations
</code></pre>
<h2 id="5-å°†å·²å®‰è£…çš„åº”ç”¨çš„è¿ç§»æ–‡ä»¶æ˜ å°„åˆ°æ•°æ®åº“">5ã€å°†å·²å®‰è£…çš„åº”ç”¨çš„è¿ç§»æ–‡ä»¶æ˜ å°„åˆ°æ•°æ®åº“</h2>
<pre><code>python manage.py migrate
</code></pre>
<p><strong>æ³¨æ„ï¼š</strong></p>
<ol>
<li>
<p>å¦‚æœåœ¨æ¨¡å‹ä¸­ä¸æŒ‡å®šè¡¨åï¼Œé»˜è®¤æ˜¯ä»¥ åº”ç”¨å_æ¨¡å‹åï¼ˆå°å†™ï¼‰å¦‚ï¼š<code>book_book</code> ä½œä¸ºè¡¨å</p>
</li>
<li>
<p>æ¨¡å‹ä¸­é»˜è®¤ä»¥ <code>id</code> ä½œä¸ºä¸»é”®ï¼Œå› æ­¤åœ¨æ¨¡å‹ä¸­å¯ä»¥çœç•¥ä¸»é”®çš„å®šä¹‰å³ï¼š</p>
<p><code>book/models.py</code></p>
</li>
</ol>
<pre><code>    class Book(models.Model):
        title = models.CharField(max_length=100, null=False)
        author = models.CharField(max_length=100, null=False)
        price = models.FloatField(default=0)
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Djangoæ“ä½œæ•°æ®åº“åŸç”ŸSQLåˆä½“éªŒ]]></title>
        <id>https://xiong-zh.github.io/post/Djangoæ“ä½œæ•°æ®åº“åŸç”ŸSQLåˆä½“éªŒ</id>
        <link href="https://xiong-zh.github.io/post/Djangoæ“ä½œæ•°æ®åº“åŸç”ŸSQLåˆä½“éªŒ">
        </link>
        <updated>2020-01-18T13:00:51.000Z</updated>
        <summary type="html"><![CDATA[<p>Django - Django æ“ä½œæ•°æ®åº“-åŸç”ŸSQLåˆä½“éªŒ</p>
]]></summary>
        <content type="html"><![CDATA[<p>Django - Django æ“ä½œæ•°æ®åº“-åŸç”ŸSQLåˆä½“éªŒ</p>
<!-- more -->
<h2 id="ä¸€-å®‰è£…-mysqlclient">ä¸€ã€å®‰è£… <code>mysqlclient</code></h2>
<pre><code>pip install mysqlclient
</code></pre>
<h2 id="äºŒ-é…ç½®è¿æ¥æ•°æ®åº“">äºŒã€ é…ç½®è¿æ¥æ•°æ®åº“</h2>
<p><code>mysite/settings.py</code></p>
<pre><code>DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        # æ•°æ®åº“å
        'NAME': 'django_db1',
        'USER': 'root',
        'PASSWORD': '123456',
        'HOST': '127.0.0.1',
        'PORT': '3306',
    }
}
</code></pre>
<h2 id="ä¸‰-ä½¿ç”¨åŸç”Ÿ-sql-æ“ä½œæ•°æ®åº“">ä¸‰ã€ä½¿ç”¨åŸç”Ÿ <code>sql</code> æ“ä½œæ•°æ®åº“</h2>
<ul>
<li>
<p>ä½¿ç”¨ <code>navicat</code> æ–°å»ºæ•°æ®åº“ <code>django_db1</code></p>
</li>
<li>
<p>åœ¨æ•°æ®åº“ <code>django_db1</code> æ–°å»ºè¡¨ <code>book</code></p>
</li>
<li>
<p>æ–°å¢æ•°æ®ï¼š</p>
<p><code>front/views.py</code></p>
</li>
</ul>
<pre><code>from django.shortcuts import render
from django.db import connection
def index(request):
      cursor = connection.cursor()
      cursor.execute(&quot;insert into book(title,author) values('æ·±å…¥ç†è§£ES6', 'å°¼å¤æ‹‰æ–¯')&quot;)
      return render(request, 'front/index.html')
</code></pre>
<ul>
<li>
<p>æµè§ˆå™¨è®¿é—®ï¼š <code>localhost:8000</code>, ä¾¿ä¼šæ–°å¢ä¸€æ¡æ•°æ®</p>
</li>
<li>
<p>æŸ¥è¯¢æ•°æ®</p>
<p><code>front/views.py</code></p>
</li>
</ul>
<pre><code>    def index(request):
    cursor = connection.cursor()
    cursor.execute(&quot;select * from book&quot;)
    # æŸ¥è¯¢ä¸€æ¡æ•°æ®
    # row = cursor.fetchone()
    # æŒ‡å®šæŸ¥è¯¢çš„æ¡æ•°
    # rows = cursor.fetchmany(2)
    # æŸ¥è¯¢æ‰€æœ‰æ•°æ®
    rows = cursor.fetchall()
    for row in rows:
        print(row)
    return render(request, 'front/index.html')
</code></pre>
<h2 id="å››-python-db-apiä¸‹-cursorå¯¹è±¡å¸¸ç”¨æ¥å£">å››ã€<code>Python DB API</code>ä¸‹ <code>cursor</code>å¯¹è±¡ï¼Œå¸¸ç”¨æ¥å£</h2>
<ul>
<li>
<p><code>description</code></p>
<p>æ‰§è¡Œ <code>cursor.execute</code>åï¼Œå¯é€šè¿‡ <code>cursor.description</code> æŸ¥çœ‹å­—æ®µä¿¡æ¯</p>
<p><code>front/views.py</code></p>
</li>
</ul>
<pre><code>    def index(request):
    cursor = connection.cursor()
    cursor.execute(&quot;select * from book&quot;)
    # (('id', 3, 1, 11, 11, 0, 0), ('title', 253, 15, 765, 765, 0, 0), ('author', 253, 12, 765, 765, 0, 0))
    print(cursor.description)
    rows = cursor.fetchall()
    for row in rows:
        print(row)
    return render(request, 'front/index.html')
</code></pre>
<ul>
<li>
<p><code>rowcount</code></p>
<p>æ‰§è¡Œ <code>sql</code> åˆ é™¤ï¼Œæ–°å¢ï¼Œä¿®æ”¹æ—¶ï¼Œè¿”å›å—å½±å“çš„æ¡æ•°ï¼Œ æŸ¥è¯¢æ—¶ï¼Œè¿”å›æŸ¥è¯¢æ•°æ®çš„æ¡æ•°</p>
<p><code>front/views.py</code></p>
</li>
</ul>
<pre><code>    def index(request):
    cursor = connection.cursor()
    cursor.execute(&quot;delete from book where id=2&quot;)
    # 1
    print(cursor.rowcount)
    return render(request, 'front/index.html')
</code></pre>
<ul>
<li>
<p><code>close</code></p>
<p>å…³é—­æ¸¸æ ‡</p>
</li>
</ul>
<pre><code>   cursor.close()
</code></pre>
<ul>
<li>
<p><code>execute</code></p>
<p>ç”¨äºæ‰§è¡Œ <code>sql</code> è¯­å¥ï¼Œ è¿˜å¯ä»¥ä¼ é€’å‚æ•°</p>
</li>
</ul>
<pre><code> cursor.execute('select * from book where id=%s', (1,))
</code></pre>
<ul>
<li><code>fetchone</code></li>
<li><code>fetchmany</code></li>
<li><code>fetchall</code></li>
</ul>
<pre><code>    # æŸ¥è¯¢ä¸€æ¡æ•°æ®
    row = cursor.fetchone()
    # æŒ‡å®šæŸ¥è¯¢çš„æ¡æ•°
    rows = cursor.fetchmany(2)
    # æŸ¥è¯¢æ‰€æœ‰æ•°æ®
    rows = cursor.fetchall()
</code></pre>
<h2 id="äº”-å›¾ä¹¦ç®¡ç†ç³»ç»Ÿæ¡ˆä¾‹">äº”ã€å›¾ä¹¦ç®¡ç†ç³»ç»Ÿæ¡ˆä¾‹</h2>
<ul>
<li>è¿›å…¥è™šæ‹Ÿç¯å¢ƒ</li>
</ul>
<pre><code>   workon myenv
</code></pre>
<ul>
<li>åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®</li>
</ul>
<pre><code>    django-admin startproject book_manager
</code></pre>
<ul>
<li>åˆ›å»º <code>front</code> åº”ç”¨</li>
</ul>
<pre><code>    cd book_manager
    python manage.py startapp front
</code></pre>
<ul>
<li>é…ç½®å°† <code>front</code> åº”ç”¨ï¼Œæ³¨å†Œåˆ°å·²å®‰è£…åº”ç”¨<br>
<code>book_manager/setting.py</code></li>
</ul>
<pre><code>    INSTALLED_APPS = [
        'front',
    ]
</code></pre>
<hr>
<ol>
<li>
<p>ä½¿ç”¨ <code>Navicat</code> åˆ›å»ºæ•°æ®åº“ <code>book_manager</code></p>
</li>
<li>
<p>åˆ›å»ºè¡¨ <code>book</code>, ä¸‰ä¸ªå­—æ®µï¼š <code>id</code>ã€ <code>title</code>ã€ <code>author</code></p>
</li>
<li>
<p>é…ç½®æ•°æ®åº“è¿æ¥<br>
<code>book_manager/settings.py</code></p>
</li>
</ol>
<pre><code>    DATABASES = {
        'default': {
            'ENGINE': 'django.db.backends.mysql',
            # æ•°æ®åº“å
            'NAME': 'book_manager',
            'USER': 'root',
            'PASSWORD': '123456',
            'HOST': '127.0.0.1',
            'PORT': '3306',
        }
    }
</code></pre>
<ol start="4">
<li>
<p>é…ç½®è·¯ç”±</p>
<p><code>book_manager/urls.py</code></p>
</li>
</ol>
<pre><code>    from django.urls import path, include

    urlpatterns = [
        path('', include('front.urls')),
    ]
</code></pre>
<pre><code>`front/urls.py`
</code></pre>
<pre><code>    from django.urls import path
    from . import views

    app_name = 'front'

    urlpatterns = [
        path('', views.index, name='index'),
        path('create/', views.create_book, name='create'),
        path('detail/&lt;int:book_id&gt;', views.book_detail, name='detail'),
        path('delete/&lt;int:book_id&gt;', views.book_delete, name='delete'),
        path('edit/&lt;int:book_id&gt;', views.book_edit, name='edit'),
    ]
</code></pre>
<ol start="5">
<li>
<p>ç¼–å†™è§†å›¾å‡½æ•°</p>
<p><code>front/views.py</code></p>
</li>
</ol>
<pre><code>    from django.shortcuts import render, reverse, redirect
    from django.db import connection


    # è·å–æ“ä½œæ•°æ®åº“é”šç‚¹
    def get_cursor():
        return connection.cursor()

    # é¦–é¡µï¼Œå±•ç¤ºæ‰€æœ‰å›¾ä¹¦
    def index(request):
        cursor = get_cursor()
        cursor.execute('select * from book')
        keys = [item[0] for item in cursor.description]
        books = [dict(zip(keys, values)) for values in cursor.fetchall()]
        cursor.close()
        return render(request, 'front/index.html', context={&quot;books&quot;: books})

    # æ–°å¢å›¾ä¹¦
    def create_book(request):
        if request.method == 'POST':
            title = request.POST.get('title')
            author = request.POST.get('author')
            cursor = get_cursor()
            cursor.execute('insert into book(title, author) values(%s, %s)', (title, author))
            cursor.close()
            return redirect(reverse('front:index'))
        else:
            return render(request, 'front/create.html')

    # å›¾ä¹¦è¯¦æƒ…
    def book_detail(request, book_id):
        cursor = get_cursor()
        cursor.execute('select * from book where id=%s', (book_id,))
        keys = [item[0] for item in cursor.description]
        book = dict(zip(keys, cursor.fetchone()))
        cursor.close()
        return render(request, 'front/detail.html', context={&quot;book&quot;: book})

    # åˆ é™¤å›¾ä¹¦
    def book_delete(request, book_id):
        cursor = get_cursor()
        cursor.execute('delete from book where id=%s', (book_id,))
        cursor.close()
        return redirect(reverse('front:index'))

    # ç¼–è¾‘å›¾ä¹¦
    def book_edit(request, book_id):
        cursor = get_cursor()
        if request.method == 'GET':
            cursor.execute('select * from book where id=%s', (book_id,))
            keys = [item[0] for item in cursor.description]
            book = dict(zip(keys, cursor.fetchone()))
            cursor.close()
            return render(request, 'front/edit.html', context={&quot;book&quot;: book})
        else:
            title = request.POST.get('title')
            author = request.POST.get('author')
            cursor.execute('update book set title=%s, author=%s where id=%s', (title, author, book_id))
            cursor.close()
            return redirect(reverse('front:index'))
</code></pre>
<ol start="6">
<li>å°† <code>static</code> æ³¨å†Œä¸ºæ¨¡æ¿æ ‡ç­¾<br>
<code>book_manager/settings.py</code></li>
</ol>
<pre><code>    TEMPLATES = [
        {
            'OPTIONS': {
                'builtins': [
                    'django.templatetags.static'
                ],
            },
        },
    ]
</code></pre>
<ol start="7">
<li>å…³é—­è¡¨å• <code>csrf</code> éªŒè¯<br>
<code>book_manager/settings.py</code></li>
</ol>
<pre><code>    MIDDLEWARE = [
        # 'django.middleware.csrf.CsrfViewMiddleware',
    ]
</code></pre>
<ol start="6">
<li>ç¼–å†™æ¨¡æ¿<br>
<code>front/templates/front/base.html</code></li>
</ol>
<pre><code>    &lt;!DOCTYPE html&gt;
    &lt;html lang=&quot;en&quot;&gt;
    &lt;head&gt;
        &lt;meta charset=&quot;UTF-8&quot;&gt;
        &lt;title&gt;å›¾ä¹¦ç®¡ç†ç³»ç»Ÿ&lt;/title&gt;
        &lt;link rel=&quot;stylesheet&quot; href=&quot;{% static 'front/style.css' %}&quot;&gt;
    &lt;/head&gt;
    &lt;body&gt;
        {% include 'front/header.html' %}
        {% block content %}
        {% endblock %}
    &lt;/body&gt;
    &lt;/html&gt;
</code></pre>
<pre><code>`front/templates/front/header.html`
</code></pre>
<pre><code>     &lt;header&gt;
        &lt;nav&gt;
            &lt;ul&gt;
                &lt;li&gt;&lt;a href=&quot;/&quot;&gt;é¦–é¡µ&lt;/a&gt;&lt;/li&gt;
                &lt;li&gt;&lt;a href=&quot;/create/&quot;&gt;æ–°å¢å›¾ä¹¦&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
        &lt;/nav&gt;
    &lt;/header&gt;
</code></pre>
<pre><code>`front/templates/front/index.html`
</code></pre>
<pre><code>    {% extends &quot;front/base.html&quot; %}

    {% block content %}
        &lt;h1&gt;æ‰€æœ‰å›¾ä¹¦&lt;/h1&gt;
        &lt;table cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; &gt;
            &lt;thead&gt;
                &lt;tr&gt;
                    &lt;th class=&quot;table-id&quot;&gt;åºå·&lt;/th&gt;
                    &lt;th class=&quot;table-title&quot;&gt;ä¹¦å&lt;/th&gt;
                    &lt;th class=&quot;table-author&quot;&gt;ä½œè€…&lt;/th&gt;
                &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
                {% for book in books %}
                    &lt;tr&gt;
                        &lt;td class=&quot;table-id&quot;&gt;{{ forloop.counter }}&lt;/td&gt;
                        &lt;td class=&quot;table-title&quot;&gt;&lt;a href=&quot;{% url 'front:detail' book_id=book.id %}&quot;&gt;{{ book.title }}&lt;/a&gt;&lt;/td&gt;
                        &lt;td class=&quot;table-author&quot;&gt;{{ book.author }}&lt;/td&gt;
                    &lt;/tr&gt;
                {% endfor %}
            &lt;/tbody&gt;
        &lt;/table&gt;
    {% endblock %}
</code></pre>
<pre><code>`front/templates/front/create.html`
</code></pre>
<pre><code>    {% extends &quot;front/base.html&quot; %}

    {% block content %}
        &lt;h1&gt;æ–°å¢å›¾ä¹¦&lt;/h1&gt;
        &lt;form action=&quot;&quot; method=&quot;post&quot; id=&quot;create-form&quot;&gt;
            &lt;p&gt;
                &lt;label for=&quot;title&quot;&gt; ä¹¦åï¼š
                    &lt;input type=&quot;text&quot; class=&quot;input-text&quot; name=&quot;title&quot; id=&quot;title&quot; required&gt;
                &lt;/label&gt;
            &lt;/p&gt;
            &lt;p&gt;
                &lt;label for=&quot;author&quot;&gt; ä½œè€…ï¼š
                    &lt;input type=&quot;text&quot; class=&quot;input-text&quot; name=&quot;author&quot; id=&quot;author&quot; required&gt;
                &lt;/label&gt;
            &lt;/p&gt;
            &lt;p&gt;
                &lt;input type=&quot;submit&quot; value=&quot;æ–°å¢å›¾ä¹¦&quot; class=&quot;default-btn&quot;&gt;
            &lt;/p&gt;
        &lt;/form&gt;
    {% endblock %}
</code></pre>
<pre><code>`front/templates/front/detail.html`
</code></pre>
<pre><code>    {% extends &quot;front/base.html&quot; %}

    {% block content %}
        &lt;h1&gt;å›¾ä¹¦è¯¦æƒ…&lt;/h1&gt;
        &lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot;&gt;
            {% for key, value in book.items %}
                &lt;tr&gt;
                    &lt;td class=&quot;table-id&quot;&gt;{{ key }}&lt;/td&gt;
                    &lt;td class=&quot;table-title&quot;&gt;{{ value }}&lt;/td&gt;
                &lt;/tr&gt;
            {% endfor %}
            &lt;tr&gt;
                &lt;td class=&quot;table-id&quot;&gt;&lt;button id=&quot;book-del&quot; class=&quot;small-danger-btn&quot;&gt;åˆ é™¤&lt;/button&gt;&lt;/td&gt;
                &lt;td class=&quot;table-title&quot;&gt;&lt;button id=&quot;book-edit&quot; class=&quot;small-default-btn&quot;&gt;ç¼–è¾‘&lt;/button&gt;&lt;/td&gt;
            &lt;/tr&gt;
        &lt;/table&gt;

        &lt;script&gt;
            const delBtn = document.querySelector('#book-del');
            const editBtn = document.querySelector('#book-edit');

            delBtn.onclick = function() {
                window.location.href = '{% url 'front:delete' book_id=book.id %}'
            };

            editBtn.onclick = function() {
                window.location.href = '{% url 'front:edit' book_id=book.id %}'
            };
        &lt;/script&gt;
    {% endblock %}
</code></pre>
<pre><code>`front/templates/front/edit.html`
</code></pre>
<pre><code>    {% extends &quot;front/base.html&quot; %}

    {% block content %}
        &lt;h1&gt;ç¼–è¾‘å›¾ä¹¦&lt;/h1&gt;
        &lt;form action=&quot;{% url 'front:edit' book_id=book.id %}&quot; method=&quot;post&quot; id=&quot;create-form&quot;&gt;
            &lt;p&gt;
                &lt;label for=&quot;title&quot;&gt; ä¹¦åï¼š
                    &lt;input type=&quot;text&quot; class=&quot;input-text&quot; value=&quot;{{ book.title }}&quot; name=&quot;title&quot; id=&quot;title&quot; required&gt;
                &lt;/label&gt;
            &lt;/p&gt;
            &lt;p&gt;
                &lt;label for=&quot;author&quot;&gt; ä½œè€…ï¼š
                    &lt;input type=&quot;text&quot; class=&quot;input-text&quot; value=&quot;{{ book.author }}&quot; name=&quot;author&quot; id=&quot;author&quot; required&gt;
                &lt;/label&gt;
            &lt;/p&gt;
            &lt;p&gt;
                &lt;input type=&quot;submit&quot; value=&quot;ç¼–è¾‘å›¾ä¹¦&quot; class=&quot;default-btn&quot;&gt;
            &lt;/p&gt;
        &lt;/form&gt;
    {% endblock %}
</code></pre>
<pre><code>`front/static/front/style.css`
</code></pre>
<pre><code>    body, ul, li, h1{
        padding: 0;
        margin: 0;
    }

    nav ul {
        list-style: none;
        height: 60px;
        background-color: #333;
    }

    nav li {
        padding: 0 10px;
        float: left;
        text-align: center;
        line-height: 60px;
    }

    nav a {
        width: 120px;
        display: block;
        height: 60px;
        font-size: 22px;
        color: #fff;
        font-weight: bold;
        text-decoration: none;
    }

    nav a:hover {
        color: lightblue;
    }

    #create-form {
        width: 600px;
        height: 300px;
        background-color: #abcdef;
        margin: 15px auto;
    }

    #create-form p {
        text-align: center;
        padding-top:  25px;
    }

    .input-text {
        width: 200px;
        height: 30px;
        border-radius: 5px;
        border: 1px solid lightblue;
    }

    .default-btn {
        width: 150px;
        height: 50px;
        border-radius: 10px;
        color: #fff;
        background-color: lightgreen;
        line-height: 30px;
        text-align: center;
        border: 1px solid #89a1a9;
    }

    .small-default-btn {
        width: 100px;
        height: 35px;
        border-radius: 10px;
        color: #fff;
        background-color: lightgreen;
        line-height: 30px;
        text-align: center;
        border: 1px solid #89a1a9;
    }

    .small-danger-btn {
        width: 100px;
        height: 35px;
        border-radius: 10px;
        color: #fff;
        background-color: darkred;
        line-height: 30px;
        text-align: center;
        border: 1px solid #89a1a9;
    }

    table {
        margin: 25px auto;
    }

    td, th {
        border: 1px solid lightblue;
        text-align: center;
    }

    .table-id {
        width: 100px;
        height: 50px;
    }

    .table-title {
        width: 500px;
        height: 50px;
    }

    .table-author {
        width: 300px;
        height: 50px;
    }


    h1 {
        text-align: center;
        color: #333;
    }
</code></pre>
]]></content>
    </entry>
</feed>